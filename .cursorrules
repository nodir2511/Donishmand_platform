# Donishmand Platform - Core Instructions

## 1. Языковая политика (КРИТИЧЕСКИ)
- **Общение и документация**: Всегда используй РУССКИЙ язык для планов реализации (`implementation_plan.md`), описаний задач (`task.md`) и отчетов (`walkthrough.md`).
- **Комментарии в коде**: Все новые комментарии в коде должны быть на РУССКОМ языке.
- **Локализация приложения**: Поддержка `tj` (таджикский) и `ru` (русский). Тексты хранятся в `src/constants/data.jsx` или JSON (i18next).

## 2. Эстетика и UI (Dark Gaming UI)
- **Стиль**: Премиальный "Cyberpunk/Gaming" стиль.
- **Цвета**: Фон `#0B0B15`, Карточки `#151525` (opacity 60%), Акценты: Фиолетовый `#6C5DD3`, Голубой `#00E0FF`, Розовый `#FF49DB`.
- **Эффекты**: Glassmorphism (`backdrop-blur-xl`, `bg-white/5`), тонкие границы (`border-white/5`), свечение (`glow`).
- **Шрифты**: **Outfit** ТОЛЬКО для заголовков (`font-heading`), **Inter** для всего остального текста (`font-sans`).
- **Интерактив**: Обязательно `active:scale-95` для кнопок и плавные переходы `transition-all duration-300`.

## 3. Технические стандарты
- **Стек**: React (Vite), Tailwind CSS, Supabase (Auth/DB).
- **Расширения**: Всегда используй `.jsx` для файлов с JSX.
- **Структура**:
  - `/src/components/pages` - страницы
  - `/src/contexts` - глобальное состояние
  - `/src/services` - API клиенты
- **Прогресс**: Используй `localStorage` с префиксом `progress_`.

## 4. Git и CI/CD
- **Частота пушей**: Отправлять код в Git и выполнять деплой разрешено **только в конце рабочего дня** или по прямому запросу пользователя.

## 5. Процесс разработки
- **Планирование**: Перед любой нетривиальной задачей СОЗДАВАЙ `implementation_plan.md` на русском языке.
- **Одобрение**: Не приступай к фазе EXECUTION без явного одобрения плана пользователем.
- **Артефакты**: Регулярно обновляй `task.md` и создавай `walkthrough.md` после завершения.
- **Никаких заглушек**: Никогда не оставляй пустые функции или комментарии типа `// TODO` без реализации.
- **Локализация**: Любая новая строка текста в UI должна сразу попадать в систему переводов.
- **Проактивная отладка**: Исследуй код инструментами системы (`grep`, `view_file`) перед фиксом.

## 6. Компоненты и иконки
- **Иконки**: Используй только `lucide-react`.
- **Интерактив**: Обязательно `active:scale-95` для кнопок.
- **Date Inputs**: В темной теме ВСЕГДА добавляй `[color-scheme:dark]`.
- **YouTube**: При парсинге ссылок используй RegEx.

## 7. Аутентификация (Supabase)
- **Клиент**: `src/services/supabase.js`.
- **Состояние**: `AuthContext.jsx`.
- **Безопасность**: Используй RLS (Row Level Security) в Supabase (напоминание для backend).
- **Роли**: Роли (ученик/учитель) хранятся в таблице `profiles`.

## 8. Целостность данных и Supabase
- **Очистка от undefined**: Supabase REST API (PostgREST) выдает `406 Not Acceptable`, если отправить `undefined` в JSONB. Всегда используй утилиту `cleanUndefined` (с сохранением Date) перед upsert-запросами контента.
- **Осторожно с isNumeric**: При обратной совместимости старых данных **НИКОГДА** не применяй фильтрацию `/^\d+$/` к новым полям, иначе легитимные тестовые вопросы вида "123" или математические ответы "2" будут удаляться.
- **Каскадное удаление (Cascade)**: При удалении контента (уроки, темы, пользователи) из интерфейса, обязательно выполняй физическое удаление (`DELETE`) связанных данных из БД, чтобы не плодить "сиротские" записи.

## 9. Полнота кода (Без Заглушек)
- **Никаких пустышек**: Не оставляй `// TODO` или неработающие UI-кнопки без привязки к логике, БД и ключам локализации. Код должен сдаваться работоспособным "под ключ".
