import{j as e}from"./editor-B4b3M6em.js";import{r as l}from"./vendor-DfgOC3sD.js";import{u as He,s as c,A as k,S as P,a as Ke}from"./index-LLMaOK8Q.js";import{b as Q,c as Ve}from"./branchService-slSyfROC.js";import{u as Ie}from"./useDebounce-DE7P2URC.js";import{u as et,j as u,U as be,N as pe,O as tt,Q as W,W as fe,f as je,Y as at,T as we,p as st,g as rt,Z as lt,X as B,_ as it,E as nt,$ as ve,a0 as ot,a1 as ct}from"./ui-DAjowxi7.js";import"./supabase-CQnWzhEg.js";const ft=()=>{const{t:dt,i18n:ye}=et(),C=ye.resolvedLanguage||"ru",{isSuperAdmin:j,profile:T}=He(),[o,X]=l.useState("users"),[w,x]=l.useState([]),[$,Y]=l.useState(!0),[H,Ne]=l.useState(""),[v,L]=l.useState(1),[z,K]=l.useState(1),V=10,D=Ie(H,500),[q,g]=l.useState(null),[I,F]=l.useState([]),[_e,ee]=l.useState(!1),[M,te]=l.useState(""),[ae,se]=l.useState(!1),[Se,y]=l.useState(!1),[re,le]=l.useState(!1),[R,ke]=l.useState(!1),[ie,h]=l.useState(""),[ne,E]=l.useState(""),[r,d]=l.useState({full_name:"",email:"",password:"",role:"student",subject:"",grade:"",language:"tj",class_id:""}),[Ce,ze]=l.useState([]),[Me,N]=l.useState(!1),[i,b]=l.useState(null),[oe,ce]=l.useState(""),[de,me]=l.useState(!1),[Ee,_]=l.useState(!1),[p,Ae]=l.useState(null),[ue,O]=l.useState([]),[A,S]=l.useState(!1),[Ue,U]=l.useState(!1),[f,Pe]=l.useState(null),[J,xe]=l.useState([]);l.useEffect(()=>{o==="users"&&L(1)},[D,o]),l.useEffect(()=>{o==="users"?ge():o==="branches"&&Be()},[v,D,o]),l.useEffect(()=>{(async()=>{try{const{data:a}=await c.from("classes").select("id, name");a&&ze(a)}catch(a){console.error("Ошибка загрузки списка классов:",a)}})()},[]);const ge=async()=>{Y(!0);try{const{data:t,error:a}=await c.rpc("get_users_paginated",{page_number:v,items_per_page:V,search_query:D});if(a)throw a;if(t&&t.length>0){x(t);const s=t[0].total_count;K(Math.max(1,Math.ceil(s/V)))}else x([]),K(1)}catch(t){console.error("Ошибка загрузки пользователей:",t)}finally{Y(!1)}},Be=async()=>{ee(!0);try{const t=await Q.getBranches();F(t)}catch(t){console.error("Ошибка загрузки филиалов:",t)}finally{ee(!1)}},Te=async t=>{if(t.preventDefault(),!!M.trim()){se(!0);try{const a=await Q.createBranch(M);F(s=>[...s,a].sort((n,m)=>n.name.localeCompare(m.name))),te(""),alert("Филиал успешно добавлен")}catch(a){console.error("Ошибка добавления филиала:",a),alert(a.message||"Ошибка добавления филиала")}finally{se(!1)}}},$e=async(t,a)=>{if(window.confirm(`Вы уверены, что хотите удалить филиал "${a}"? Классы этого филиала останутся, но без привязки к филиалу.`)){g(t);try{await Q.deleteBranch(t),F(s=>s.filter(n=>n.id!==t))}catch(s){console.error("Ошибка удаления филиала:",s),alert("Не удалось удалить филиал")}finally{g(null)}}},Le=async(t,a)=>{if(!j&&(a==="admin"||a==="super_admin")){alert("У вас нет прав для назначения этой роли");return}g(t);try{const{error:s}=await c.rpc("update_user_role",{target_user_id:t,new_role:a});if(s)throw s;x(w.map(n=>n.id===t?{...n,role:a}:n))}catch(s){console.error("Ошибка обновления роли:",s),alert("Не удалось обновить роль")}finally{g(null)}},De=async t=>{if(!j){alert("Только супер-администратор может удалять пользователей");return}if(window.confirm(`Вы уверены, что хотите удалить пользователя ${t.email}? Это действие необратимо и удалит все связанные данные (если настроено каскадное удаление).`)){g(t.id);try{const{error:a}=await c.rpc("admin_delete_user",{target_user_id:t.id});if(a)throw a;x(w.filter(s=>s.id!==t.id))}catch(a){console.error("Ошибка удаления пользователя:",a),alert("Не удалось удалить пользователя. Возможно, функция admin_delete_user не установлена в Supabase.")}finally{g(null)}}},qe=async t=>{var a;if(t.preventDefault(),h(""),E(""),!r.email||!r.password){h("Email и пароль обязательны");return}if(r.password.length<6){h("Пароль должен быть не менее 6 символов");return}le(!0);try{const{data:s,error:n}=await Ke.auth.signUp({email:r.email,password:r.password,options:{data:{full_name:r.full_name,role:r.role}}});if(n)throw n;if(s.user){const{error:m}=await c.rpc("admin_upsert_profile",{target_id:s.user.id,target_full_name:r.full_name,target_role:r.role,target_subject:r.role==="teacher"?r.subject:null,target_grade:r.role==="student"&&parseInt(r.grade)||null,target_language:r.role==="student"?r.language:"tj"});if(m&&console.warn("Ошибка обновления профиля:",m),r.role==="student"&&r.class_id)try{await Ve.addStudentToClass(r.class_id,s.user.id)}catch(G){console.warn("Ошибка прикрепления ученика к классу:",G)}}E(`Пользователь ${r.email} успешно создан!`),d({full_name:"",email:"",password:"",role:"student",subject:"",grade:"",language:"tj",class_id:""}),await ge(),setTimeout(()=>{y(!1),E("")},1500)}catch(s){console.error("Ошибка создания пользователя:",s),(a=s.message)!=null&&a.includes("already registered")?h("Пользователь с таким email уже зарегистрирован"):h(s.message||"Ошибка при создании пользователя")}finally{le(!1)}},Fe=async t=>{t.preventDefault(),ce(""),me(!0);try{const{error:a}=await c.rpc("admin_update_profile",{target_id:i.id,new_full_name:i.full_name||"",new_role:i.role||"student",new_subject:i.role==="teacher"&&i.subject||null,new_grade:i.role==="student"&&parseInt(i.grade)||null,new_language:i.role==="student"&&i.language||"tj"});if(a)throw a;x(w.map(s=>s.id===i.id?{...s,...i}:s)),N(!1)}catch(a){console.error("Ошибка редактирования пользователя:",a),ce("Не удалось сохранить изменения")}finally{me(!1)}},Re=async t=>{Ae(t),_(!0),S(!1);try{const{data:a}=await c.from("subject_permissions").select("*").eq("user_id",t.id),s=k.map(n=>{const m=a==null?void 0:a.find(G=>G.subject_id===n);return{subject_id:n,can_edit:(m==null?void 0:m.can_edit)||!1}});O(s)}catch(a){console.error("Ошибка загрузки прав:",a),O(k.map(s=>({subject_id:s,can_edit:!1})))}},Oe=t=>{O(a=>a.map(s=>s.subject_id===t?{...s,can_edit:!s.can_edit}:s))},Je=async()=>{if(p){S(!0);try{await c.from("subject_permissions").delete().eq("user_id",p.id);const t=ue.filter(a=>a.can_edit).map(a=>({user_id:p.id,subject_id:a.subject_id,can_edit:!0,granted_by:T==null?void 0:T.id}));if(t.length>0){const{error:a}=await c.from("subject_permissions").insert(t);if(a)throw a}_(!1)}catch(t){console.error("Ошибка сохранения прав:",t),alert("Не удалось сохранить права")}finally{S(!1)}}},Ze=t=>{Pe(t),xe(t.selected_subjects||[]),U(!0)},Ge=t=>{xe(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])},Qe=async()=>{if(f){S(!0);try{const{error:t}=await c.from("profiles").update({selected_subjects:J}).eq("id",f.id);if(t)throw t;x(w.map(a=>a.id===f.id?{...a,selected_subjects:J}:a)),U(!1)}catch(t){console.error("Ошибка сохранения предметов ученика:",t),alert("Не удалось сохранить предметы")}finally{S(!1)}}},We=t=>{switch(t){case"super_admin":return e.jsx(ct,{className:"text-red-500",size:20});case"admin":return e.jsx(ve,{className:"text-gaming-accent",size:20});case"teacher":return e.jsx(ot,{className:"text-gaming-primary",size:20});default:return e.jsx(be,{className:"text-gray-400",size:20})}},Xe=t=>{switch(t){case"super_admin":return"border-red-500/50 bg-red-500/10 text-red-400";case"admin":return"border-gaming-accent/50 bg-gaming-accent/10 text-gaming-accent";case"teacher":return"border-gaming-primary/50 bg-gaming-primary/10 text-gaming-primary";default:return"border-white/10 bg-white/5 text-gray-400"}},Ye=()=>j?[{value:"student",label:"Ученик"},{value:"user",label:"Пользователь"},{value:"teacher",label:"Учитель"},{value:"admin",label:"Админ"},{value:"super_admin",label:"Супер Админ"}]:[{value:"student",label:"Ученик"},{value:"user",label:"Пользователь"},{value:"teacher",label:"Учитель"}],he=w;if($)return e.jsx("div",{className:"min-h-screen pt-24 flex items-center justify-center",children:e.jsx(u,{className:"animate-spin text-gaming-primary",size:40})});const Z=Ye();return e.jsxs("div",{className:"min-h-screen pt-24 pb-12 px-4 container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-heading font-bold text-white mb-2",children:o==="users"?"Управление пользователями":"Управление филиалами"}),e.jsx("p",{className:"text-gaming-textMuted",children:o==="users"?j?"Полный доступ: управление ролями, правами и пользователями":"Управление учителями и учениками":"Управление списком филиалов для привязки классов"})]}),e.jsxs("div",{className:"flex gap-2 mb-8 border-b border-white/10 pb-4",children:[e.jsxs("button",{onClick:()=>X("users"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all ${o==="users"?"bg-gaming-primary text-white shadow-lg shadow-gaming-primary/25":"bg-black/30 text-gray-400 hover:bg-white/5 hover:text-white border border-white/5"}`,children:[e.jsx(be,{size:18})," Пользователи"]}),e.jsxs("button",{onClick:()=>X("branches"),className:`flex items-center gap-2 px-6 py-3 rounded-xl font-medium transition-all ${o==="branches"?"bg-gaming-accent text-white shadow-lg shadow-gaming-accent/25":"bg-black/30 text-gray-400 hover:bg-white/5 hover:text-white border border-white/5"}`,children:[e.jsx(pe,{size:18})," Филиалы"]})]}),o==="users"?e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"mb-6 flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(tt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Поиск пользователей...",value:H,onChange:t=>Ne(t.target.value),className:"w-full bg-gaming-card border border-white/10 rounded-xl py-3 pl-10 pr-4 text-white focus:outline-none focus:border-gaming-primary transition-colors"})]}),e.jsxs("button",{onClick:()=>{y(!0),h(""),E("")},className:"flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-gaming-primary to-gaming-purple text-white rounded-xl font-medium hover:scale-105 active:scale-95 transition-all shadow-lg shadow-gaming-primary/25 whitespace-nowrap",children:[e.jsx(W,{size:20}),"Добавить пользователя"]})]}),e.jsxs("div",{className:"bg-gaming-card border border-white/5 rounded-2xl overflow-hidden backdrop-blur-xl",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/5 bg-white/5",children:[e.jsx("th",{className:"p-4 text-gaming-textMuted font-medium",children:"Пользователь"}),e.jsx("th",{className:"p-4 text-gaming-textMuted font-medium",children:"Email"}),e.jsx("th",{className:"p-4 text-gaming-textMuted font-medium",children:"Роль"}),e.jsx("th",{className:"p-4 text-gaming-textMuted font-medium",children:"Действия"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:he.map(t=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gaming-primary/20 flex items-center justify-center border border-gaming-primary/30",children:We(t.role)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:t.full_name||"Без имени"}),e.jsxs("div",{className:"text-xs text-gaming-textMuted",children:["ID: ",t.id.slice(0,8),"..."]})]})]})}),e.jsx("td",{className:"p-4 text-gray-300",children:t.email||"Нет email"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs border ${Xe(t.role)}`,children:t.role||"user"})}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-2",children:q===t.id?e.jsx(u,{className:"animate-spin text-gaming-primary",size:20}):e.jsxs(e.Fragment,{children:[e.jsx("select",{value:t.role||"user",onChange:a=>Le(t.id,a.target.value),className:"bg-black/40 border border-white/10 rounded-lg py-1.5 px-3 text-sm text-gray-300 focus:outline-none focus:border-gaming-primary cursor-pointer hover:bg-black/60 transition-colors",children:Z.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("button",{onClick:()=>{b({...t}),N(!0)},title:"Редактировать пользователя",className:"p-2 rounded-lg bg-blue-500/10 border border-blue-500/30 text-blue-500 hover:bg-blue-500/20 transition-all hover:scale-105 active:scale-95",children:e.jsx(fe,{size:16})}),t.role==="student"&&e.jsx("button",{onClick:()=>Ze(t),title:"Предметы ученика",className:"p-2 rounded-lg bg-gaming-accent/10 border border-gaming-accent/30 text-gaming-accent hover:bg-gaming-accent/20 transition-all hover:scale-105 active:scale-95",children:e.jsx(je,{size:16})}),t.role==="teacher"&&e.jsx("button",{onClick:()=>Re(t),title:"Права на предметы",className:"p-2 rounded-lg bg-gaming-primary/10 border border-gaming-primary/30 text-gaming-primary hover:bg-gaming-primary/20 transition-all hover:scale-105 active:scale-95",children:e.jsx(at,{size:16})}),j&&e.jsx("button",{onClick:()=>De(t),title:"Удалить пользователя",className:"p-2 rounded-lg bg-red-500/10 border border-red-500/30 text-red-500 hover:bg-red-500/20 transition-all hover:scale-105 active:scale-95",children:e.jsx(we,{size:16})})]})})})]},t.id))})]})}),he.length===0&&e.jsx("div",{className:"p-8 text-center text-gaming-textMuted",children:"Пользователи не найдены"})]}),z>1&&e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-6",children:[e.jsx("button",{onClick:()=>L(t=>Math.max(1,t-1)),disabled:v===1||$,className:"p-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-white",children:e.jsx(st,{size:20})}),e.jsxs("span",{className:"text-gaming-textMuted",children:["Страница ",e.jsx("span",{className:"text-white font-bold",children:v})," из ",z]}),e.jsx("button",{onClick:()=>L(t=>Math.min(z,t+1)),disabled:v===z||$,className:"p-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-white",children:e.jsx(rt,{size:20})})]})]}):e.jsxs("div",{className:"animate-fade-in max-w-2xl",children:[e.jsxs("div",{className:"bg-gaming-card border border-white/10 rounded-2xl p-6 mb-8",children:[e.jsxs("h2",{className:"text-xl font-heading font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(lt,{size:22,className:"text-gaming-accent"}),"Добавить новый филиал"]}),e.jsxs("form",{onSubmit:Te,className:"flex gap-4",children:[e.jsx("input",{type:"text",placeholder:"Название филиала (например: Душанбе, Худжанд)",value:M,onChange:t=>te(t.target.value),className:"flex-1 bg-black/30 border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-gaming-accent transition-colors"}),e.jsx("button",{type:"submit",disabled:ae||!M.trim(),className:"px-6 py-3 bg-gradient-to-r from-gaming-accent to-pink-500 text-white rounded-xl font-medium hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-gaming-accent/20 flex items-center gap-2",children:ae?e.jsx(u,{size:18,className:"animate-spin"}):"Добавить"})]})]}),e.jsx("div",{className:"bg-gaming-card border border-white/5 rounded-2xl overflow-hidden backdrop-blur-xl",children:_e?e.jsx("div",{className:"flex justify-center p-12",children:e.jsx(u,{className:"animate-spin text-gaming-accent",size:32})}):I.length===0?e.jsx("div",{className:"p-12 text-center text-gaming-textMuted",children:"Нет филиалов. Создайте первый филиал выше."}):e.jsx("ul",{className:"divide-y divide-white/5",children:I.map(t=>e.jsxs("li",{className:"flex items-center justify-between p-4 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gaming-accent/10 flex items-center justify-center border border-gaming-accent/20",children:e.jsx(pe,{className:"text-gaming-accent",size:20})}),e.jsx("span",{className:"font-medium text-white text-lg",children:t.name})]}),e.jsx("button",{onClick:()=>$e(t.id,t.name),disabled:q===t.id,className:"p-2 rounded-lg bg-red-500/10 border border-red-500/30 text-red-500 hover:bg-red-500/20 transition-all",title:"Удалить филиал",children:q===t.id?e.jsx(u,{size:18,className:"animate-spin"}):e.jsx(we,{size:18})})]},t.id))})})]}),Se&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>y(!1)}),e.jsxs("div",{className:"relative bg-gaming-card border border-white/10 rounded-2xl p-6 w-full max-w-md shadow-2xl shadow-gaming-primary/10 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-heading font-bold text-white flex items-center gap-2",children:[e.jsx(W,{size:22,className:"text-gaming-primary"}),"Добавить пользователя"]}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-white transition-colors p-1",children:e.jsx(B,{size:20})})]}),ie&&e.jsx("div",{className:"mb-4 p-3 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:ie}),ne&&e.jsx("div",{className:"mb-4 p-3 rounded-xl bg-green-500/10 border border-green-500/30 text-green-400 text-sm",children:ne}),e.jsxs("form",{onSubmit:qe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"ФИО"}),e.jsx("input",{type:"text",value:r.full_name,onChange:t=>d({...r,full_name:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:"Иванов Иван Иванович"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:r.email,onChange:t=>d({...r,email:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Пароль *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:R?"text":"password",required:!0,minLength:6,value:r.password,onChange:t=>d({...r,password:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 pr-12 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:"Минимум 6 символов"}),e.jsx("button",{type:"button",onClick:()=>ke(!R),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:R?e.jsx(it,{size:18}):e.jsx(nt,{size:18})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Роль"}),e.jsx("select",{value:r.role,onChange:t=>d({...r,role:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:Z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),r.role==="teacher"&&e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Предмет"}),e.jsxs("select",{value:r.subject,onChange:t=>d({...r,subject:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:"Выберите предмет"}),k.map(t=>{var a;return e.jsx("option",{value:t,children:((a=P[t])==null?void 0:a[C])||t},t)})]})]}),r.role==="student"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Класс"}),e.jsxs("select",{value:r.grade,onChange:t=>d({...r,grade:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:"Выберите..."}),[11,10,9,8,7,6,5].map(t=>e.jsxs("option",{value:t,children:[t," класс"]},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Язык"}),e.jsxs("select",{value:r.language,onChange:t=>d({...r,language:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"tj",children:"Тоҷикӣ"}),e.jsx("option",{value:"ru",children:"Русский"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Прикрепить к классу (Опционально)"}),e.jsxs("select",{value:r.class_id,onChange:t=>d({...r,class_id:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:"Не прикреплять"}),Ce.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"flex-1 py-2.5 px-4 rounded-xl border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white transition-all",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:re,className:"flex-1 py-2.5 px-4 rounded-xl bg-gradient-to-r from-gaming-primary to-gaming-purple text-white font-medium hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:re?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:18,className:"animate-spin"}),"Создание..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:18}),"Создать"]})})]})]})]})]}),Ee&&p&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>_(!1)}),e.jsxs("div",{className:"relative bg-gaming-card border border-white/10 rounded-2xl p-6 w-full max-w-lg shadow-2xl shadow-gaming-primary/10 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-heading font-bold text-white flex items-center gap-2",children:[e.jsx(je,{size:22,className:"text-gaming-primary"}),"Права на предметы"]}),e.jsx("p",{className:"text-sm text-gaming-textMuted mt-1",children:p.full_name||p.email})]}),e.jsx("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-white transition-colors p-1",children:e.jsx(B,{size:20})})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-1",children:ue.map(t=>{var a;return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${t.can_edit?"border-gaming-primary/50 bg-gaming-primary/10":"border-white/5 bg-white/5 hover:bg-white/10"}`,children:[e.jsx("input",{type:"checkbox",checked:t.can_edit,onChange:()=>Oe(t.subject_id),className:"w-5 h-5 rounded border-white/20 bg-black/30 text-gaming-primary focus:ring-gaming-primary focus:ring-offset-0 cursor-pointer"}),e.jsx("span",{className:`font-medium ${t.can_edit?"text-white":"text-gray-400"}`,children:((a=P[t.subject_id])==null?void 0:a[C])||t.subject_id}),t.can_edit&&e.jsx("span",{className:"ml-auto text-xs text-gaming-primary bg-gaming-primary/10 px-2 py-0.5 rounded-full",children:"Редактирование"})]},t.subject_id)})}),e.jsxs("div",{className:"flex gap-3 pt-4 mt-4 border-t border-white/5",children:[e.jsx("button",{type:"button",onClick:()=>_(!1),className:"flex-1 py-2.5 px-4 rounded-xl border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white transition-all",children:"Отмена"}),e.jsx("button",{onClick:Je,disabled:A,className:"flex-1 py-2.5 px-4 rounded-xl bg-gradient-to-r from-gaming-primary to-gaming-purple text-white font-medium hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:A?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:18,className:"animate-spin"}),"Сохранение..."]}):"Сохранить"})]})]})]}),Me&&i&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>N(!1)}),e.jsxs("div",{className:"relative bg-gaming-card border border-white/10 rounded-2xl p-6 w-full max-w-md shadow-2xl shadow-gaming-primary/10 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-heading font-bold text-white flex items-center gap-2",children:[e.jsx(fe,{size:22,className:"text-blue-500"}),"Редактировать профиль"]}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-white transition-colors p-1",children:e.jsx(B,{size:20})})]}),oe&&e.jsx("div",{className:"mb-4 p-3 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:oe}),e.jsxs("form",{onSubmit:Fe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"ФИО"}),e.jsx("input",{type:"text",value:i.full_name||"",onChange:t=>b({...i,full_name:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Роль"}),e.jsx("select",{value:i.role||"user",onChange:t=>b({...i,role:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:Z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),i.role==="teacher"&&e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Предмет"}),e.jsxs("select",{value:i.subject||"",onChange:t=>b({...i,subject:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:"Без предмета"}),k.map(t=>{var a;return e.jsx("option",{value:t,children:((a=P[t])==null?void 0:a[C])||t},t)})]})]}),i.role==="student"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Класс"}),e.jsxs("select",{value:i.grade||"",onChange:t=>b({...i,grade:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:"Не указан"}),[11,10,9,8,7,6,5].map(t=>e.jsxs("option",{value:t,children:[t," класс"]},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:"Язык"}),e.jsxs("select",{value:i.language||"tj",onChange:t=>b({...i,language:t.target.value}),className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"tj",children:"Тоҷикӣ"}),e.jsx("option",{value:"ru",children:"Русский"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>N(!1),className:"flex-1 py-2.5 px-4 rounded-xl border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white transition-all",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:de,className:"flex-1 py-2.5 px-4 rounded-xl bg-gradient-to-r from-blue-600 to-blue-400 text-white font-medium hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:de?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:18,className:"animate-spin"}),"Сохранение..."]}):"Сохранить"})]})]})]})]}),Ue&&f&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gaming-card border border-white/10 rounded-3xl p-8 max-w-md w-full relative animate-fade-in-up",children:[e.jsx("button",{onClick:()=>U(!1),className:"absolute top-6 right-6 text-gray-400 hover:text-white transition-colors",children:e.jsx(B,{size:24})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Предметы ученика"}),e.jsxs("p",{className:"text-gaming-textMuted mb-6",children:[" ",f.full_name||f.email]}),e.jsx("div",{className:"space-y-2 mb-8 max-h-[50vh] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent",children:k.map(t=>{var n;const a=J.includes(t),s=((n=P[t])==null?void 0:n[C])||t;return e.jsxs("div",{onClick:()=>Ge(t),className:`flex items-center justify-between p-4 rounded-xl cursor-pointer border transition-colors ${a?"bg-gaming-primary/20 border-gaming-primary/50 text-white":"bg-black/30 border-white/5 text-gray-400 hover:border-white/20"}`,children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"font-medium",children:s})}),a&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-gaming-primary flex items-center justify-center",children:e.jsx(ve,{size:14,className:"text-white"})})]},t)})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>U(!1),className:"px-6 py-2 rounded-xl border border-white/10 text-white hover:bg-white/5 transition-colors",children:"Отмена"}),e.jsx("button",{onClick:Qe,disabled:A,className:"bg-gaming-primary hover:bg-gaming-primary-hover text-white px-6 py-2 rounded-xl transition-colors disabled:opacity-50",children:A?"Сохранение...":"Сохранить"})]})]})})]})};export{ft as default};
