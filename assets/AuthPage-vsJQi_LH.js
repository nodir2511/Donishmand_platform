import{j as e}from"./editor-y_DXvsmM.js";import{r as u,u as q,c as R,L as z}from"./vendor-DfgOC3sD.js";import{s as p}from"./index-CZ7BpQlM.js";import{u as D,S as M,W as N,a3 as T,a4 as C,$ as A,E as _,k as I,a5 as B,A as F}from"./ui-DqTeed5j.js";import"./supabase-CQnWzhEg.js";const H=()=>{const{t:r,i18n:P}=D(),o=P.resolvedLanguage==="ru",[s,S]=u.useState(!0),[x,k]=u.useState(!1),[m,b]=u.useState(!1),[w,f]=u.useState(null),j=q(),L=R(),[t,i]=u.useState({email:"",password:"",confirmPassword:"",fullName:"",birthDate:"",phone:"",role:"student",language:"tj",grade:"1",school:"",branch:"",group:"",subject:""}),y=a=>new Promise((d,g)=>setTimeout(()=>g(new Error("Request timed out")),a)),E=async a=>{var d,g,v;a.preventDefault(),b(!0),f(null);try{if(s){const{data:c,error:n}=await Promise.race([p.auth.signInWithPassword({email:t.email,password:t.password}),y(1e4)]);if(n)throw n;const l=((g=(d=L.state)==null?void 0:d.from)==null?void 0:g.pathname)||"/";j(l,{replace:!0})}else{if(t.password!==t.confirmPassword)throw new Error("Пароли не совпадают");if(t.password.length<6)throw new Error("Пароль должен быть не менее 6 символов");const{data:c,error:n}=await Promise.race([p.auth.signUp({email:t.email,password:t.password,options:{data:{full_name:t.fullName,role:t.role}}}),y(1e4)]);if(n)throw n;if(c.user){const l={birth_date:t.birthDate||null,phone:t.phone||null,branch:t.branch||null,updated_at:new Date().toISOString()};t.role==="student"&&(l.school=t.school||null,l.grade=t.grade?parseInt(t.grade):null,l.group_name=t.group||null,l.language=t.language||"tj"),t.role==="teacher"&&(l.subject=t.subject||null);const{error:h}=await p.from("profiles").update(l).eq("id",c.user.id);h&&(console.error("Ошибка обновления профиля:",h),(h.code==="PGRST116"||(v=h.details)!=null&&v.includes("0 rows"))&&(console.warn("Профиль не найден, создаем вручную (fallback)..."),await p.from("profiles").insert({id:c.user.id,full_name:t.fullName,role:t.role,email:t.email,...l}))),j("/")}}}catch(c){console.error("Auth error:",c);let n=c.message;n==="Invalid login credentials"?n=o?"Неверный email или пароль":"Email ё парол нодуруст":n==="Request timed out"?n=o?"Превышено время ожидания. Проверьте интернет.":"Вақти интизорӣ гузашт. Интернетро санҷед.":n.includes("rate limit")&&(n=o?"Слишком много попыток. Подождите 10-15 минут и попробуйте снова.":"Кӯшишҳо аз ҳад зиёд. 10-15 дақиқа интизор шавед ва боз кӯшиш кунед."),f(n)}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden pt-20 pb-10 px-4",children:[e.jsx("div",{className:"absolute top-0 right-0 w-[600px] h-[600px] bg-gaming-primary/20 rounded-full blur-[120px] pointer-events-none translate-x-1/3 -translate-y-1/3 animate-pulse-slow"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[500px] h-[500px] bg-gaming-pink/10 rounded-full blur-[100px] pointer-events-none -translate-x-1/3 translate-y-1/3 animate-pulse-slow"}),e.jsxs("div",{className:"w-full max-w-2xl relative z-10 animate-fade-in-up",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsxs(z,{to:"/",className:"inline-flex items-center gap-3 group",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-gaming-primary to-gaming-pink rounded-2xl flex items-center justify-center shadow-lg shadow-gaming-primary/20 group-hover:scale-105 transition-transform duration-300",children:e.jsx(M,{className:"text-white w-7 h-7"})}),e.jsx("span",{className:"font-bold text-3xl tracking-tight text-white",children:"Donishmand"})]})}),e.jsxs("div",{className:"glass-panel p-8 rounded-3xl border border-white/20 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-gaming-primary via-gaming-accent to-gaming-pink opacity-50"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2 text-center",children:r(s?"authLoginTitle":"authRegisterTitle")}),e.jsx("p",{className:"text-white/60 text-center mb-8 text-sm",children:s?o?"Войдите, чтобы продолжить обучение":"Барои идомаи таълим ворид шавед":o?"Присоединяйтесь к лучшей платформе":"Ба беҳтарин платформа ҳамроҳ шавед"}),w&&e.jsx("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-sm text-center animate-shake",children:w}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[!s&&e.jsxs("div",{className:"flex bg-gaming-bg/50 p-1 rounded-xl mb-6 border border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>i({...t,role:"student"}),className:`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${t.role==="student"?"bg-gaming-card shadow-lg text-white border border-white/10":"text-gaming-textMuted hover:text-white"}`,children:r("authRoleStudent")}),e.jsx("button",{type:"button",onClick:()=>i({...t,role:"teacher"}),className:`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${t.role==="teacher"?"bg-gaming-card shadow-lg text-white border border-white/10":"text-gaming-textMuted hover:text-white"}`,children:r("authRoleTeacher")})]}),!s&&e.jsxs("div",{className:"space-y-1.5 animate-fade-in-up",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authFullName")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/60 group-focus-within:text-gaming-primary transition-colors",children:e.jsx(N,{size:20})}),e.jsx("input",{type:"text",value:t.fullName,onChange:a=>i({...t,fullName:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 pl-12 pr-4 text-white placeholder-white/50 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",placeholder:o?"Эшматов Тошмат":"Алиев Вали",required:!0,pattern:"^[А-Яа-яЁё\\s]+$",title:r("authErrCyrillic")})]})]}),!s&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 animate-fade-in-up delay-[50ms]",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authBirthDate")}),e.jsx("input",{type:"date",value:t.birthDate,onChange:a=>i({...t,birthDate:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 px-4 text-white focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans [color-scheme:dark]",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authPhone")}),e.jsx("input",{type:"tel",value:t.phone,onChange:a=>i({...t,phone:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 px-4 text-white placeholder-white/50 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",placeholder:"+992 00 000 0000",required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authEmail")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/60 group-focus-within:text-gaming-primary transition-colors",children:e.jsx(T,{size:20})}),e.jsx("input",{type:"email",value:t.email,onChange:a=>i({...t,email:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 pl-12 pr-4 text-white placeholder-white/50 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",placeholder:"name@example.com",required:!0})]})]}),!s&&t.role==="student"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 animate-fade-in-up delay-[100ms]",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authLanguage")}),e.jsxs("select",{value:t.language,onChange:a=>i({...t,language:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 px-4 text-white focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans appearance-none cursor-pointer",children:[e.jsx("option",{value:"tj",children:r("authLangTj")}),e.jsx("option",{value:"ru",children:r("authLangRu")})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authGrade")}),e.jsx("select",{value:t.grade,onChange:a=>i({...t,grade:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 px-4 text-white focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans appearance-none cursor-pointer",children:[...Array(11)].map((a,d)=>e.jsx("option",{value:d+1,children:d+1},d+1))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 animate-fade-in-up delay-[150ms]",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authSchool")}),e.jsx("input",{type:"text",value:t.school,onChange:a=>i({...t,school:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 px-4 text-white placeholder-white/50 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",placeholder:"№1",required:t.role==="student"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-gaming-textMuted ml-1",children:r("authBranch")}),e.jsx("input",{type:"text",value:t.branch,onChange:a=>i({...t,branch:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl py-3.5 px-4 text-white placeholder-white/20 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",required:t.role==="student"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-gaming-textMuted ml-1",children:r("authGroup")}),e.jsx("input",{type:"text",value:t.group,onChange:a=>i({...t,group:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl py-3.5 px-4 text-white placeholder-white/20 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",required:t.role==="student"})]})]})]}),!s&&t.role==="teacher"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 animate-fade-in-up delay-[100ms]",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authSubject")}),e.jsxs("select",{value:t.subject||"tj-lang",onChange:a=>i({...t,subject:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 px-4 text-white focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans appearance-none cursor-pointer",children:[e.jsx("option",{value:"tj-lang",children:"Таджикский язык"}),e.jsx("option",{value:"math",children:"Математика"}),e.jsx("option",{value:"phys",children:"Физика"}),e.jsx("option",{value:"chem",children:"Химия"}),e.jsx("option",{value:"bio",children:"Биология"}),e.jsx("option",{value:"geo",children:"География"}),e.jsx("option",{value:"hist",children:"История"}),e.jsx("option",{value:"eng",children:"Английский"}),e.jsx("option",{value:"lit",children:"Литература"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-white/60 ml-1",children:r("authBranch")}),e.jsx("input",{type:"text",value:t.branch,onChange:a=>i({...t,branch:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/20 rounded-xl py-3.5 px-4 text-white placeholder-white/50 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",required:t.role==="teacher"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-gaming-textMuted ml-1",children:r("authPassword")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gaming-textMuted group-focus-within:text-gaming-primary transition-colors",children:e.jsx(C,{size:20})}),e.jsx("input",{type:x?"text":"password",value:t.password,onChange:a=>i({...t,password:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl py-3.5 pl-12 pr-12 text-white placeholder-white/20 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",onClick:()=>k(!x),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gaming-textMuted hover:text-white transition-colors",children:x?e.jsx(A,{size:18}):e.jsx(_,{size:18})})]})]}),!s&&e.jsxs("div",{className:"space-y-1.5 animate-fade-in-up delay-[200ms]",children:[e.jsx("label",{className:"text-sm font-medium text-gaming-textMuted ml-1",children:r("authConfirmPassword")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gaming-textMuted group-focus-within:text-gaming-primary transition-colors",children:e.jsx(C,{size:20})}),e.jsx("input",{type:"password",value:t.confirmPassword,onChange:a=>i({...t,confirmPassword:a.target.value}),className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl py-3.5 pl-12 pr-4 text-white placeholder-white/20 focus:outline-none focus:border-gaming-primary/50 focus:ring-1 focus:ring-gaming-primary/50 transition-all font-sans",placeholder:"••••••••",required:!0})]})]}),s&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"text-xs text-gaming-primary hover:text-gaming-accent transition-colors font-medium",children:r("authForgotPass")})}),e.jsxs("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-gaming-primary to-gaming-pink hover:opacity-90 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-gaming-primary/25 active:scale-[0.98] transition-all flex items-center justify-center gap-2 group mt-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[m?e.jsx(I,{size:20,className:"animate-spin"}):s?e.jsx(B,{size:20}):e.jsx(N,{size:20}),m?o?"Обработка...":" коркард...":r(s?"authLoginBtn":"authRegisterBtn"),!m&&e.jsx(F,{size:18,className:"group-hover:translate-x-1 transition-transform"})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-white/5 text-center",children:[e.jsx("p",{className:"text-gaming-textMuted text-sm mb-3",children:r(s?"authNoAccount":"authHasAccount")}),e.jsx("button",{onClick:()=>{S(!s),f(null)},className:"text-white font-semibold hover:text-gaming-accent transition-colors text-sm px-4 py-2 rounded-lg hover:bg-white/5 border border-transparent hover:border-white/10",children:r(s?"authSwitchToRegister":"authSwitchToLogin")})]})]})]})]})};export{H as default};
