const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LessonContentEditor-DTM4gBfr.js","assets/editor-y_DXvsmM.js","assets/vendor-DfgOC3sD.js","assets/ui-DqTeed5j.js","assets/katex-G9EdgA5J.js","assets/index-CZ7BpQlM.js","assets/supabase-CQnWzhEg.js","assets/index-EYPw-eFr.css","assets/useDebounce-DE7P2URC.js","assets/SyllabusContext-Co6vfvkw.js"])))=>i.map(i=>d[i]);
import{A as le,S as dt,a as D,_ as mt}from"./index-CZ7BpQlM.js";import{u as xt,a as Me,j as t,D as ut,c as gt,S as je,v as be,b as ve,s as pt,K as ht,P as ft,d as Se,C as we}from"./editor-y_DXvsmM.js";import{u as jt,r as x,R as bt}from"./vendor-DfgOC3sD.js";import{i as B}from"./SyllabusContext-Co6vfvkw.js";import{u as vt}from"./useDebounce-DE7P2URC.js";import{u as Ne,q as yt,k as Tt,x as St,C as ye,y as wt,z as Nt,D as ce,o as Ct,g as Ee,I as de,T as Te,J as ze,K as Pe,S as Ae,N as Ce,V as It,F as Oe,v as kt,p as Lt}from"./ui-DqTeed5j.js";const Rt="https://translate.googleapis.com/translate_a/single",Fe={раздел:"бахш",тема:"мавзӯъ",урок:"дарс",тест:"тест",вопрос:"савол",ответ:"ҷавоб",правильный:"дуруст",неправильный:"нодуруст",введение:"муқаддима",заключение:"хулоса",пример:"мисол",задача:"масъала",решение:"ҳал",формула:"формула",определение:"таъриф",теорема:"теорема",доказательство:"исбот",свойство:"хосият",правило:"қоида",упражнение:"машқ","домашнее задание":"вазифаи хонагӣ","контрольная работа":"кори назоратӣ",глава:"боб",параграф:"параграф",страница:"саҳифа",рисунок:"расм",таблица:"ҷадвал",график:"график",диаграмма:"диаграмма",число:"адад",цифра:"рақам",сумма:"ҷамъ",разность:"тафовут",произведение:"ҳосил",частное:"ҳосили тақсим",дробь:"касрс",процент:"фоиз",уравнение:"муодила",неравенство:"нобаробарӣ",функция:"функсия",переменная:"тағйирёбанда",константа:"доимӣ",точка:"нуқта",линия:"хат",прямая:"хатти рост",отрезок:"порча",луч:"нимхат",угол:"кунҷ",треугольник:"секунҷа",квадрат:"мураббаъ",прямоугольник:"росткунҷа",круг:"даврагӣ",окружность:"давра",площадь:"масоҳат",периметр:"периметр",объем:"ҳаҷм",длина:"дарозӣ",ширина:"паҳнӣ",высота:"баландӣ",математика:"математика",алгебра:"алгебра",геометрия:"геометрия",физика:"физика",химия:"химия",биология:"биология",история:"таърих",география:"география",литература:"адабиёт","русский язык":"забони русӣ","таджикский язык":"забони тоҷикӣ","английский язык":"забони англисӣ",информатика:"информатика"},_t=Object.entries(Fe).reduce((n,[b,p])=>(n[p]=b,n),{}),Mt=(n,b="ru",p="tj")=>{if(!n)return"";let S=n.toLowerCase();const y=Object.entries(b==="ru"&&p==="tj"||b==="ru"&&p==="tg"?Fe:_t).sort((u,f)=>f[0].length-u[0].length);for(const[u,f]of y){const k=new RegExp(u,"gi");S=S.replace(k,f)}return S.charAt(0).toUpperCase()+S.slice(1)},Et=async(n,b="ru",p="tg")=>{try{const S=`${Rt}?client=gtx&sl=${b}&tl=${p}&dt=t&q=${encodeURIComponent(n)}`,h=await(await fetch(S)).json();if(h&&h[0])return h[0].map(y=>y[0]).join("");throw new Error("Invalid response")}catch(S){return console.warn("Google Translate API failed, using dictionary:",S),null}},P=async(n,b="ru",p="tj")=>{if(!n||!n.trim())return"";const h=await Et(n,b==="tj"?"tg":b,p==="tj"?"tg":p);return h||Mt(n,b,p)},zt=bt.lazy(()=>mt(()=>import("./LessonContentEditor-DTM4gBfr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Je=[{id:"video",icon:It,label:"creator.video"},{id:"text",icon:Oe,label:"creator.text"},{id:"test",icon:kt,label:"creator.test"},{id:"presentation",icon:Lt,label:"creator.presentation"}],De="donishmand_creator_syllabus",At=({section:n,sectionIndex:b,children:p,onDelete:S})=>{const{attributes:o,listeners:h,setNodeRef:y,transform:u,transition:f,isDragging:k}=Se({id:n.id}),I={transform:we.Transform.toString(u),transition:f,opacity:k?.5:1};return t.jsx("div",{ref:y,style:I,className:"bg-gaming-bg/30 rounded-2xl border border-white/5 overflow-hidden",children:t.jsxs("div",{className:"flex items-center p-4",children:[t.jsx("div",{...o,...h,className:"cursor-grab mr-3 text-gaming-textMuted hover:text-white",children:t.jsx(Ce,{size:18})}),p]})})},Dt=({topic:n,topicIndex:b,sectionIndex:p,children:S})=>{const{attributes:o,listeners:h,setNodeRef:y,transform:u,transition:f,isDragging:k}=Se({id:n.id}),I={transform:we.Transform.toString(u),transition:f,opacity:k?.5:1};return t.jsx("div",{ref:y,style:I,className:"bg-gaming-card/40 rounded-xl border border-white/5 overflow-hidden",children:t.jsxs("div",{className:"flex items-center p-3",children:[t.jsx("div",{...o,...h,className:"cursor-grab mr-2 text-gaming-textMuted hover:text-white",children:t.jsx(Ce,{size:16})}),S]})})},Pt=({lesson:n,lessonIndex:b,sectionIndex:p,topicIndex:S,onDelete:o,onEdit:h,getLessonIcon:y})=>{var F,H,Q,J,X,G;const{t:u,i18n:f}=Ne(),k=f.resolvedLanguage||"ru",{attributes:I,listeners:z,setNodeRef:K,transform:O,transition:L,isDragging:M}=Se({id:n.id}),g=[];n.content&&(((F=n.content.video)!=null&&F.url||(H=n.content.video)!=null&&H.urlTj)&&g.push("video"),((((Q=n.content.slidesRu)==null?void 0:Q.length)||0)>0||(((J=n.content.slidesTj)==null?void 0:J.length)||0)>0)&&g.push("presentation"),(((G=(X=n.content.test)==null?void 0:X.questions)==null?void 0:G.length)||0)>0&&g.push("test"),(n.content.textRu||n.content.textTj)&&g.push("text")),g.length===0&&g.push(n.type||"text");const me={transform:we.Transform.toString(O),transition:L,opacity:M?.5:1};return t.jsxs("div",{ref:K,style:me,className:"flex items-center justify-between gap-3 p-2 bg-gaming-bg/30 rounded-lg border border-white/5",children:[t.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 cursor-pointer group hover:bg-white/5 p-1 rounded-md transition-colors",onClick:()=>h(n),title:u("creator.clickToEdit"),children:[t.jsx("div",{...I,...z,className:"cursor-grab text-gaming-textMuted hover:text-white shrink-0",onClick:T=>T.stopPropagation(),children:t.jsx(Ce,{size:14})}),t.jsx("div",{className:"flex gap-1 shrink-0",children:g.map(T=>{var A;const U=y(T);return t.jsx(U,{size:14,className:"text-gaming-pink/70",title:u((A=Je.find($=>$.id===T))==null?void 0:A.label)},T)})}),t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsxs("span",{className:"text-sm truncate block group-hover:text-gaming-primary transition-colors",children:[p+1,".",S+1,".",b+1,". ",k==="tj"&&n.titleTj||n.title]}),t.jsx("button",{onClick:T=>{T.preventDefault(),T.stopPropagation(),h(n,"rename")},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors shrink-0 sm:opacity-0 group-hover:opacity-100",title:u("creator.editTitle"),children:t.jsx(de,{size:12})})]})]}),t.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t.jsx("button",{onClick:T=>{T.preventDefault(),T.stopPropagation(),h(n,"move")},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors",title:u("creator.move"),children:t.jsx(Pe,{size:14})}),t.jsx("button",{onClick:T=>{T.stopPropagation(),o(n.id)},className:"p-1 text-gaming-textMuted hover:text-red-400 transition-colors",title:u("creator.delete"),children:t.jsx(Te,{size:14})})]})]})},Ot=({item:n,itemType:b,syllabus:p,onMove:S,onClose:o})=>{const{t:h,i18n:y}=Ne(),u=y.resolvedLanguage||"ru",[f,k]=x.useState(n.fromSectionId||""),[I,z]=x.useState(n.fromTopicId||""),K=p.sections||[],O=K.find(g=>g.id===f),L=(O==null?void 0:O.topics)||[],M=()=>{b==="topic"?f&&f!==n.fromSectionId&&S(f):b==="lesson"&&f&&I&&(f!==n.fromSectionId||I!==n.fromTopicId)&&S(f,I)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-white/10 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:h("creator.moveTo")}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm text-gaming-textMuted mb-2",children:h("creator.section")}),t.jsxs("select",{value:f,onChange:g=>{k(g.target.value),z("")},className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white appearance-none",children:[t.jsx("option",{value:"",children:h("creator.selectSection")}),K.map(g=>t.jsx("option",{value:g.id,children:u==="tj"&&g.titleTj||g.title},g.id))]})]}),b==="lesson"&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm text-gaming-textMuted mb-2",children:h("creator.topic")}),t.jsxs("select",{value:I,onChange:g=>z(g.target.value),disabled:!f,className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white appearance-none disabled:opacity-50",children:[t.jsx("option",{value:"",children:h("creator.selectTopic")}),L.map(g=>t.jsx("option",{value:g.id,children:u==="tj"&&g.titleTj||g.title},g.id))]})]}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{onClick:M,className:"flex-1 px-4 py-2 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80",disabled:b==="topic"?!f:!f||!I,children:h("creator.move")}),t.jsx("button",{onClick:o,className:"px-4 py-2 text-gaming-textMuted hover:text-white",children:h("creator.cancel")})]})]})})},Ft=()=>{const{t:n,i18n:b}=Ne(),p=b.resolvedLanguage||"ru",S=jt(),[o,h]=x.useState(()=>{const e=localStorage.getItem("creator_selected_subject");return e&&le.includes(e)?e:le[0]});x.useEffect(()=>{localStorage.setItem("creator_selected_subject",o)},[o]);const[y,u]=x.useState(()=>{const e=localStorage.getItem(De);if(e)try{return JSON.parse(e)}catch{}const i={};return le.forEach(c=>{i[c]={sections:[]}}),i}),[f,k]=x.useState("saved"),I=vt(y,2e3),z=x.useRef(!1);x.useEffect(()=>{if(!I||!z.current)return;(async()=>{k("saving");try{I[o]&&(await D.saveStructure(o,I[o]),B(o)),k("saved")}catch(i){console.error("Ошибка авто-сохранения:",i),k("error")}})()},[I,o]);const[K,O]=x.useState("text"),[L,M]=x.useState(null),[g,me]=x.useState(()=>{try{const e=localStorage.getItem("creator_expanded_sections");return e?JSON.parse(e):{}}catch{return{}}}),[F,H]=x.useState(()=>{try{const e=localStorage.getItem("creator_expanded_topics");return e?JSON.parse(e):{}}catch{return{}}});x.useEffect(()=>{localStorage.setItem("creator_expanded_sections",JSON.stringify(g))},[g]),x.useEffect(()=>{localStorage.setItem("creator_expanded_topics",JSON.stringify(F))},[F]),x.useEffect(()=>{const e=()=>{sessionStorage.setItem("creator_scroll_position",window.scrollY)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),x.useEffect(()=>{const e=sessionStorage.getItem("creator_scroll_position");e&&setTimeout(()=>{window.scrollTo(0,parseInt(e))},100)},[y]);const[Q,J]=x.useState(!1),[X,G]=x.useState(null),[T,U]=x.useState(null),[A,$]=x.useState(""),[xe,Z]=x.useState(""),[V,ee]=x.useState(""),[ue,te]=x.useState(""),[W,se]=x.useState(""),[ge,ne]=x.useState(""),[ie,oe]=x.useState(null),[Ie,pe]=x.useState(null),Ge=xt(Me(ft,{activationConstraint:{distance:8}}),Me(ht,{coordinateGetter:pt})),[Jt,Gt]=x.useState(null),[$t,qt]=x.useState(null);x.useEffect(()=>{localStorage.setItem(De,JSON.stringify(y))},[y]);const he=y[o]||{sections:[]},$e=e=>me(i=>({...i,[e]:!i[e]})),qe=e=>H(i=>({...i,[e]:!i[e]})),Ke=e=>{const{active:i,over:c}=e;if(!c||i.id===c.id)return;const a=i.id,s=c.id,r=a.startsWith("sec_"),d=a.startsWith("top_"),m=a.startsWith("les_");if(r){u(l=>{const w=l[o].sections,N=w.findIndex(v=>v.id===a),j=w.findIndex(v=>v.id===s);return{...l,[o]:{...l[o],sections:ve(w,N,j)}}});return}if(d){u(l=>{const N=l[o].sections.map(j=>{const v=j.topics.map(R=>R.id);if(v.includes(a)&&v.includes(s)){const R=j.topics.findIndex(Y=>Y.id===a),C=j.topics.findIndex(Y=>Y.id===s);return{...j,topics:ve(j.topics,R,C)}}return j});return{...l,[o]:{...l[o],sections:N}}});return}m&&u(l=>{const N=l[o].sections.map(j=>({...j,topics:j.topics.map(v=>{const R=v.lessons.map(C=>C.id);if(R.includes(a)&&R.includes(s)){const C=v.lessons.findIndex(fe=>fe.id===a),Y=v.lessons.findIndex(fe=>fe.id===s);return{...v,lessons:ve(v.lessons,C,Y)}}return v})}));return{...l,[o]:{...l[o],sections:N}}})},Ue=()=>{if(!A.trim())return;const e={id:`sec_${Date.now()}`,title:A.trim(),titleTj:xe.trim()||autoTranslate(A.trim(),"ru","tj"),topics:[]};u(i=>{var c;return{...i,[o]:{...i[o],sections:[...((c=i[o])==null?void 0:c.sections)||[],e]}}}),$(""),Z(""),J(!1)},Ve=e=>{if(!V.trim())return;const i={id:`top_${Date.now()}`,title:V.trim(),titleTj:ue.trim()||autoTranslate(V.trim(),"ru","tj"),lessons:[]};u(c=>({...c,[o]:{...c[o],sections:c[o].sections.map(a=>a.id===e?{...a,topics:[...a.topics,i]}:a)}})),ee(""),te(""),G(null)},We=(e,i)=>{if(!W.trim())return;const c={id:`les_${Date.now()}`,title:W.trim(),titleTj:ge.trim()||autoTranslate(W.trim(),"ru","tj"),type:"text",content:{}};u(a=>({...a,[o]:{...a[o],sections:a[o].sections.map(s=>s.id===e?{...s,topics:s.topics.map(r=>r.id===i?{...r,lessons:[...r.lessons,c]}:r)}:s)}})),se(""),ne(""),O("video"),U(null)},ke=async e=>{var i;if(window.confirm("Вы точно хотите удалить этот раздел и все его уроки? Это действие нельзя отменить."))try{const c=(i=y[o])==null?void 0:i.sections.find(a=>a.id===e);if(c){const a=c.topics.flatMap(s=>s.lessons.map(r=>r.id));a.length>0&&await D.deleteLessons(a).catch(console.error)}u(a=>({...a,[o]:{...a[o],sections:a[o].sections.filter(s=>s.id!==e)}})),B(o)}catch(c){console.error("Ошибка удаления раздела: ",c)}},Ye=async(e,i)=>{var c;if(window.confirm("Вы точно хотите удалить эту тему и все её уроки? Это действие нельзя отменить."))try{const a=(c=y[o])==null?void 0:c.sections.find(r=>r.id===e),s=a==null?void 0:a.topics.find(r=>r.id===i);if(s){const r=s.lessons.map(d=>d.id);r.length>0&&await D.deleteLessons(r).catch(console.error)}u(r=>({...r,[o]:{...r[o],sections:r[o].sections.map(d=>d.id===e?{...d,topics:d.topics.filter(m=>m.id!==i)}:d)}})),B(o)}catch(a){console.error("Ошибка удаления темы: ",a)}},Be=async(e,i,c)=>{if(window.confirm(n("creator.confirmDelete")))try{await D.deleteLesson(c),u(a=>({...a,[o]:{...a[o],sections:a[o].sections.map(s=>s.id===e?{...s,topics:s.topics.map(r=>r.id===i?{...r,lessons:r.lessons.filter(d=>d.id!==c)}:r)}:s)}})),B(o)}catch(a){console.error("Ошибка удаления урока из БД:",a),alert("Не удалось полностью удалить контент урока из базы данных.")}},He=(e,i,c)=>{u(a=>{const s={...a},r={...s[o]};let d=[...r.sections],m=null;return d=d.map((l,w)=>{if(l.id===i){const N=l.topics.findIndex(j=>j.id===e);if(N!==-1)return m=l.topics[N],{...l,topics:l.topics.filter(j=>j.id!==e)}}return l}),m?(d=d.map(l=>l.id===c?{...l,topics:[...l.topics,m]}:l),r.sections=d,s[o]=r,s):a}),M(null)},Qe=(e,i,c,a,s)=>{u(r=>{const d={...r},m=d[o];if(!m)return r;const l=m.sections.find(C=>C.id===i),w=m.sections.find(C=>C.id===a);if(!l||!w)return r;const N=l.topics.find(C=>C.id===c),j=w.topics.find(C=>C.id===s);if(!N||!j)return r;const v=N.lessons.findIndex(C=>C.id===e);if(v===-1)return r;const[R]=N.lessons.splice(v,1);return j.lessons.push(R),d}),M(null)},[q,E]=x.useState(null),Xe=e=>{u(i=>{const c={...i},a=c[o];if(!a)return i;if(e.type==="section"){const s=a.sections.find(r=>r.id===e.id);s&&(s.title=e.titleRu,s.titleTj=e.titleTj)}else if(e.type==="topic"){const s=a.sections.find(d=>d.id===e.sectionId),r=s==null?void 0:s.topics.find(d=>d.id===e.id);r&&(r.title=e.titleRu,r.titleTj=e.titleTj)}else if(e.type==="lesson"){const s=a.sections.find(m=>m.id===e.sectionId),r=s==null?void 0:s.topics.find(m=>m.id===e.topicId),d=r==null?void 0:r.lessons.find(m=>m.id===e.id);d&&(d.title=e.titleRu,d.titleTj=e.titleTj)}return c}),E(null)};x.useEffect(()=>{(async()=>{z.current=!1;try{k("saving");const i=await D.getStructure(o);i&&u(c=>({...c,[o]:i})),k("saved")}catch(i){console.error("Ошибка загрузки данных:",i)}finally{z.current=!0}})()},[o]);const[Kt,Le]=x.useState(!1),Ze=async(e,i,c)=>{Le(!0);try{let a=e;if(!e.content){const s=await D.getLesson(e.id);s&&s.content&&(a={...e,content:s.content},u(r=>({...r,[o]:{...r[o],sections:r[o].sections.map(d=>d.id===i?{...d,topics:d.topics.map(m=>m.id===c?{...m,lessons:m.lessons.map(l=>l.id===e.id?a:l)}:m)}:d)}})))}oe(a),pe({sectionId:i,topicId:c})}catch(a){console.error("Ошибка подготовки урока:",a),alert("Не удалось загрузить урок")}finally{Le(!1)}},[Re,_e]=x.useState(!1),[et,ae]=x.useState(null),tt=async e=>{var i,c,a,s,r,d;if(!(!Ie||!ie)){ae("saving");try{const m={...ie,content:e};let l="text";(((c=(i=m.content.test)==null?void 0:i.questions)==null?void 0:c.length)||0)>0?l="test":(a=m.content.video)!=null&&a.url||(s=m.content.video)!=null&&s.urlTj?l="video":((((r=m.content.slidesRu)==null?void 0:r.length)||0)>0||(((d=m.content.slidesTj)==null?void 0:d.length)||0)>0)&&(l="presentation");const w={...m,type:l};await D.saveLesson(w,o),oe(w),ae("saved"),setTimeout(()=>ae(null),3e3)}catch(m){console.error("Ошибка автосохранения:",m),ae("error")}}},st=async e=>{var i,c,a,s,r,d;_e(!0);try{const{sectionId:m,topicId:l}=Ie;let w="text";(((c=(i=e.content.test)==null?void 0:i.questions)==null?void 0:c.length)||0)>0?w="test":(a=e.content.video)!=null&&a.url||(s=e.content.video)!=null&&s.urlTj?w="video":((((r=e.content.slidesRu)==null?void 0:r.length)||0)>0||(((d=e.content.slidesTj)==null?void 0:d.length)||0)>0)&&(w="presentation");const N={...e,type:w};await D.saveLesson(N,o),B(o),u(j=>({...j,[o]:{...j[o],sections:j[o].sections.map(v=>v.id===m?{...v,topics:v.topics.map(R=>R.id===l?{...R,lessons:R.lessons.map(C=>C.id===e.id?N:C)}:R)}:v)}})),oe(null),pe(null)}catch(m){console.error("Ошибка сохранения урока:",m),alert(n("creator.errorSaveLesson"))}finally{_e(!1)}},[Ut,_]=x.useState({section:!1,topic:!1,lesson:!1}),nt=async()=>{_(e=>({...e,section:!0}));try{const e=await P(A,"ru","tj");Z(e)}finally{_(e=>({...e,section:!1}))}},it=async()=>{_(e=>({...e,topic:!0}));try{const e=await P(V,"ru","tj");te(e)}finally{_(e=>({...e,topic:!1}))}},ot=async()=>{_(e=>({...e,lesson:!0}));try{const e=await P(W,"ru","tj");ne(e)}finally{_(e=>({...e,lesson:!1}))}},at=async()=>{_(e=>({...e,section:!0}));try{const e=await P(xe,"tj","ru");$(e)}finally{_(e=>({...e,section:!1}))}},rt=async()=>{_(e=>({...e,topic:!0}));try{const e=await P(ue,"tj","ru");ee(e)}finally{_(e=>({...e,topic:!1}))}},lt=async()=>{_(e=>({...e,lesson:!0}));try{const e=await P(ge,"tj","ru");se(e)}finally{_(e=>({...e,lesson:!1}))}},re=(e,i,c,a,s,r,d=n("creator.nameRu"),m=n("creator.nameTj"))=>t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("input",{type:"text",value:e,onChange:l=>i(l.target.value),placeholder:d,className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-gaming-primary/50 transition-colors"}),t.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-white/30 font-medium",children:"RU"})]}),t.jsx("button",{type:"button",onClick:r,className:"flex items-center gap-1 px-3 py-3 bg-gaming-primary/20 text-gaming-primary rounded-xl hover:bg-gaming-primary/30 transition-colors text-sm",title:n("creator.translateTjToRu"),children:t.jsx(Ae,{size:16,className:"rotate-180"})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("input",{type:"text",value:c,onChange:l=>a(l.target.value),placeholder:m,className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-gaming-accent/50 transition-colors"}),t.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-white/30 font-medium",children:"TJ"})]}),t.jsx("button",{type:"button",onClick:s,className:"flex items-center gap-1 px-3 py-3 bg-gaming-accent/20 text-gaming-accent rounded-xl hover:bg-gaming-accent/30 transition-colors text-sm",title:n("creator.translateRuToTj"),children:t.jsx(Ae,{size:16})})]})]}),ct=e=>{const i=Je.find(c=>c.id===e);return i?i.icon:Oe};return t.jsxs("div",{className:"min-h-screen bg-gaming-bg font-sans text-white p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 sm:mb-8",children:[t.jsxs("button",{onClick:()=>S("/"),className:"flex items-center gap-2 text-gaming-textMuted hover:text-white transition-colors self-start",children:[t.jsx(yt,{size:20}),n("creator.back")]}),t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-gaming-card/50 border border-white/5 text-sm font-medium",children:[f==="saved"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-gaming-accent",children:"☁️"}),t.jsx("span",{className:"text-gaming-textMuted",children:n("creator.allSaved")})]}),f==="saving"&&t.jsxs(t.Fragment,{children:[t.jsx(Tt,{size:16,className:"text-gaming-primary animate-spin"}),t.jsx("span",{className:"text-white",children:n("creator.saving")})]}),f==="error"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-red-500",children:"❌"}),t.jsx("span",{className:"text-red-400",children:n("creator.saveError")})]})]})]}),t.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold mb-2 flex items-center gap-3",children:[t.jsx(St,{className:"text-gaming-primary",size:32}),n("creator.panelTitle")]}),t.jsx("p",{className:"text-gaming-textMuted text-base sm:text-lg mb-6 sm:mb-8",children:n("creator.panelSubtitle")}),t.jsxs("div",{className:"mb-6 sm:mb-8",children:[t.jsx("label",{className:"block text-sm text-gaming-textMuted mb-2",children:n("creator.selectSubject")}),t.jsxs("div",{className:"relative",children:[t.jsx("select",{value:o,onChange:e=>h(e.target.value),className:"w-full sm:max-w-md bg-gaming-card/60 backdrop-blur-xl border border-white/10 rounded-xl px-4 py-3 text-white appearance-none cursor-pointer focus:outline-none focus:border-gaming-primary/50 transition-colors",children:le.map(e=>{var i;return t.jsx("option",{value:e,className:"bg-gaming-card text-white",children:((i=dt[e])==null?void 0:i[p])||e},e)})}),t.jsx(ye,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gaming-textMuted pointer-events-none",size:20})]})]}),t.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl border border-white/5 rounded-3xl p-4 sm:p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[t.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[t.jsx(wt,{className:"text-gaming-primary",size:24}),n("creator.sections")]}),t.jsxs("button",{onClick:()=>J(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-gaming-primary/20 text-gaming-primary rounded-xl hover:bg-gaming-primary/30 transition-colors active:scale-95 w-full sm:w-auto",children:[t.jsx(Nt,{size:18}),n("creator.addSection")]})]}),Q&&t.jsxs("div",{className:"mb-6 p-4 bg-gaming-bg/50 rounded-2xl border border-gaming-primary/30",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 text-gaming-primary",children:n("creator.newSection")}),re(A,$,xe,Z,nt,at),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsxs("button",{onClick:Ue,className:"flex items-center gap-2 px-4 py-2 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors active:scale-95",children:[t.jsx(ce,{size:16}),n("creator.save")]}),t.jsx("button",{onClick:()=>{J(!1),$(""),Z("")},className:"px-4 py-2 text-gaming-textMuted hover:text-white transition-colors",children:n("creator.cancel")})]})]}),he.sections.length===0?t.jsxs("div",{className:"text-center py-12 text-gaming-textMuted",children:[t.jsx(Ct,{size:48,className:"mx-auto mb-4 opacity-30"}),t.jsx("p",{children:n("creator.noSections")})]}):t.jsx(ut,{sensors:Ge,collisionDetection:gt,onDragEnd:Ke,children:t.jsx(je,{items:he.sections.map(e=>e.id),strategy:be,children:t.jsx("div",{className:"space-y-4",children:he.sections.map((e,i)=>{var c,a;return t.jsx(At,{section:e,sectionIndex:i,lang:p,onDelete:ke,children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between group/row",children:[t.jsxs("div",{className:"flex-1 flex items-center gap-3 cursor-pointer",onClick:()=>$e(e.id),children:[g[e.id]?t.jsx(ye,{size:20,className:"text-gaming-primary"}):t.jsx(Ee,{size:20,className:"text-gaming-textMuted"}),t.jsxs("span",{className:"text-lg font-semibold",children:[i+1,". ",p==="tj"&&e.titleTj||e.title]}),t.jsx("button",{onClick:s=>{s.stopPropagation(),E({type:"section",id:e.id,titleRu:e.title,titleTj:e.titleTj||""})},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors sm:opacity-0 group-hover/row:opacity-100",title:n("creator.editTitle"),children:t.jsx(de,{size:16})}),t.jsxs("span",{className:"text-sm text-gaming-textMuted",children:["(",((c=e.topics)==null?void 0:c.length)||0," ",n("creator.themes"),")"]})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("button",{onClick:s=>{s.stopPropagation(),ke(e.id)},className:"p-2 text-gaming-textMuted hover:text-red-400 transition-colors",children:t.jsx(Te,{size:18})})})]}),g[e.id]&&t.jsxs("div",{className:"mt-4 ml-8",children:[t.jsxs("button",{onClick:()=>G(e.id),className:"flex items-center gap-2 px-3 py-2 mb-4 text-sm text-gaming-accent hover:bg-gaming-accent/10 rounded-lg transition-colors",children:[t.jsx(ze,{size:16}),n("creator.addTopic")]}),X===e.id&&t.jsxs("div",{className:"mb-4 p-4 bg-gaming-card/50 rounded-xl border border-gaming-accent/30",children:[t.jsx("h4",{className:"text-md font-semibold mb-3 text-gaming-accent",children:n("creator.newTopic")}),re(V,ee,ue,te,it,rt),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsxs("button",{onClick:()=>Ve(e.id),className:"flex items-center gap-2 px-3 py-2 bg-gaming-accent text-white rounded-lg hover:bg-gaming-accent/80 transition-colors active:scale-95 text-sm",children:[t.jsx(ce,{size:14}),n("creator.save")]}),t.jsx("button",{onClick:()=>{G(null),ee(""),te("")},className:"px-3 py-2 text-gaming-textMuted hover:text-white transition-colors text-sm",children:n("creator.cancel")})]})]}),((a=e.topics)==null?void 0:a.length)===0?t.jsx("p",{className:"text-sm text-gaming-textMuted",children:n("creator.noTopics")}):t.jsx(je,{items:e.topics.map(s=>s.id),strategy:be,children:t.jsx("div",{className:"space-y-3",children:e.topics.map((s,r)=>{var d,m;return t.jsx(Dt,{topic:s,topicIndex:r,sectionIndex:i,children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between group/row",children:[t.jsxs("div",{className:"flex-1 flex items-center gap-2 cursor-pointer",onClick:()=>qe(s.id),children:[F[s.id]?t.jsx(ye,{size:16,className:"text-gaming-accent"}):t.jsx(Ee,{size:16,className:"text-gaming-textMuted"}),t.jsxs("span",{className:"font-medium",children:[i+1,".",r+1,". ",p==="tj"&&s.titleTj||s.title]}),t.jsx("button",{onClick:l=>{l.stopPropagation(),E({type:"topic",id:s.id,sectionId:e.id,titleRu:s.title,titleTj:s.titleTj||""})},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors sm:opacity-0 group-hover/row:opacity-100",title:n("creator.editTitle"),children:t.jsx(de,{size:14})}),t.jsxs("span",{className:"text-xs text-gaming-textMuted",children:["(",((d=s.lessons)==null?void 0:d.length)||0," ",n("creator.lessons"),")"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),M({type:"topic",id:s.id,fromSectionId:e.id})},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors",title:n("creator.move"),children:t.jsx(Pe,{size:14})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),Ye(e.id,s.id)},className:"p-1 text-gaming-textMuted hover:text-red-400 transition-colors",children:t.jsx(Te,{size:16})})]})]}),F[s.id]&&t.jsxs("div",{className:"mt-3 ml-6",children:[t.jsxs("button",{onClick:()=>U({sectionId:e.id,topicId:s.id}),className:"flex items-center gap-2 px-2 py-1 mb-3 text-xs text-gaming-pink hover:bg-gaming-pink/10 rounded-lg transition-colors",children:[t.jsx(ze,{size:14}),n("creator.addLesson")]}),(T==null?void 0:T.sectionId)===e.id&&(T==null?void 0:T.topicId)===s.id&&t.jsxs("div",{className:"mb-3 p-3 bg-gaming-bg/50 rounded-lg border border-gaming-pink/30",children:[t.jsx("h5",{className:"text-sm font-semibold mb-3 text-gaming-pink",children:n("creator.newLesson")}),re(W,se,ge,ne,ot,lt),t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsxs("button",{onClick:()=>We(e.id,s.id),className:"flex items-center gap-2 px-3 py-2 bg-gaming-pink text-white rounded-lg hover:bg-gaming-pink/80 transition-colors active:scale-95 text-xs",children:[t.jsx(ce,{size:12}),n("creator.save")]}),t.jsx("button",{onClick:()=>{U(null),se(""),ne("")},className:"px-3 py-2 text-gaming-textMuted hover:text-white transition-colors text-xs",children:n("creator.cancel")})]})]}),((m=s.lessons)==null?void 0:m.length)===0?t.jsx("p",{className:"text-xs text-gaming-textMuted",children:n("creator.noLessons")}):t.jsx(je,{items:s.lessons.map(l=>l.id),strategy:be,children:t.jsx("div",{className:"space-y-2",children:s.lessons.map((l,w)=>t.jsx(Pt,{lesson:l,lessonIndex:w,sectionIndex:i,topicIndex:r,lang:p,onDelete:N=>Be(e.id,s.id,N),onEdit:(N,j)=>{j==="move"?M({type:"lesson",id:l.id,fromSectionId:e.id,fromTopicId:s.id}):j==="rename"?E({type:"lesson",id:l.id,sectionId:e.id,topicId:s.id,titleRu:l.title,titleTj:l.titleTj||""}):Ze(N,e.id,s.id)},getLessonIcon:ct},l.id))})})]})]})},s.id)})})})]})]})},e.id)})})})})]}),ie&&t.jsx(zt,{lesson:ie,onSave:st,onAutoSave:tt,autoSaveStatus:et,onClose:()=>{Re||(oe(null),pe(null))},lang:p,isSaving:Re}),L&&t.jsx(Ot,{item:L,itemType:L.type,syllabus:y[o]||{sections:[]},onMove:(e,i)=>{L.type==="topic"&&He(L.id,L.fromSectionId,e),L.type==="lesson"&&Qe(L.id,L.fromSectionId,L.fromTopicId,e,i)},onClose:()=>M(null),lang:p}),q&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-gaming-primary/30 p-6 shadow-2xl animate-in fade-in zoom-in duration-200",children:[t.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[t.jsx(de,{className:"text-gaming-primary",size:24}),n("creator.editTitle")]}),re(q.titleRu,e=>E(i=>({...i,titleRu:e})),q.titleTj,e=>E(i=>({...i,titleTj:e})),async()=>{const e=await P(q.titleRu,"ru","tj");E(i=>({...i,titleTj:e}))},async()=>{const e=await P(q.titleTj,"tj","ru");E(i=>({...i,titleRu:e}))}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsxs("button",{onClick:()=>Xe(q),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors font-medium shadow-lg shadow-gaming-primary/20",children:[t.jsx(ce,{size:18}),n("creator.save")]}),t.jsx("button",{onClick:()=>E(null),className:"px-4 py-3 bg-white/5 text-gaming-textMuted hover:text-white rounded-xl hover:bg-white/10 transition-colors",children:n("creator.cancel")})]})]})})]})},Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Ft},Symbol.toStringTag,{value:"Module"}));export{Xt as C,P as t};
