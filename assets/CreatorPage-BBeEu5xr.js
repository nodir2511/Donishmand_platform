const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LessonContentEditor-BntlcAUS.js","assets/editor-B4b3M6em.js","assets/vendor-DfgOC3sD.js","assets/ui-DAjowxi7.js","assets/katex-G9EdgA5J.js","assets/index-LLMaOK8Q.js","assets/supabase-CQnWzhEg.js","assets/index-DyYqTywm.css","assets/useDebounce-DE7P2URC.js","assets/syllabusService-DKW9fzov.js","assets/SyllabusContext-C3cMxA2S.js"])))=>i.map(i=>d[i]);
import{A as ce,S as ct,_ as dt}from"./index-LLMaOK8Q.js";import{u as mt,a as _e,j as t,D as xt,c as gt,S as fe,v as je,b as be,s as ut,K as pt,P as ht,d as Te,C as Se}from"./editor-B4b3M6em.js";import{u as ft,r as x,R as jt}from"./vendor-DfgOC3sD.js";import{s as D}from"./syllabusService-DKW9fzov.js";import{i as H}from"./SyllabusContext-C3cMxA2S.js";import{u as bt}from"./useDebounce-DE7P2URC.js";import{u as we,p as vt,j as yt,w as Tt,C as ve,x as St,y as wt,z as de,n as Nt,g as Me,D as me,T as ye,I as Ee,J as De,S as ze,K as Ne,V as Ct,F as Pe,t as It,o as kt}from"./ui-DAjowxi7.js";const Lt="https://translate.googleapis.com/translate_a/single",Oe={раздел:"бахш",тема:"мавзӯъ",урок:"дарс",тест:"тест",вопрос:"савол",ответ:"ҷавоб",правильный:"дуруст",неправильный:"нодуруст",введение:"муқаддима",заключение:"хулоса",пример:"мисол",задача:"масъала",решение:"ҳал",формула:"формула",определение:"таъриф",теорема:"теорема",доказательство:"исбот",свойство:"хосият",правило:"қоида",упражнение:"машқ","домашнее задание":"вазифаи хонагӣ","контрольная работа":"кори назоратӣ",глава:"боб",параграф:"параграф",страница:"саҳифа",рисунок:"расм",таблица:"ҷадвал",график:"график",диаграмма:"диаграмма",число:"адад",цифра:"рақам",сумма:"ҷамъ",разность:"тафовут",произведение:"ҳосил",частное:"ҳосили тақсим",дробь:"касрс",процент:"фоиз",уравнение:"муодила",неравенство:"нобаробарӣ",функция:"функсия",переменная:"тағйирёбанда",константа:"доимӣ",точка:"нуқта",линия:"хат",прямая:"хатти рост",отрезок:"порча",луч:"нимхат",угол:"кунҷ",треугольник:"секунҷа",квадрат:"мураббаъ",прямоугольник:"росткунҷа",круг:"даврагӣ",окружность:"давра",площадь:"масоҳат",периметр:"периметр",объем:"ҳаҷм",длина:"дарозӣ",ширина:"паҳнӣ",высота:"баландӣ",математика:"математика",алгебра:"алгебра",геометрия:"геометрия",физика:"физика",химия:"химия",биология:"биология",история:"таърих",география:"география",литература:"адабиёт","русский язык":"забони русӣ","таджикский язык":"забони тоҷикӣ","английский язык":"забони англисӣ",информатика:"информатика"},Rt=Object.entries(Oe).reduce((n,[b,p])=>(n[p]=b,n),{}),_t=(n,b="ru",p="tj")=>{if(!n)return"";let T=n.toLowerCase();const y=Object.entries(b==="ru"&&p==="tj"||b==="ru"&&p==="tg"?Oe:Rt).sort((g,f)=>f[0].length-g[0].length);for(const[g,f]of y){const L=new RegExp(g,"gi");T=T.replace(L,f)}return T.charAt(0).toUpperCase()+T.slice(1)},Mt=async(n,b="ru",p="tg")=>{try{const T=`${Lt}?client=gtx&sl=${b}&tl=${p}&dt=t&q=${encodeURIComponent(n)}`,h=await(await fetch(T)).json();if(h&&h[0])return h[0].map(y=>y[0]).join("");throw new Error("Invalid response")}catch(T){return console.warn("Google Translate API failed, using dictionary:",T),null}},P=async(n,b="ru",p="tj")=>{if(!n||!n.trim())return"";const h=await Mt(n,b==="tj"?"tg":b,p==="tj"?"tg":p);return h||_t(n,b,p)},Et=jt.lazy(()=>dt(()=>import("./LessonContentEditor-BntlcAUS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),Fe=[{id:"video",icon:Ct,label:"creator.video"},{id:"text",icon:Pe,label:"creator.text"},{id:"test",icon:It,label:"creator.test"},{id:"presentation",icon:kt,label:"creator.presentation"}],Ae="donishmand_creator_syllabus",zt=({section:n,sectionIndex:b,children:p,onDelete:T})=>{const{attributes:o,listeners:h,setNodeRef:y,transform:g,transition:f,isDragging:L}=Te({id:n.id}),I={transform:Se.Transform.toString(g),transition:f,opacity:L?.5:1};return t.jsx("div",{ref:y,style:I,className:"bg-gaming-bg/30 rounded-2xl border border-white/5 overflow-hidden",children:t.jsxs("div",{className:"flex items-center p-4",children:[t.jsx("div",{...o,...h,className:"cursor-grab mr-3 text-gaming-textMuted hover:text-white",children:t.jsx(Ne,{size:18})}),p]})})},At=({topic:n,topicIndex:b,sectionIndex:p,children:T})=>{const{attributes:o,listeners:h,setNodeRef:y,transform:g,transition:f,isDragging:L}=Te({id:n.id}),I={transform:Se.Transform.toString(g),transition:f,opacity:L?.5:1};return t.jsx("div",{ref:y,style:I,className:"bg-gaming-card/40 rounded-xl border border-white/5 overflow-hidden",children:t.jsxs("div",{className:"flex items-center p-3",children:[t.jsx("div",{...o,...h,className:"cursor-grab mr-2 text-gaming-textMuted hover:text-white",children:t.jsx(Ne,{size:16})}),T]})})},Dt=({lesson:n,lessonIndex:b,sectionIndex:p,topicIndex:T,onDelete:o,onEdit:h,getLessonIcon:y})=>{var Q,X,$,Z,K,E;const{t:g,i18n:f}=we(),L=f.resolvedLanguage||"ru",{attributes:I,listeners:V,setNodeRef:J,transform:k,transition:M,isDragging:A}=Te({id:n.id}),u=[];n.content&&(((Q=n.content.video)!=null&&Q.url||(X=n.content.video)!=null&&X.urlTj)&&u.push("video"),(((($=n.content.slidesRu)==null?void 0:$.length)||0)>0||(((Z=n.content.slidesTj)==null?void 0:Z.length)||0)>0)&&u.push("presentation"),(((E=(K=n.content.test)==null?void 0:K.questions)==null?void 0:E.length)||0)>0&&u.push("test"),(n.content.textRu||n.content.textTj)&&u.push("text")),u.length===0&&u.push(n.type||"text");const G={transform:Se.Transform.toString(k),transition:M,opacity:A?.5:1};return t.jsxs("div",{ref:J,style:G,className:"flex items-center justify-between gap-3 p-2 bg-gaming-bg/30 rounded-lg border border-white/5",children:[t.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 cursor-pointer group hover:bg-white/5 p-1 rounded-md transition-colors",onClick:()=>h(n),title:g("creator.clickToEdit"),children:[t.jsx("div",{...I,...V,className:"cursor-grab text-gaming-textMuted hover:text-white shrink-0",onClick:C=>C.stopPropagation(),children:t.jsx(Ne,{size:14})}),t.jsx("div",{className:"flex gap-1 shrink-0",children:u.map(C=>{var F;const O=y(C);return t.jsx(O,{size:14,className:"text-gaming-pink/70",title:g((F=Fe.find(W=>W.id===C))==null?void 0:F.label)},C)})}),t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsxs("span",{className:"text-sm truncate block group-hover:text-gaming-primary transition-colors",children:[p+1,".",T+1,".",b+1,". ",L==="tj"&&n.titleTj||n.title]}),t.jsx("button",{onClick:C=>{C.preventDefault(),C.stopPropagation(),h(n,"rename")},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors shrink-0 sm:opacity-0 group-hover:opacity-100",title:g("creator.editTitle"),children:t.jsx(me,{size:12})})]})]}),t.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t.jsx("button",{onClick:C=>{C.preventDefault(),C.stopPropagation(),h(n,"move")},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors",title:g("creator.move"),children:t.jsx(De,{size:14})}),t.jsx("button",{onClick:C=>{C.stopPropagation(),o(n.id)},className:"p-1 text-gaming-textMuted hover:text-red-400 transition-colors",title:g("creator.delete"),children:t.jsx(ye,{size:14})})]})]})},Pt=({item:n,itemType:b,syllabus:p,onMove:T,onClose:o})=>{const{t:h,i18n:y}=we(),g=y.resolvedLanguage||"ru",[f,L]=x.useState(n.fromSectionId||""),[I,V]=x.useState(n.fromTopicId||""),J=p.sections||[],k=J.find(u=>u.id===f),M=(k==null?void 0:k.topics)||[],A=()=>{b==="topic"?f&&f!==n.fromSectionId&&T(f):b==="lesson"&&f&&I&&(f!==n.fromSectionId||I!==n.fromTopicId)&&T(f,I)};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-white/10 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:h("creator.moveTo")}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm text-gaming-textMuted mb-2",children:h("creator.section")}),t.jsxs("select",{value:f,onChange:u=>{L(u.target.value),V("")},className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white appearance-none",children:[t.jsx("option",{value:"",children:h("creator.selectSection")}),J.map(u=>t.jsx("option",{value:u.id,children:g==="tj"&&u.titleTj||u.title},u.id))]})]}),b==="lesson"&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm text-gaming-textMuted mb-2",children:h("creator.topic")}),t.jsxs("select",{value:I,onChange:u=>V(u.target.value),disabled:!f,className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white appearance-none disabled:opacity-50",children:[t.jsx("option",{value:"",children:h("creator.selectTopic")}),M.map(u=>t.jsx("option",{value:u.id,children:g==="tj"&&u.titleTj||u.title},u.id))]})]}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{onClick:A,className:"flex-1 px-4 py-2 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80",disabled:b==="topic"?!f:!f||!I,children:h("creator.move")}),t.jsx("button",{onClick:o,className:"px-4 py-2 text-gaming-textMuted hover:text-white",children:h("creator.cancel")})]})]})})},Ot=()=>{const{t:n,i18n:b}=we(),p=b.resolvedLanguage||"ru",T=ft(),[o,h]=x.useState(()=>{const e=localStorage.getItem("creator_selected_subject");return e&&ce.includes(e)?e:ce[0]});x.useEffect(()=>{localStorage.setItem("creator_selected_subject",o)},[o]);const[y,g]=x.useState(()=>{const e=localStorage.getItem(Ae);if(e)try{return JSON.parse(e)}catch{}const i={};return ce.forEach(c=>{i[c]={sections:[]}}),i}),[f,L]=x.useState("saved"),I=bt(y,2e3);x.useEffect(()=>{if(!I)return;(async()=>{L("saving");try{I[o]&&(await D.saveStructure(o,I[o]),H(o)),L("saved")}catch(i){console.error("Ошибка авто-сохранения:",i),L("error")}})()},[I,o]);const[V,J]=x.useState("text"),[k,M]=x.useState(null),[A,u]=x.useState(()=>{try{const e=localStorage.getItem("creator_expanded_sections");return e?JSON.parse(e):{}}catch{return{}}}),[G,Q]=x.useState(()=>{try{const e=localStorage.getItem("creator_expanded_topics");return e?JSON.parse(e):{}}catch{return{}}});x.useEffect(()=>{localStorage.setItem("creator_expanded_sections",JSON.stringify(A))},[A]),x.useEffect(()=>{localStorage.setItem("creator_expanded_topics",JSON.stringify(G))},[G]),x.useEffect(()=>{const e=()=>{sessionStorage.setItem("creator_scroll_position",window.scrollY)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),x.useEffect(()=>{const e=sessionStorage.getItem("creator_scroll_position");e&&setTimeout(()=>{window.scrollTo(0,parseInt(e))},100)},[y]);const[X,$]=x.useState(!1),[Z,K]=x.useState(null),[E,C]=x.useState(null),[O,F]=x.useState(""),[W,ee]=x.useState(""),[Y,te]=x.useState(""),[xe,se]=x.useState(""),[q,ne]=x.useState(""),[ge,ie]=x.useState(""),[oe,ae]=x.useState(null),[Ce,ue]=x.useState(null),Je=mt(_e(ht,{activationConstraint:{distance:8}}),_e(pt,{coordinateGetter:ut})),[Ft,Jt]=x.useState(null),[Gt,$t]=x.useState(null);x.useEffect(()=>{localStorage.setItem(Ae,JSON.stringify(y))},[y]);const pe=y[o]||{sections:[]},Ge=e=>u(i=>({...i,[e]:!i[e]})),$e=e=>Q(i=>({...i,[e]:!i[e]})),Ke=e=>{const{active:i,over:c}=e;if(!c||i.id===c.id)return;const a=i.id,s=c.id,r=a.startsWith("sec_"),d=a.startsWith("top_"),m=a.startsWith("les_");if(r){g(l=>{const S=l[o].sections,w=S.findIndex(v=>v.id===a),j=S.findIndex(v=>v.id===s);return{...l,[o]:{...l[o],sections:be(S,w,j)}}});return}if(d){g(l=>{const w=l[o].sections.map(j=>{const v=j.topics.map(R=>R.id);if(v.includes(a)&&v.includes(s)){const R=j.topics.findIndex(B=>B.id===a),N=j.topics.findIndex(B=>B.id===s);return{...j,topics:be(j.topics,R,N)}}return j});return{...l,[o]:{...l[o],sections:w}}});return}m&&g(l=>{const w=l[o].sections.map(j=>({...j,topics:j.topics.map(v=>{const R=v.lessons.map(N=>N.id);if(R.includes(a)&&R.includes(s)){const N=v.lessons.findIndex(he=>he.id===a),B=v.lessons.findIndex(he=>he.id===s);return{...v,lessons:be(v.lessons,N,B)}}return v})}));return{...l,[o]:{...l[o],sections:w}}})},Ue=()=>{if(!O.trim())return;const e={id:`sec_${Date.now()}`,title:O.trim(),titleTj:W.trim()||autoTranslate(O.trim(),"ru","tj"),topics:[]};g(i=>{var c;return{...i,[o]:{...i[o],sections:[...((c=i[o])==null?void 0:c.sections)||[],e]}}}),F(""),ee(""),$(!1)},Ve=e=>{if(!Y.trim())return;const i={id:`top_${Date.now()}`,title:Y.trim(),titleTj:xe.trim()||autoTranslate(Y.trim(),"ru","tj"),lessons:[]};g(c=>({...c,[o]:{...c[o],sections:c[o].sections.map(a=>a.id===e?{...a,topics:[...a.topics,i]}:a)}})),te(""),se(""),K(null)},We=(e,i)=>{if(!q.trim())return;const c={id:`les_${Date.now()}`,title:q.trim(),titleTj:ge.trim()||autoTranslate(q.trim(),"ru","tj"),type:"text",content:{}};g(a=>({...a,[o]:{...a[o],sections:a[o].sections.map(s=>s.id===e?{...s,topics:s.topics.map(r=>r.id===i?{...r,lessons:[...r.lessons,c]}:r)}:s)}})),ne(""),ie(""),J("video"),C(null)},Ie=async e=>{var i;if(window.confirm("Вы точно хотите удалить этот раздел и все его уроки? Это действие нельзя отменить."))try{const c=(i=y[o])==null?void 0:i.sections.find(a=>a.id===e);if(c){const a=c.topics.flatMap(s=>s.lessons.map(r=>r.id));a.length>0&&await D.deleteLessons(a).catch(console.error)}g(a=>({...a,[o]:{...a[o],sections:a[o].sections.filter(s=>s.id!==e)}})),H(o)}catch(c){console.error("Ошибка удаления раздела: ",c)}},Ye=async(e,i)=>{var c;if(window.confirm("Вы точно хотите удалить эту тему и все её уроки? Это действие нельзя отменить."))try{const a=(c=y[o])==null?void 0:c.sections.find(r=>r.id===e),s=a==null?void 0:a.topics.find(r=>r.id===i);if(s){const r=s.lessons.map(d=>d.id);r.length>0&&await D.deleteLessons(r).catch(console.error)}g(r=>({...r,[o]:{...r[o],sections:r[o].sections.map(d=>d.id===e?{...d,topics:d.topics.filter(m=>m.id!==i)}:d)}})),H(o)}catch(a){console.error("Ошибка удаления темы: ",a)}},qe=async(e,i,c)=>{if(window.confirm(n("creator.confirmDelete")))try{await D.deleteLesson(c),g(a=>({...a,[o]:{...a[o],sections:a[o].sections.map(s=>s.id===e?{...s,topics:s.topics.map(r=>r.id===i?{...r,lessons:r.lessons.filter(d=>d.id!==c)}:r)}:s)}})),H(o)}catch(a){console.error("Ошибка удаления урока из БД:",a),alert("Не удалось полностью удалить контент урока из базы данных.")}},Be=(e,i,c)=>{g(a=>{const s={...a},r={...s[o]};let d=[...r.sections],m=null;return d=d.map((l,S)=>{if(l.id===i){const w=l.topics.findIndex(j=>j.id===e);if(w!==-1)return m=l.topics[w],{...l,topics:l.topics.filter(j=>j.id!==e)}}return l}),m?(d=d.map(l=>l.id===c?{...l,topics:[...l.topics,m]}:l),r.sections=d,s[o]=r,s):a}),M(null)},He=(e,i,c,a,s)=>{g(r=>{const d={...r},m=d[o];if(!m)return r;const l=m.sections.find(N=>N.id===i),S=m.sections.find(N=>N.id===a);if(!l||!S)return r;const w=l.topics.find(N=>N.id===c),j=S.topics.find(N=>N.id===s);if(!w||!j)return r;const v=w.lessons.findIndex(N=>N.id===e);if(v===-1)return r;const[R]=w.lessons.splice(v,1);return j.lessons.push(R),d}),M(null)},[U,z]=x.useState(null),Qe=e=>{g(i=>{const c={...i},a=c[o];if(!a)return i;if(e.type==="section"){const s=a.sections.find(r=>r.id===e.id);s&&(s.title=e.titleRu,s.titleTj=e.titleTj)}else if(e.type==="topic"){const s=a.sections.find(d=>d.id===e.sectionId),r=s==null?void 0:s.topics.find(d=>d.id===e.id);r&&(r.title=e.titleRu,r.titleTj=e.titleTj)}else if(e.type==="lesson"){const s=a.sections.find(m=>m.id===e.sectionId),r=s==null?void 0:s.topics.find(m=>m.id===e.topicId),d=r==null?void 0:r.lessons.find(m=>m.id===e.id);d&&(d.title=e.titleRu,d.titleTj=e.titleTj)}return c}),z(null)};x.useEffect(()=>{(async()=>{try{L("saving");const i=await D.getStructure(o);i&&g(c=>({...c,[o]:i})),L("saved")}catch(i){console.error("Ошибка загрузки данных:",i)}})()},[o]);const[Kt,ke]=x.useState(!1),Xe=async(e,i,c)=>{ke(!0);try{let a=e;if(!e.content){const s=await D.getLesson(e.id);s&&s.content&&(a={...e,content:s.content},g(r=>({...r,[o]:{...r[o],sections:r[o].sections.map(d=>d.id===i?{...d,topics:d.topics.map(m=>m.id===c?{...m,lessons:m.lessons.map(l=>l.id===e.id?a:l)}:m)}:d)}})))}ae(a),ue({sectionId:i,topicId:c})}catch(a){console.error("Ошибка подготовки урока:",a),alert("Не удалось загрузить урок")}finally{ke(!1)}},[Le,Re]=x.useState(!1),[Ze,re]=x.useState(null),et=async e=>{var i,c,a,s,r,d;if(!(!Ce||!oe)){re("saving");try{const m={...oe,content:e};let l="text";(((c=(i=m.content.test)==null?void 0:i.questions)==null?void 0:c.length)||0)>0?l="test":(a=m.content.video)!=null&&a.url||(s=m.content.video)!=null&&s.urlTj?l="video":((((r=m.content.slidesRu)==null?void 0:r.length)||0)>0||(((d=m.content.slidesTj)==null?void 0:d.length)||0)>0)&&(l="presentation");const S={...m,type:l};await D.saveLesson(S,o),ae(S),re("saved"),setTimeout(()=>re(null),3e3)}catch(m){console.error("Ошибка автосохранения:",m),re("error")}}},tt=async e=>{var i,c,a,s,r,d;Re(!0);try{const{sectionId:m,topicId:l}=Ce;let S="text";(((c=(i=e.content.test)==null?void 0:i.questions)==null?void 0:c.length)||0)>0?S="test":(a=e.content.video)!=null&&a.url||(s=e.content.video)!=null&&s.urlTj?S="video":((((r=e.content.slidesRu)==null?void 0:r.length)||0)>0||(((d=e.content.slidesTj)==null?void 0:d.length)||0)>0)&&(S="presentation");const w={...e,type:S};await D.saveLesson(w,o),H(o),g(j=>({...j,[o]:{...j[o],sections:j[o].sections.map(v=>v.id===m?{...v,topics:v.topics.map(R=>R.id===l?{...R,lessons:R.lessons.map(N=>N.id===e.id?w:N)}:R)}:v)}})),ae(null),ue(null)}catch(m){console.error("Ошибка сохранения урока:",m),alert(n("creator.errorSaveLesson"))}finally{Re(!1)}},[Ut,_]=x.useState({section:!1,topic:!1,lesson:!1}),st=async()=>{_(e=>({...e,section:!0}));try{const e=await P(O,"ru","tj");ee(e)}finally{_(e=>({...e,section:!1}))}},nt=async()=>{_(e=>({...e,topic:!0}));try{const e=await P(Y,"ru","tj");se(e)}finally{_(e=>({...e,topic:!1}))}},it=async()=>{_(e=>({...e,lesson:!0}));try{const e=await P(q,"ru","tj");ie(e)}finally{_(e=>({...e,lesson:!1}))}},ot=async()=>{_(e=>({...e,section:!0}));try{const e=await P(W,"tj","ru");F(e)}finally{_(e=>({...e,section:!1}))}},at=async()=>{_(e=>({...e,topic:!0}));try{const e=await P(xe,"tj","ru");te(e)}finally{_(e=>({...e,topic:!1}))}},rt=async()=>{_(e=>({...e,lesson:!0}));try{const e=await P(ge,"tj","ru");ne(e)}finally{_(e=>({...e,lesson:!1}))}},le=(e,i,c,a,s,r,d=n("creator.nameRu"),m=n("creator.nameTj"))=>t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("input",{type:"text",value:e,onChange:l=>i(l.target.value),placeholder:d,className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-gaming-primary/50 transition-colors"}),t.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-white/30 font-medium",children:"RU"})]}),t.jsx("button",{type:"button",onClick:r,className:"flex items-center gap-1 px-3 py-3 bg-gaming-primary/20 text-gaming-primary rounded-xl hover:bg-gaming-primary/30 transition-colors text-sm",title:n("creator.translateTjToRu"),children:t.jsx(ze,{size:16,className:"rotate-180"})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("input",{type:"text",value:c,onChange:l=>a(l.target.value),placeholder:m,className:"w-full bg-gaming-bg/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-gaming-accent/50 transition-colors"}),t.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-white/30 font-medium",children:"TJ"})]}),t.jsx("button",{type:"button",onClick:s,className:"flex items-center gap-1 px-3 py-3 bg-gaming-accent/20 text-gaming-accent rounded-xl hover:bg-gaming-accent/30 transition-colors text-sm",title:n("creator.translateRuToTj"),children:t.jsx(ze,{size:16})})]})]}),lt=e=>{const i=Fe.find(c=>c.id===e);return i?i.icon:Pe};return t.jsxs("div",{className:"min-h-screen bg-gaming-bg font-sans text-white p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 sm:mb-8",children:[t.jsxs("button",{onClick:()=>T("/"),className:"flex items-center gap-2 text-gaming-textMuted hover:text-white transition-colors self-start",children:[t.jsx(vt,{size:20}),n("creator.back")]}),t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-gaming-card/50 border border-white/5 text-sm font-medium",children:[f==="saved"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-gaming-accent",children:"☁️"}),t.jsx("span",{className:"text-gaming-textMuted",children:n("creator.allSaved")})]}),f==="saving"&&t.jsxs(t.Fragment,{children:[t.jsx(yt,{size:16,className:"text-gaming-primary animate-spin"}),t.jsx("span",{className:"text-white",children:n("creator.saving")})]}),f==="error"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-red-500",children:"❌"}),t.jsx("span",{className:"text-red-400",children:n("creator.saveError")})]})]})]}),t.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold mb-2 flex items-center gap-3",children:[t.jsx(Tt,{className:"text-gaming-primary",size:32}),n("creator.panelTitle")]}),t.jsx("p",{className:"text-gaming-textMuted text-base sm:text-lg mb-6 sm:mb-8",children:n("creator.panelSubtitle")}),t.jsxs("div",{className:"mb-6 sm:mb-8",children:[t.jsx("label",{className:"block text-sm text-gaming-textMuted mb-2",children:n("creator.selectSubject")}),t.jsxs("div",{className:"relative",children:[t.jsx("select",{value:o,onChange:e=>h(e.target.value),className:"w-full sm:max-w-md bg-gaming-card/60 backdrop-blur-xl border border-white/10 rounded-xl px-4 py-3 text-white appearance-none cursor-pointer focus:outline-none focus:border-gaming-primary/50 transition-colors",children:ce.map(e=>{var i;return t.jsx("option",{value:e,className:"bg-gaming-card text-white",children:((i=ct[e])==null?void 0:i[p])||e},e)})}),t.jsx(ve,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gaming-textMuted pointer-events-none",size:20})]})]}),t.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl border border-white/5 rounded-3xl p-4 sm:p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[t.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[t.jsx(St,{className:"text-gaming-primary",size:24}),n("creator.sections")]}),t.jsxs("button",{onClick:()=>$(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-gaming-primary/20 text-gaming-primary rounded-xl hover:bg-gaming-primary/30 transition-colors active:scale-95 w-full sm:w-auto",children:[t.jsx(wt,{size:18}),n("creator.addSection")]})]}),X&&t.jsxs("div",{className:"mb-6 p-4 bg-gaming-bg/50 rounded-2xl border border-gaming-primary/30",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 text-gaming-primary",children:n("creator.newSection")}),le(O,F,W,ee,st,ot),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsxs("button",{onClick:Ue,className:"flex items-center gap-2 px-4 py-2 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors active:scale-95",children:[t.jsx(de,{size:16}),n("creator.save")]}),t.jsx("button",{onClick:()=>{$(!1),F(""),ee("")},className:"px-4 py-2 text-gaming-textMuted hover:text-white transition-colors",children:n("creator.cancel")})]})]}),pe.sections.length===0?t.jsxs("div",{className:"text-center py-12 text-gaming-textMuted",children:[t.jsx(Nt,{size:48,className:"mx-auto mb-4 opacity-30"}),t.jsx("p",{children:n("creator.noSections")})]}):t.jsx(xt,{sensors:Je,collisionDetection:gt,onDragEnd:Ke,children:t.jsx(fe,{items:pe.sections.map(e=>e.id),strategy:je,children:t.jsx("div",{className:"space-y-4",children:pe.sections.map((e,i)=>{var c,a;return t.jsx(zt,{section:e,sectionIndex:i,lang:p,onDelete:Ie,children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between group/row",children:[t.jsxs("div",{className:"flex-1 flex items-center gap-3 cursor-pointer",onClick:()=>Ge(e.id),children:[A[e.id]?t.jsx(ve,{size:20,className:"text-gaming-primary"}):t.jsx(Me,{size:20,className:"text-gaming-textMuted"}),t.jsxs("span",{className:"text-lg font-semibold",children:[i+1,". ",p==="tj"&&e.titleTj||e.title]}),t.jsx("button",{onClick:s=>{s.stopPropagation(),z({type:"section",id:e.id,titleRu:e.title,titleTj:e.titleTj||""})},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors sm:opacity-0 group-hover/row:opacity-100",title:n("creator.editTitle"),children:t.jsx(me,{size:16})}),t.jsxs("span",{className:"text-sm text-gaming-textMuted",children:["(",((c=e.topics)==null?void 0:c.length)||0," ",n("creator.themes"),")"]})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("button",{onClick:s=>{s.stopPropagation(),Ie(e.id)},className:"p-2 text-gaming-textMuted hover:text-red-400 transition-colors",children:t.jsx(ye,{size:18})})})]}),A[e.id]&&t.jsxs("div",{className:"mt-4 ml-8",children:[t.jsxs("button",{onClick:()=>K(e.id),className:"flex items-center gap-2 px-3 py-2 mb-4 text-sm text-gaming-accent hover:bg-gaming-accent/10 rounded-lg transition-colors",children:[t.jsx(Ee,{size:16}),n("creator.addTopic")]}),Z===e.id&&t.jsxs("div",{className:"mb-4 p-4 bg-gaming-card/50 rounded-xl border border-gaming-accent/30",children:[t.jsx("h4",{className:"text-md font-semibold mb-3 text-gaming-accent",children:n("creator.newTopic")}),le(Y,te,xe,se,nt,at),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsxs("button",{onClick:()=>Ve(e.id),className:"flex items-center gap-2 px-3 py-2 bg-gaming-accent text-white rounded-lg hover:bg-gaming-accent/80 transition-colors active:scale-95 text-sm",children:[t.jsx(de,{size:14}),n("creator.save")]}),t.jsx("button",{onClick:()=>{K(null),te(""),se("")},className:"px-3 py-2 text-gaming-textMuted hover:text-white transition-colors text-sm",children:n("creator.cancel")})]})]}),((a=e.topics)==null?void 0:a.length)===0?t.jsx("p",{className:"text-sm text-gaming-textMuted",children:n("creator.noTopics")}):t.jsx(fe,{items:e.topics.map(s=>s.id),strategy:je,children:t.jsx("div",{className:"space-y-3",children:e.topics.map((s,r)=>{var d,m;return t.jsx(At,{topic:s,topicIndex:r,sectionIndex:i,children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between group/row",children:[t.jsxs("div",{className:"flex-1 flex items-center gap-2 cursor-pointer",onClick:()=>$e(s.id),children:[G[s.id]?t.jsx(ve,{size:16,className:"text-gaming-accent"}):t.jsx(Me,{size:16,className:"text-gaming-textMuted"}),t.jsxs("span",{className:"font-medium",children:[i+1,".",r+1,". ",p==="tj"&&s.titleTj||s.title]}),t.jsx("button",{onClick:l=>{l.stopPropagation(),z({type:"topic",id:s.id,sectionId:e.id,titleRu:s.title,titleTj:s.titleTj||""})},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors sm:opacity-0 group-hover/row:opacity-100",title:n("creator.editTitle"),children:t.jsx(me,{size:14})}),t.jsxs("span",{className:"text-xs text-gaming-textMuted",children:["(",((d=s.lessons)==null?void 0:d.length)||0," ",n("creator.lessons"),")"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),M({type:"topic",id:s.id,fromSectionId:e.id})},className:"p-1 text-gaming-textMuted hover:text-gaming-accent transition-colors",title:n("creator.move"),children:t.jsx(De,{size:14})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),Ye(e.id,s.id)},className:"p-1 text-gaming-textMuted hover:text-red-400 transition-colors",children:t.jsx(ye,{size:16})})]})]}),G[s.id]&&t.jsxs("div",{className:"mt-3 ml-6",children:[t.jsxs("button",{onClick:()=>C({sectionId:e.id,topicId:s.id}),className:"flex items-center gap-2 px-2 py-1 mb-3 text-xs text-gaming-pink hover:bg-gaming-pink/10 rounded-lg transition-colors",children:[t.jsx(Ee,{size:14}),n("creator.addLesson")]}),(E==null?void 0:E.sectionId)===e.id&&(E==null?void 0:E.topicId)===s.id&&t.jsxs("div",{className:"mb-3 p-3 bg-gaming-bg/50 rounded-lg border border-gaming-pink/30",children:[t.jsx("h5",{className:"text-sm font-semibold mb-3 text-gaming-pink",children:n("creator.newLesson")}),le(q,ne,ge,ie,it,rt),t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsxs("button",{onClick:()=>We(e.id,s.id),className:"flex items-center gap-2 px-3 py-2 bg-gaming-pink text-white rounded-lg hover:bg-gaming-pink/80 transition-colors active:scale-95 text-xs",children:[t.jsx(de,{size:12}),n("creator.save")]}),t.jsx("button",{onClick:()=>{C(null),ne(""),ie("")},className:"px-3 py-2 text-gaming-textMuted hover:text-white transition-colors text-xs",children:n("creator.cancel")})]})]}),((m=s.lessons)==null?void 0:m.length)===0?t.jsx("p",{className:"text-xs text-gaming-textMuted",children:n("creator.noLessons")}):t.jsx(fe,{items:s.lessons.map(l=>l.id),strategy:je,children:t.jsx("div",{className:"space-y-2",children:s.lessons.map((l,S)=>t.jsx(Dt,{lesson:l,lessonIndex:S,sectionIndex:i,topicIndex:r,lang:p,onDelete:w=>qe(e.id,s.id,w),onEdit:(w,j)=>{j==="move"?M({type:"lesson",id:l.id,fromSectionId:e.id,fromTopicId:s.id}):j==="rename"?z({type:"lesson",id:l.id,sectionId:e.id,topicId:s.id,titleRu:l.title,titleTj:l.titleTj||""}):Xe(w,e.id,s.id)},getLessonIcon:lt},l.id))})})]})]})},s.id)})})})]})]})},e.id)})})})})]}),oe&&t.jsx(Et,{lesson:oe,onSave:tt,onAutoSave:et,autoSaveStatus:Ze,onClose:()=>{Le||(ae(null),ue(null))},lang:p,isSaving:Le}),k&&t.jsx(Pt,{item:k,itemType:k.type,syllabus:y[o]||{sections:[]},onMove:(e,i)=>{k.type==="topic"&&Be(k.id,k.fromSectionId,e),k.type==="lesson"&&He(k.id,k.fromSectionId,k.fromTopicId,e,i)},onClose:()=>M(null),lang:p}),U&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-gaming-primary/30 p-6 shadow-2xl animate-in fade-in zoom-in duration-200",children:[t.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[t.jsx(me,{className:"text-gaming-primary",size:24}),n("creator.editTitle")]}),le(U.titleRu,e=>z(i=>({...i,titleRu:e})),U.titleTj,e=>z(i=>({...i,titleTj:e})),async()=>{const e=await P(U.titleRu,"ru","tj");z(i=>({...i,titleTj:e}))},async()=>{const e=await P(U.titleTj,"tj","ru");z(i=>({...i,titleRu:e}))}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsxs("button",{onClick:()=>Qe(U),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors font-medium shadow-lg shadow-gaming-primary/20",children:[t.jsx(de,{size:18}),n("creator.save")]}),t.jsx("button",{onClick:()=>z(null),className:"px-4 py-3 bg-white/5 text-gaming-textMuted hover:text-white rounded-xl hover:bg-white/10 transition-colors",children:n("creator.cancel")})]})]})})]})},Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Ot},Symbol.toStringTag,{value:"Module"}));export{Xt as C,P as t};
