import{e as re,u as Ke,R as Ue,r as u,j as e,X as pe,C as ke,a as Ze,b as qe,c as et,L as tt}from"./index-BrecVWwG.js";import{C as st}from"./CourseLayout-d4ctmJUf.js";import{C as K,a as fe,k as Pe,V as We,P as ge,b as rt}from"./katex-tyJxjA1c.js";import{L as Ne,E as Qe,a as ce}from"./lock-D-6BhMPy.js";import{A as nt}from"./alert-triangle-DUSVZOFh.js";import{F as De,s as Je}from"./SyllabusContext-CUDbeHIc.js";import"./home-WDD8onzR.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=re("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=re("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=re("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=re("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=re("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=re("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),at=({slides:s,lessonId:m,onClose:r,onSlideView:h})=>{const{i18n:E}=Ke(),z=E.resolvedLanguage||"ru",_=Ue.useRef(null),[p,S]=u.useState(0),[L,o]=u.useState(!1),[l,k]=u.useState(()=>{const n=localStorage.getItem(`viewed_slides_${m}`);return n?JSON.parse(n):[]}),c=s[p];u.useEffect(()=>{if(c&&!l.includes(c.id)){const n=[...l,c.id];k(n),localStorage.setItem(`viewed_slides_${m}`,JSON.stringify(n)),h&&h(c.id)}},[p,c,l,m,h]);const f=u.useCallback(n=>{n.key==="ArrowLeft"||n.key==="ArrowUp"?S(g=>g>0?g-1:g):n.key==="ArrowRight"||n.key==="ArrowDown"||n.key===" "?S(g=>g<s.length-1?g+1:g):n.key==="Escape"?L?o(!1):r():(n.key==="f"||n.key==="F")&&o(g=>!g)},[s.length,L,r]);u.useEffect(()=>(window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)),[f]),u.useEffect(()=>{const n=()=>{o(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",n),_.current&&_.current.requestFullscreen().catch(g=>{console.log("Auto-fullscreen blocked:",g)}),()=>{document.removeEventListener("fullscreenchange",n),document.fullscreenElement&&document.exitFullscreen().catch(g=>console.log("Exit fullscreen error:",g))}},[]);const[I,V]=u.useState(null),H=n=>{V(n.touches[0].clientX)},P=n=>{if(!I)return;const g=n.changedTouches[0].clientX,M=I-g;Math.abs(M)>50&&(M>0&&p<s.length-1?S(W=>W+1):M<0&&p>0&&S(W=>W-1)),V(null)},U=()=>S(n=>n>0?n-1:n),T=()=>S(n=>n<s.length-1?n+1:n),v=()=>{var n;document.fullscreenElement?document.exitFullscreen().catch(g=>console.log(g)):(n=_.current)==null||n.requestFullscreen().catch(g=>console.log(g))},C=L?"fixed inset-0 z-[100] bg-black":"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",d=L?"w-full h-full flex items-center justify-center":"w-full max-w-5xl max-h-[80vh] flex items-center justify-center";return e.jsxs("div",{ref:_,className:C,onTouchStart:H,onTouchEnd:P,children:[!L&&e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[p+1," / ",s.length]}),l.includes(c==null?void 0:c.id)&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs",children:[e.jsx(K,{size:12}),z==="ru"?"Просмотрено":"Дида шуд"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:v,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",title:"Fullscreen (F)",children:e.jsx(lt,{size:20})}),e.jsx("button",{onClick:r,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",children:e.jsx(pe,{size:24})})]})]}),L&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("button",{onClick:r,className:"p-2 text-white/50 hover:text-white transition-colors",children:e.jsx(pe,{size:24})})}),e.jsx("div",{className:d,children:c&&e.jsx("img",{src:c.imageUrl,alt:z==="tj"&&c.captionTj||c.captionRu,className:L?"max-w-full max-h-full object-contain":"max-w-full max-h-[70vh] object-contain rounded-lg"})}),!L&&c&&(c.captionRu||c.captionTj)&&e.jsx("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 max-w-2xl text-center",children:e.jsx("p",{className:"text-white/90 text-lg bg-black/50 px-6 py-3 rounded-xl backdrop-blur-sm",children:z==="tj"&&c.captionTj||c.captionRu})}),e.jsx("button",{onClick:U,disabled:p===0,className:`absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${p===0?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(fe,{size:32})}),e.jsx("button",{onClick:T,disabled:p===s.length-1,className:`absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${p===s.length-1?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(ke,{size:32})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-2",children:s.map((n,g)=>e.jsx("button",{onClick:()=>S(g),className:`w-2 h-2 rounded-full transition-all ${g===p?"bg-white w-4":l.includes(n.id)?"bg-green-500/70 hover:bg-green-500":"bg-white/30 hover:bg-white/50"}`},n.id))}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/10",children:e.jsx("div",{className:"h-full bg-gaming-primary transition-all duration-300",style:{width:`${(p+1)/s.length*100}%`}})})]})},Y=s=>{const m=[...s];for(let r=m.length-1;r>0;r--){const h=Math.floor(Math.random()*(r+1));[m[r],m[h]]=[m[h],m[r]]}return m},de=s=>{if(!s||typeof s!="string")return s;let m=s.replace(/\$\$([^$]+?)\$\$/g,(r,h)=>{try{return Pe.renderToString(h.trim(),{displayMode:!0,throwOnError:!1,output:"html"})}catch(E){return console.warn("Ошибка рендеринга KaTeX:",E),r}});return m=m.replace(/\$([^$]+?)\$/g,(r,h)=>{try{return Pe.renderToString(h.trim(),{displayMode:!1,throwOnError:!1,output:"html"})}catch(E){return console.warn("Ошибка рендеринга KaTeX:",E),r}}),m},ye=80,ot=({questions:s,lessonId:m,lang:r,onClose:h,onComplete:E})=>{const[z,_]=u.useState(0),[p,S]=u.useState({}),[L,o]=u.useState(!1),[l,k]=u.useState(0),[c,f]=u.useState(!1),[I,V]=u.useState(""),[H,P]=u.useState(new Set),[U,T]=u.useState(!0);Ue.useEffect(()=>{const t=()=>{const b=document.hasFocus()&&!document.hidden;T(b)};window.addEventListener("focus",t),window.addEventListener("blur",t),document.addEventListener("visibilitychange",t);const i=setInterval(t,300);return()=>{window.removeEventListener("focus",t),window.removeEventListener("blur",t),document.removeEventListener("visibilitychange",t),clearInterval(i)}},[]);const v=`test_progress_v2_${m}`,C=u.useMemo(()=>{if(!s)return[];const t=localStorage.getItem(v);if(t&&l===0)try{const a=JSON.parse(t);if(!(a.questions&&a.questions.every(R=>R.textRu&&R.textRu.trim().length>0||R.textTj&&R.textTj.trim().length>0)))console.warn("Кэш теста содержит пустые вопросы. Очистка..."),localStorage.removeItem(v);else if(a.questions&&a.answers&&a.locked){S(a.answers),P(new Set(a.locked)),_(a.currentIndex||0);const R=new Set(a.locked),O=a.questions.filter(y=>R.has(y.id)),ie=new Set(O.map(y=>y.id)),A=Y(s.filter(y=>!ie.has(y.id))),J=Math.min(10,s.length)-O.length,N=A.slice(0,Math.max(0,J)).map(y=>y.type==="multiple_choice"?{...y,options:Y(y.options)}:y.type==="matching"?{...y,leftItems:Y(y.leftItems),rightItems:Y(y.rightItems)}:y);return[...O,...N]}}catch(a){console.warn("Ошибка восстановления прогресса теста:",a),localStorage.removeItem(v)}return Y(s).slice(0,10).map(a=>a.type==="multiple_choice"?{...a,options:Y(a.options)}:a.type==="matching"?{...a,leftItems:Y(a.leftItems),rightItems:Y(a.rightItems)}:a)},[s,l,v]),d=C[z],n=C.length;u.useEffect(()=>{if(C.length>0&&!L){const t={questions:C,answers:p,locked:[...H],currentIndex:z};localStorage.setItem(v,JSON.stringify(t))}},[p,H,z,C,L]);const g=t=>H.has(t),M=()=>{const t=C[z];if(!t)return;const i=p[t.id];i!=null&&i!==""&&P(b=>new Set([...b,t.id]))},W=(t,i)=>{g(t)||S(b=>({...b,[t]:i}))},je=()=>{z<n-1&&(M(),_(t=>t+1))},xe=()=>{z>0&&_(t=>t-1)},[j,X]=u.useState(null),Q=u.useMemo(()=>C.filter(t=>{const i=p[t.id];return i==null||i===""?!0:t.type==="matching"&&typeof i=="object"?Object.keys(i).length<t.leftItems.length:!1}).length,[p,C]);u.useEffect(()=>{if(c){const t=setTimeout(()=>{f(!1),V("")},3e3);return()=>clearTimeout(t)}},[c]);const D=()=>{if(M(),Q>0){f(!0);const A=r==="ru"?`Вы не ответили на ${Q} ${Q===1?"вопрос":Q<5?"вопроса":"вопросов"}!`:`Шумо ба ${Q} савол ҷавоб надодаед!`;V(A);return}let t=0;const i=C.map(A=>{const J=p[A.id];let N=!1;if(A.type==="multiple_choice")N=J===A.correctId;else if(A.type==="matching")N=Object.entries(A.correctMatches).every(([y,le])=>(J==null?void 0:J[y])===le);else if(A.type==="numeric"){const y=A.digits.join("");N=J===y}return N&&t++,{question:A,userAnswer:J,isCorrect:N}}),b=Math.round(t/n*100),a=b>=ye,$=`test_history_${m}`,R=JSON.parse(localStorage.getItem($)||"[]"),O={score:b,correct:t,total:n,timestamp:Date.now(),passed:a},ie=[...R,O];if(localStorage.setItem($,JSON.stringify(ie)),localStorage.setItem(`test_result_${m}`,JSON.stringify(O)),a){const A=parseInt(localStorage.getItem("user_coins")||"0");localStorage.setItem("user_coins",(A+1).toString())}X({correct:t,total:n,score:b,isPassed:a,details:i}),o(!0),localStorage.removeItem(v)},we=()=>{localStorage.removeItem(v),_(0),S({}),f(!1),V(""),P(new Set),X(null),o(!1),k(t=>t+1)},me=t=>{const i=r==="tj"&&t.textTj||t.textRu;return de(i||"")},ne=t=>{const i=r==="tj"&&t.textTj||t.textRu;return de(i||"")};return!s||s.length===0?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-gaming-card/95 rounded-2xl p-8 text-center max-w-md",children:[e.jsx(be,{size:48,className:"mx-auto mb-4 text-red-400"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:r==="ru"?"Нет вопросов":"Саволе нест"}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:r==="ru"?"Тест пока не содержит вопросов":"Тест ҳанӯз савол надорад"}),e.jsx("button",{onClick:h,className:"px-6 py-2 bg-gaming-primary text-white rounded-xl",children:r==="ru"?"Закрыть":"Пӯшидан"})]})}):L&&j?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 text-center relative overflow-hidden",children:[j.isPassed?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-green-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-yellow-400 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(250,204,21,0.6)] animate-bounce",children:e.jsx("div",{className:"w-20 h-20 border-4 border-yellow-600 rounded-full flex items-center justify-center bg-yellow-300",children:e.jsx("span",{className:"text-4xl font-bold text-yellow-700",children:"$"})})}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-green-400",children:r==="ru"?"Тест сдан!":"Тест супорида шуд!"}),e.jsx("p",{className:"text-green-300/80 mb-2",children:r==="ru"?"+1 монета в копилку":"+1 танга ба хазина"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(be,{size:64,className:"mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-red-400",children:r==="ru"?"Тест не сдан":"Тест супорида нашуд"}),e.jsx("p",{className:"text-red-300/80 mb-2",children:r==="ru"?`Нужно набрать минимум ${ye}%`:`Бояд ҳадди аққал ${ye}% гиред`})]})]}),e.jsxs("div",{className:`text-5xl font-bold mb-2 relative z-10 ${j.isPassed?"text-green-400":"text-red-400"}`,children:[j.score,"%"]}),e.jsxs("p",{className:"text-gaming-textMuted relative z-10",children:[j.correct," / ",j.total," ",r==="ru"?"правильных ответов":"ҷавоби дуруст"]})]}),e.jsx("div",{className:"p-6 max-h-[50vh] overflow-y-auto space-y-4",children:j.details.map((t,i)=>e.jsx("div",{className:`p-4 rounded-xl border ${t.isCorrect?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.isCorrect?e.jsx(Z,{className:"text-green-400 mt-1",size:20}):e.jsx(be,{className:"text-red-400 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium mb-1 flex gap-1",children:[e.jsxs("span",{children:[i+1,"."]}),e.jsx("div",{dangerouslySetInnerHTML:{__html:me(t.question)},className:"[&>p]:inline [&>p]:m-0"})]}),!t.isCorrect&&t.question.type==="multiple_choice"&&e.jsxs("div",{className:"text-sm text-green-400 flex flex-wrap gap-1",children:[e.jsx("span",{children:r==="ru"?"Правильный ответ: ":"Ҷавоби дуруст: "}),e.jsx("span",{className:"font-semibold",dangerouslySetInnerHTML:{__html:ne(t.question.options.find(b=>b.id===t.question.correctId))}})]})]})]})},t.question.id))}),e.jsxs("div",{className:"p-6 border-t border-white/10 flex gap-4 justify-center",children:[e.jsxs("button",{onClick:we,className:"flex items-center gap-2 px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20",children:[e.jsx(Xe,{size:18}),r==="ru"?"Пройти заново":"Аз нав"]}),j.isPassed&&e.jsxs("button",{onClick:()=>{E&&E(j),h()},className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 shadow-[0_0_15px_rgba(22,163,74,0.5)]",children:[e.jsx(Z,{size:18}),r==="ru"?"Забрать награду":"Гирифтани мукофот"]})]})]})}):e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 select-none",onContextMenu:t=>t.preventDefault(),style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"},children:[!U&&e.jsx("div",{className:"fixed inset-0 z-[100] backdrop-blur-3xl flex items-center justify-center bg-black/90 cursor-not-allowed",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(be,{size:64,className:"mx-auto mb-4 text-red-500 animate-pulse"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:r==="ru"?"Вернитесь к тесту!":"Ба тест баргардед!"}),e.jsx("p",{className:"text-white/80",children:r==="ru"?"Контент скрыт при потере фокуса":"Мундариҷа ҳангоми гум кардани фокус пинҳон карда мешавад"})]})}),e.jsxs("div",{className:`w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 overflow-hidden relative transition-all duration-300 flex flex-col max-h-[90vh] ${U?"":"opacity-0 pointer-events-none"}`,children:[e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-[0.03] flex flex-wrap content-center justify-center gap-8 rotate-12 scale-150",children:Array.from({length:20}).map((t,i)=>e.jsx("div",{className:"text-2xl font-black text-white whitespace-nowrap",children:"DONISHMAND PLATFORM"},i))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[r==="ru"?"Вопрос":"Савол"," ",z+1," / ",n]}),e.jsx("div",{className:"flex gap-1",children:C.map((t,i)=>{const b=(()=>{const $=p[t==null?void 0:t.id];return $==null||$===""?!1:(t==null?void 0:t.type)==="matching"&&typeof $=="object"?Object.keys($).length>=t.leftItems.length:!0})(),a=c&&!b;return e.jsx("button",{onClick:()=>_(i),title:`${r==="ru"?"Вопрос":"Савол"} ${i+1}${b?"":r==="ru"?" (нет ответа)":" (ҷавоб нест)"}`,className:`w-2.5 h-2.5 rounded-full transition-all duration-300 cursor-pointer hover:scale-150 ${i===z?"bg-gaming-primary scale-125":b?"bg-white/60":a?"bg-red-500 animate-pulse scale-125":"bg-white/20 hover:bg-white/40"}`},i)})})]}),e.jsx("button",{onClick:h,className:"p-2 text-gaming-textMuted hover:text-white",children:e.jsx(pe,{size:24})})]}),e.jsxs("div",{className:"p-6 relative z-10 overflow-y-auto flex-1",children:[e.jsx("div",{className:"text-xl font-medium mb-6 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:me(d)}}),d.image&&e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-white/10 bg-black/20 flex justify-center",children:e.jsx("img",{src:d.image,alt:"Question",className:"max-w-full max-h-[400px] object-contain"})}),d.type==="multiple_choice"&&(()=>{const t=g(d.id);return e.jsxs("div",{className:"space-y-3",children:[t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg text-sm text-gaming-textMuted",children:[e.jsx(Ne,{size:14}),e.jsx("span",{children:r==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"})]}),d.options.map((i,b)=>{const a=p[d.id]===i.id;return e.jsxs("button",{onClick:()=>W(d.id,i.id),disabled:t,className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${a?"bg-gaming-primary/20 border-gaming-primary":t?"bg-white/5 border-white/5 opacity-40 cursor-not-allowed":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 ${a?"bg-gaming-primary text-white":"bg-white/10"}`,children:String.fromCharCode(65+b)}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:ne(i)}}),i.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[200px]",children:e.jsx("img",{src:i.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),a&&t&&e.jsx(Ne,{size:16,className:"text-gaming-textMuted shrink-0"})]},i.id)})]})})(),d.type==="matching"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 pb-4 border-b border-white/10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-pink uppercase tracking-wider mb-2",children:r==="ru"?"Группа 1":"Гурӯҳи 1"}),d.leftItems.map((t,i)=>e.jsxs("div",{className:"text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"font-bold text-gaming-pink min-w-[20px]",children:[String.fromCharCode(65+i),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:ne(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-accent uppercase tracking-wider mb-2",children:r==="ru"?"Группа 2":"Гурӯҳи 2"}),d.rightItems.map((t,i)=>e.jsxs("div",{className:"text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"font-bold text-gaming-accent min-w-[20px]",children:[i+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:ne(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]})]}),e.jsx("p",{className:"text-sm text-gaming-textMuted text-center",children:r==="ru"?"Выберите соответствия в сетке:":"Мувофиқатро дар ҷадвал интихоб кунед:"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"overflow-x-auto max-w-full pb-2",children:e.jsxs("table",{className:"border-separate border-spacing-1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8"}),d.rightItems.map((t,i)=>e.jsx("th",{className:"text-center font-bold text-gaming-accent text-sm p-1",children:i+1},t.id))]})}),e.jsx("tbody",{children:d.leftItems.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-bold text-gaming-pink text-sm p-1",children:String.fromCharCode(65+i)}),d.rightItems.map(b=>{var R;const a=((R=p[d.id])==null?void 0:R[t.id])===b.id,$=g(d.id);return e.jsx("td",{className:"text-center p-0.5",children:e.jsx("button",{onClick:()=>W(d.id,{...p[d.id]||{},[t.id]:b.id}),disabled:$,className:`w-8 h-8 rounded-full border-2 transition-all flex items-center justify-center
                                                                        ${a?"bg-gaming-primary border-gaming-primary":$?"bg-white/5 border-white/10 opacity-30 cursor-not-allowed":"bg-white/5 border-white/20 hover:border-white/40"}`,children:a&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})},b.id)})]},t.id))})]})})})]}),d.type==="numeric"&&(()=>{const t=g(d.id);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gaming-textMuted",children:t?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ne,{size:14})," ",r==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"]}):r==="ru"?"Введите ответ:":"Ҷавобро ворид кунед:"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[[0,1,2,3].map(i=>e.jsx("input",{type:"text",maxLength:1,disabled:t,value:(p[d.id]||"")[i]||"",onChange:b=>{const a=b.target.value;if(a&&!/^\d$/.test(a))return;const R=(p[d.id]||"").split("");if(R[i]=a,W(d.id,R.join("")),a&&i<3){const O=b.target.nextElementSibling;O&&O.focus()}},className:`w-14 h-14 text-center text-2xl font-bold rounded-lg text-white focus:outline-none ${t?"bg-gaming-bg/50 border-2 border-gaming-primary/30 opacity-70 cursor-not-allowed":"bg-gaming-bg/50 border-2 border-white/20 focus:border-gaming-primary"}`},i)),d.unit&&e.jsx("span",{className:"text-xl text-gaming-textMuted ml-2",children:d.unit})]})]})})()]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-white/10 relative z-10",children:[z>0?e.jsxs("button",{onClick:xe,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white hover:bg-white/10",children:[e.jsx(fe,{size:18}),r==="ru"?"Назад":"Қафо"]}):e.jsx("div",{}),z===n-1?e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[c&&I&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-500/20 border border-red-500/40 text-red-400 rounded-xl text-sm animate-bounce",children:[e.jsx(nt,{size:16,className:"shrink-0"}),e.jsx("span",{children:I})]}),e.jsxs("button",{onClick:D,className:`flex items-center gap-2 px-6 py-2 rounded-xl transition-all ${c?"bg-red-500/80 text-white animate-[shake_0.5s_ease-in-out]":"bg-gaming-primary text-white hover:bg-gaming-primary/80"}`,children:[e.jsx(Z,{size:18}),r==="ru"?"Завершить тест":"Тамом кардан"]})]}):e.jsxs("button",{onClick:je,className:"flex items-center gap-2 px-4 py-2 text-white hover:bg-white/10 rounded-xl",children:[r==="ru"?"Далее":"Оянда",e.jsx(ke,{size:18})]})]})]})]})},ct=({questions:s,lang:m,onClose:r})=>{const[h,E]=u.useState(!1),[z,_]=u.useState({});if(!s||s.length===0)return null;const p=l=>{_(k=>({...k,[l]:!k[l]}))},S=()=>{const l=!h;E(l);const k={};s.forEach(c=>k[c.id]=l),_(k)},L=l=>{const k=m==="tj"&&l.textTj||l.textRu;return de(k||"")},o=l=>{const k=m==="tj"&&l.textTj||l.textRu;return de(k||"")};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-4xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8 shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:m==="ru"?"Режим учителя: Просмотр теста":"Реҷаи омӯзгор: Дидани тест"}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[s.length," ",m==="ru"?"вопросов":"савол"]})]}),e.jsx("button",{onClick:r,className:"p-2 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(pe,{size:24})})]}),e.jsx("div",{className:"p-4 bg-black/20 border-b border-white/5 flex justify-between items-center shrink-0",children:e.jsxs("button",{onClick:S,className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all ${h?"bg-gaming-primary text-white":"bg-white/10 text-gaming-textMuted hover:text-white"}`,children:[h?e.jsx(Qe,{size:18}):e.jsx(ce,{size:18}),h?m==="ru"?"Скрыть все ответы":"Пинҳон кардани ҷавобҳо":m==="ru"?"Показать все ответы":"Нишон додани ҷавобҳо"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:s.map((l,k)=>{const c=z[l.id];return e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-gaming-pink/10 text-gaming-pink rounded-lg flex items-center justify-center font-bold text-sm border border-gaming-pink/20",children:k+1}),e.jsx("div",{className:"text-lg font-medium text-white pt-1 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:L(l)}}),l.image&&e.jsx("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-md",children:e.jsx("img",{src:l.image,alt:"Question",className:"w-full h-auto object-cover"})})]}),e.jsx("button",{onClick:()=>p(l.id),className:`p-2 rounded-lg transition-colors ${c?"text-gaming-primary bg-gaming-primary/10":"text-gaming-textMuted hover:bg-white/5"}`,title:m==="ru"?"Показать/Скрыть ответ":"Нишон додан/Пинҳон кардан",children:c?e.jsx(Qe,{size:20}):e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"transition-all duration-300",children:[l.type==="multiple_choice"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pl-11",children:l.options.map((f,I)=>{const H=f.id===l.correctId&&c;return e.jsxs("div",{className:`p-3 rounded-xl border flex items-center gap-3 transition-all duration-300 ${H?"bg-green-500/10 border-green-500/30 text-green-400 font-bold":"bg-black/20 border-white/5 text-gaming-textMuted"}`,children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs transition-colors ${H?"bg-green-500 text-white":"bg-white/10"}`,children:String.fromCharCode(65+I)}),e.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:o(f)}}),f.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[150px]",children:e.jsx("img",{src:f.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),H&&e.jsx(Z,{size:16,className:"ml-auto animate-in zoom-in duration-300 shrink-0"})]},f.id)})}),l.type==="matching"&&e.jsxs("div",{className:"pl-11 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:m==="ru"?"Элементы":"Элементҳо"}),l.leftItems.map((f,I)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"text-gaming-pink font-bold",children:[String.fromCharCode(65+I),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:o(f)}}),f.image&&e.jsx("img",{src:f.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},f.id))]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:m==="ru"?"Определения":"Таърифҳо"}),l.rightItems.map((f,I)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"text-gaming-accent font-bold",children:[I+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:o(f)}}),f.image&&e.jsx("img",{src:f.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},f.id))]})]}),c&&e.jsxs("div",{className:"p-4 bg-green-500/5 border border-green-500/20 rounded-xl animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx("p",{className:"text-sm text-green-400 font-bold mb-2",children:m==="ru"?"Правильные пары:":"Ҷуфтҳои дуруст:"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(l.correctMatches).map(([f,I])=>{const V=l.leftItems.findIndex(P=>P.id===f),H=l.rightItems.findIndex(P=>P.id===I);return e.jsxs("span",{className:"px-2 py-1 bg-green-500/10 rounded border border-green-500/20 text-sm",children:[String.fromCharCode(65+V)," — ",H+1]},f)})})]})]}),l.type==="numeric"&&e.jsx("div",{className:"pl-11",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 bg-green-500/5 border border-white/5 rounded-xl transition-all duration-300",children:[e.jsx("span",{className:"text-sm text-gaming-textMuted",children:m==="ru"?"Ответ:":"Ҷавоб:"}),e.jsx("span",{className:`text-xl font-bold tracking-widest transition-all duration-300 ${c?"text-green-400":"text-white/20"}`,children:c?l.digits.join(""):"****"}),l.unit&&e.jsx("span",{className:"text-gaming-textMuted",children:l.unit}),c&&e.jsx(Z,{size:16,className:"text-green-400 animate-in zoom-in"})]})})]})]},l.id)})})]})})},se=(s,m)=>`progress_${s}_${m}`,pt=()=>{var Ie,Te,Me,$e,_e,Le,Re,Ee,Ae,He,Ve,Oe,Fe;const{t:s,i18n:m}=Ke(),r=m.resolvedLanguage||"ru",{lessonId:h}=Ze(),E=qe(),z=80,[_,p]=u.useState(!0),[S,L]=u.useState(null),[o,l]=u.useState(()=>({videoWatched:localStorage.getItem(se(h,"video"))==="true",textRead:localStorage.getItem(se(h,"text"))==="true",slidesViewed:JSON.parse(localStorage.getItem(se(h,"slides"))||"[]"),testHistory:JSON.parse(localStorage.getItem(`test_history_${h}`)||"[]")})),[k,c]=u.useState("video"),[f,I]=u.useState(!1),[V,H]=u.useState(!1),[P,U]=u.useState(!1),{isTeacher:T}=et();u.useEffect(()=>{(async()=>{p(!0);try{const w=await Je.getLesson(h,r);if(!w){L(null),p(!1);return}const F=w.subject;let G=null;if(F){const q=await Je.getStructure(F);if(q&&q.sections)for(let ee=0;ee<q.sections.length;ee++){const B=q.sections[ee];if(B.topics){for(let te=0;te<B.topics.length;te++){const he=B.topics[te];if(!he.lessons)continue;const ve=he.lessons.findIndex(Ge=>Ge.id===h);if(ve!==-1){G={lesson:{...w,...he.lessons[ve],content:w.content},topic:he,section:B,subjectKey:F,lessonIndex:ve,topicIndex:te,sectionIndex:ee};break}}if(G)break}}}L(G||{lesson:w,subjectKey:F})}catch(w){console.error("Error fetching lesson:",w)}finally{p(!1)}})()},[h,r]);const v=((Ie=S==null?void 0:S.lesson)==null?void 0:Ie.content)||{},C=r==="tj"?((Te=v.video)==null?void 0:Te.urlTj)||((Me=v.video)==null?void 0:Me.url):(($e=v.video)==null?void 0:$e.url)||((_e=v.video)==null?void 0:_e.urlTj),d=!!C,n=!!((Le=v.text)!=null&&Le.bodyRu||(Re=v.text)!=null&&Re.bodyTj),g=r==="tj"?v.slidesTj||[]:v.slidesRu||[],M=g.length>0,W=((Ae=(Ee=v.test)==null?void 0:Ee.questions)==null?void 0:Ae.length)>0,je=d||n||M,xe=((He=v.test)==null?void 0:He.questions)||[],j=u.useMemo(()=>{if(!o.testHistory||o.testHistory.length===0)return null;const x=o.testHistory.length,w=Math.max(...o.testHistory.map(B=>B.score)),F=o.testHistory.reduce((B,te)=>B+te.score,0)/x,G=Math.round(100-F),q=o.testHistory[o.testHistory.length-1].timestamp,ee=w>=z;return{totalAttempts:x,bestScore:w,avgErrorRate:G,lastAttemptAt:q,isPassed:ee}},[o.testHistory]),X=g.length,Q=o.slidesViewed.length,D=X>0?Q>=X:!0,we=!d||o.videoWatched,me=!n||o.textRead,t=T||we&&me&&(!M||D),i=[d,n,M,W].filter(Boolean).length;let b=0;d&&o.videoWatched&&b++,n&&o.textRead&&b++,M&&D&&b++,W&&(j!=null&&j.isPassed)&&b++;const a=i>0?Math.round(b/i*100):0;u.useEffect(()=>{!_&&S&&(d?c("video"):n?c("text"):M&&c("slides"))},[_,d,n,M]);const $=()=>{T||(localStorage.setItem(se(h,"video"),"true"),l(x=>({...x,videoWatched:!0})))},R=()=>{T||o.textRead||(localStorage.setItem(se(h,"text"),"true"),l(x=>({...x,textRead:!0})))},O=x=>{if(T)return;const w=[...new Set([...o.slidesViewed,x])];localStorage.setItem(se(h,"slides"),JSON.stringify(w)),l(F=>({...F,slidesViewed:w}))},ie=()=>{t?U(!0):H(!0)},A=x=>{const w=JSON.parse(localStorage.getItem(`test_history_${h}`)||"[]");l(F=>({...F,testHistory:w}))};if(u.useEffect(()=>{const x=w=>{w.key==="Escape"&&(V&&H(!1),f&&I(!1))};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[V,f]),_)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gaming-bg",children:e.jsx(tt,{size:40,className:"text-gaming-primary animate-spin"})});if(!S)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-white bg-gaming-bg",children:[e.jsx("h2",{className:"text-2xl mb-4",children:s("lesson.notFound")}),e.jsx("button",{onClick:()=>E(-1),className:"text-gaming-primary hover:underline",children:s("lesson.back")})]});const{lesson:J,topic:N,section:y,subjectKey:le,lessonIndex:ue,sectionIndex:Be,topicIndex:Ye}=S,Se=x=>r==="tj"&&x.titleTj?x.titleTj:x.title,Ce=(Ve=N==null?void 0:N.lessons)==null?void 0:Ve[ue-1],ze=(Oe=N==null?void 0:N.lessons)==null?void 0:Oe[ue+1],ae=[];return d&&ae.push({id:"video",icon:We,label:"lesson.video",complete:o.videoWatched}),n&&ae.push({id:"text",icon:De,label:"lesson.text",complete:o.textRead}),M&&ae.push({id:"slides",icon:ge,label:"lesson.slides",complete:D}),e.jsxs(st,{subjectId:le,children:[e.jsxs("div",{className:"max-w-4xl",children:[e.jsxs("header",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>{le&&(y!=null&&y.id)&&(N!=null&&N.id)?E(`/subject/${le}/section/${y.id}/topic/${N.id}`):E(-1)},className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-gaming-textMuted hover:text-white transition-all mb-4 group w-fit",children:[e.jsx(fe,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:s("lesson.backToTopic")})]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gaming-textMuted mb-1",children:[s("lesson.lesson")," ",ue+1," / ",((Fe=N==null?void 0:N.lessons)==null?void 0:Fe.length)||0]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2 text-gaming-pink",children:[ue+1,". ",Se(J)]}),N&&e.jsx("p",{className:"text-gaming-textMuted flex items-center gap-2 text-sm",children:e.jsxs("span",{children:[Be+1,".",Ye+1,". ",Se(N)]})})]}),T&&e.jsx("div",{className:"px-3 py-1 bg-gaming-pink text-white text-xs font-bold rounded-full uppercase tracking-wider animate-pulse",children:s("lesson.teacherMode")})]})]}),!T&&e.jsxs("div",{className:"mb-8 bg-gradient-to-br from-gaming-primary/20 to-gaming-pink/20 backdrop-blur-xl border border-white/10 rounded-2xl p-6 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg mb-1",children:s("lesson.progress")}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[b," / ",i," ",s("lesson.stepsCompleted")]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-3xl font-bold text-gaming-primary",children:[a,"%"]})})]}),e.jsx("div",{className:"w-full h-3 bg-black/30 rounded-full mb-6 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gaming-primary to-gaming-pink transition-all duration-1000 ease-out",style:{width:`${a}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[d&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${o.videoWatched?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${o.videoWatched?"bg-green-500/20":"bg-white/10"}`,children:o.videoWatched?e.jsx(K,{size:20}):e.jsx(We,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:s("lesson.video")})]}),n&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${o.textRead?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${o.textRead?"bg-green-500/20":"bg-white/10"}`,children:o.textRead?e.jsx(K,{size:20}):e.jsx(De,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:s("lesson.text")})]}),M&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${D?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${D?"bg-green-500/20":"bg-white/10"}`,children:D?e.jsx(K,{size:20}):e.jsx(ge,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:s("lesson.slides")}),e.jsxs("span",{className:"text-xs opacity-70",children:[Q,"/",X]})]})]}),W&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${j!=null&&j.isPassed?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${j!=null&&j.isPassed?"bg-green-500/20":"bg-white/10"}`,children:j!=null&&j.isPassed?e.jsx(K,{size:20}):e.jsx(Z,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:s("lesson.test")}),j&&e.jsxs("span",{className:"text-xs font-bold",children:[j.bestScore,"%"]})]})]})]})]}),j&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-white/10 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(Xe,{size:18,className:"text-gaming-gold"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:s("lesson.attempts")}),e.jsx("div",{className:"font-bold text-white",children:j.totalAttempts})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(it,{size:18,className:"text-gaming-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:s("lesson.lastAttempt")}),e.jsx("div",{className:"font-bold text-white",children:j.lastAttemptAt?new Intl.DateTimeFormat(r==="tj"?"tg-TJ":"ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}).format(new Date(j.lastAttemptAt)):"-"})]})]})]})]}),je?e.jsxs(e.Fragment,{children:[ae.length>0&&e.jsx("div",{className:"flex gap-4 mb-6 border-b border-white/5 overflow-x-auto",children:ae.map(x=>{const w=x.icon;return e.jsxs("button",{onClick:()=>c(x.id),className:`pb-3 px-2 text-base font-semibold transition-all relative flex items-center gap-2 whitespace-nowrap ${k===x.id?"text-white":"text-gaming-textMuted hover:text-white"}`,children:[e.jsx(w,{size:18}),s(x.label),x.complete&&!T&&e.jsx(K,{size:14,className:"text-green-400"}),k===x.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gaming-pink rounded-t-full shadow-[0_0_10px_rgba(236,72,153,0.5)]"})]},x.id)})}),e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-6 mb-6 shadow-xl overflow-hidden relative group",children:[e.jsx("div",{className:"absolute -left-20 -top-20 w-64 h-64 bg-gaming-pink/5 rounded-full blur-3xl group-hover:bg-gaming-pink/10 transition-all duration-700"}),e.jsxs("div",{className:"relative z-10",children:[k==="video"&&d&&e.jsxs("div",{className:"aspect-video bg-black/60 rounded-xl flex flex-col items-center justify-center border border-white/10 shadow-inner overflow-hidden relative",children:[C.includes("youtube")||C.includes("youtu.be")?(()=>{const x=C.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|.*\/|.*embed\/))([^&?]*)/),w=x?x[1]:null;return w?e.jsx("iframe",{src:`https://www.youtube.com/embed/${w}`,className:"w-full h-full",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onLoad:$}):e.jsxs("div",{className:"text-white text-center p-4",children:[e.jsx("p",{children:"Не удалось загрузить видео"}),e.jsx("a",{href:C,target:"_blank",rel:"noopener noreferrer",className:"text-gaming-primary hover:underline mt-2 inline-block",children:"Открыть на YouTube"})]})})():e.jsx("video",{src:C,controls:!0,className:"w-full h-full",onEnded:$,onPlay:()=>setTimeout($,3e4)}),!o.videoWatched&&!T&&e.jsxs("button",{onClick:$,className:"absolute bottom-4 right-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(ce,{size:16}),s("lesson.markAsWatched")]})]}),k==="text"&&n&&e.jsxs("div",{className:"prose prose-invert max-w-none prose-p:text-gaming-textMuted prose-headings:text-white prose-li:text-gaming-textMuted",onScroll:x=>{const{scrollTop:w,scrollHeight:F,clientHeight:G}=x.target;w+G>=F-50&&R()},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:de(r==="tj"&&v.text.bodyTj||v.text.bodyRu)}}),!o.textRead&&!T&&e.jsxs("button",{onClick:R,className:"mt-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(ce,{size:16}),s("lesson.markAsRead")]})]}),k==="slides"&&M&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gaming-textMuted",children:[Q," / ",X," ",s("lesson.slidesCount")]}),e.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-4 py-2 bg-gaming-gold/20 text-gaming-gold rounded-xl hover:bg-gaming-gold/30 transition-colors",children:[e.jsx(ge,{size:18}),s("lesson.openPresentation")]})]}),e.jsx("div",{className:"flex flex-col gap-6",children:g.map((x,w)=>e.jsxs("button",{onClick:()=>{O(x.id),I(!0)},className:"relative w-full rounded-2xl overflow-hidden border border-white/5 hover:border-gaming-gold/30 transition-all group shadow-lg",children:[e.jsx("img",{src:x.imageUrl,alt:`Slide ${w+1}`,className:"w-full h-auto object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-sm",children:e.jsx("div",{className:"bg-black/60 p-3 rounded-full border border-white/20 transform scale-90 group-hover:scale-100 transition-transform",children:e.jsx(ge,{size:24,className:"text-white"})})}),e.jsx("div",{className:"absolute top-4 left-4 bg-black/60 backdrop-blur px-3 py-1 rounded-full text-white font-bold text-sm border border-white/10",children:w+1}),(o.slidesViewed.includes(x.id)||T)&&e.jsx("div",{className:"absolute top-4 right-4 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center shadow-lg animate-in fade-in zoom-in",children:e.jsx(K,{size:16,className:"text-white"})})]},x.id))})]})]})]})]}):e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-8 mb-6 text-center",children:[e.jsx(rt,{size:48,className:"mx-auto mb-4 text-gaming-primary opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s("lesson.testing")}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:s("lesson.onlyTest")})]}),V&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-red-500/30 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-400 mb-4",children:[e.jsx(oe,{size:24}),e.jsx("h3",{className:"text-lg font-semibold",children:s("lesson.reviewMaterialsTitle")})]}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:s("lesson.reviewMaterialsText")}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[d&&e.jsxs("li",{className:`flex items-center gap-2 ${o.videoWatched?"text-green-400":"text-red-400"}`,children:[o.videoWatched?e.jsx(K,{size:16}):e.jsx(oe,{size:16}),s("lesson.video")]}),n&&e.jsxs("li",{className:`flex items-center gap-2 ${o.textRead?"text-green-400":"text-red-400"}`,children:[o.textRead?e.jsx(K,{size:16}):e.jsx(oe,{size:16}),s("lesson.text")]}),M&&e.jsxs("li",{className:`flex items-center gap-2 ${D?"text-green-400":"text-red-400"}`,children:[D?e.jsx(K,{size:16}):e.jsx(oe,{size:16}),s("lesson.slides")," (",Q,"/",X,")"]})]}),e.jsx("button",{onClick:()=>H(!1),className:"w-full px-4 py-3 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors",children:s("lesson.understood")})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[Ce&&e.jsxs("button",{onClick:()=>E(`/lesson/${Ce.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx(fe,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:s("lesson.prev")})]}),ze&&e.jsxs("button",{onClick:()=>E(`/lesson/${ze.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:s("lesson.next")}),e.jsx(ke,{size:16})]})]}),e.jsxs("button",{onClick:ie,className:`group font-bold py-3 px-8 rounded-xl flex items-center gap-2 transition-all transform hover:scale-[1.02] active:scale-95 shadow-lg border border-white/10 ${t?T?"bg-gaming-pink hover:bg-gaming-pink/80 text-white shadow-gaming-pink/25":"bg-gaming-primary hover:bg-gaming-primary/80 text-white shadow-gaming-primary/25":"bg-gaming-card/60 text-gaming-textMuted cursor-not-allowed"}`,children:[T?e.jsx(ce,{size:20}):e.jsx(Z,{size:20}),e.jsx("span",{children:s(T?"lesson.viewTest":"lesson.takeTest")}),!t&&e.jsx(oe,{size:16,className:"text-yellow-400"})]})]})]}),f&&M&&e.jsx(at,{slides:g,lessonId:h,onClose:()=>I(!1),onSlideView:O}),P&&(T?e.jsx(ct,{questions:xe,lang:r,onClose:()=>U(!1)}):e.jsx(ot,{questions:xe,lessonId:h,lang:r,onClose:()=>U(!1),onComplete:A}))]})};export{pt as default};
