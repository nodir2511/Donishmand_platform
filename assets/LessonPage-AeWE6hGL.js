import{c as J,R as Pe,r as u,j as e,X as he,C as ye,u as Ke,a as Ue}from"./index-CGqczOZw.js";import{C as Xe}from"./CourseLayout-2b7NfBSn.js";import{C as Q,a as Ne,k as Ae,V as He,P as me,b as Be}from"./katex-d9HXRHMD.js";import{A as Ze}from"./alert-triangle-CNRHWueV.js";import{L as Ge,s as Ve}from"./syllabusService-CC_BWhyZ.js";import{F as Oe}from"./file-text-Dmczy5Z9.js";import"./home-C2QZHNeX.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=J("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=J("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=J("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=J("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=J("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=J("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=J("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=J("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=J("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),et=({slides:r,lessonId:m,lang:n,onClose:d,onSlideView:_})=>{const C=Pe.useRef(null),[f,b]=u.useState(0),[y,V]=u.useState(!1),[l,a]=u.useState(()=>{const s=localStorage.getItem(`viewed_slides_${m}`);return s?JSON.parse(s):[]}),c=r[f];u.useEffect(()=>{if(c&&!l.includes(c.id)){const s=[...l,c.id];a(s),localStorage.setItem(`viewed_slides_${m}`,JSON.stringify(s)),_&&_(c.id)}},[f,c,l,m,_]);const j=u.useCallback(s=>{s.key==="ArrowLeft"||s.key==="ArrowUp"?b(x=>x>0?x-1:x):s.key==="ArrowRight"||s.key==="ArrowDown"||s.key===" "?b(x=>x<r.length-1?x+1:x):s.key==="Escape"?y?V(!1):d():(s.key==="f"||s.key==="F")&&V(x=>!x)},[r.length,y,d]);u.useEffect(()=>(window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)),[j]),u.useEffect(()=>{const s=()=>{V(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",s),C.current&&C.current.requestFullscreen().catch(x=>{console.log("Auto-fullscreen blocked:",x)}),()=>{document.removeEventListener("fullscreenchange",s),document.fullscreenElement&&document.exitFullscreen().catch(x=>console.log("Exit fullscreen error:",x))}},[]);const[p,M]=u.useState(null),P=s=>{M(s.touches[0].clientX)},E=s=>{if(!p)return;const x=s.changedTouches[0].clientX,S=p-x;Math.abs(S)>50&&(S>0&&f<r.length-1?b(W=>W+1):S<0&&f>0&&b(W=>W-1)),M(null)},F=()=>b(s=>s>0?s-1:s),K=()=>b(s=>s<r.length-1?s+1:s),I=()=>{var s;document.fullscreenElement?document.exitFullscreen().catch(x=>console.log(x)):(s=C.current)==null||s.requestFullscreen().catch(x=>console.log(x))},N=y?"fixed inset-0 z-[100] bg-black":"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",w=y?"w-full h-full flex items-center justify-center":"w-full max-w-5xl max-h-[80vh] flex items-center justify-center";return e.jsxs("div",{ref:C,className:N,onTouchStart:P,onTouchEnd:E,children:[!y&&e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[f+1," / ",r.length]}),l.includes(c==null?void 0:c.id)&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs",children:[e.jsx(Q,{size:12}),n==="ru"?"Просмотрено":"Дида шуд"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:I,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",title:"Fullscreen (F)",children:e.jsx(qe,{size:20})}),e.jsx("button",{onClick:d,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",children:e.jsx(he,{size:24})})]})]}),y&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("button",{onClick:d,className:"p-2 text-white/50 hover:text-white transition-colors",children:e.jsx(he,{size:24})})}),e.jsx("div",{className:w,children:c&&e.jsx("img",{src:c.imageUrl,alt:n==="tj"&&c.captionTj||c.captionRu,className:y?"max-w-full max-h-full object-contain":"max-w-full max-h-[70vh] object-contain rounded-lg"})}),!y&&c&&(c.captionRu||c.captionTj)&&e.jsx("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 max-w-2xl text-center",children:e.jsx("p",{className:"text-white/90 text-lg bg-black/50 px-6 py-3 rounded-xl backdrop-blur-sm",children:n==="tj"&&c.captionTj||c.captionRu})}),e.jsx("button",{onClick:F,disabled:f===0,className:`absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${f===0?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(Ne,{size:32})}),e.jsx("button",{onClick:K,disabled:f===r.length-1,className:`absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${f===r.length-1?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(ye,{size:32})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-2",children:r.map((s,x)=>e.jsx("button",{onClick:()=>b(x),className:`w-2 h-2 rounded-full transition-all ${x===f?"bg-white w-4":l.includes(s.id)?"bg-green-500/70 hover:bg-green-500":"bg-white/30 hover:bg-white/50"}`},s.id))}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/10",children:e.jsx("div",{className:"h-full bg-gaming-primary transition-all duration-300",style:{width:`${(f+1)/r.length*100}%`}})})]})},B=r=>{const m=[...r];for(let n=m.length-1;n>0;n--){const d=Math.floor(Math.random()*(n+1));[m[n],m[d]]=[m[d],m[n]]}return m},de=r=>{if(!r||typeof r!="string")return r;let m=r.replace(/\$\$([^$]+?)\$\$/g,(n,d)=>{try{return Ae.renderToString(d.trim(),{displayMode:!0,throwOnError:!1,output:"html"})}catch(_){return console.warn("Ошибка рендеринга KaTeX:",_),n}});return m=m.replace(/\$([^$]+?)\$/g,(n,d)=>{try{return Ae.renderToString(d.trim(),{displayMode:!1,throwOnError:!1,output:"html"})}catch(_){return console.warn("Ошибка рендеринга KaTeX:",_),n}}),m},ve=80,tt=({questions:r,lessonId:m,lang:n,onClose:d,onComplete:_})=>{const[C,f]=u.useState(0),[b,y]=u.useState({}),[V,l]=u.useState(!1),[a,c]=u.useState(0),[j,p]=u.useState(!1),[M,P]=u.useState(""),[E,F]=u.useState(new Set),[K,I]=u.useState(!0);Pe.useEffect(()=>{const t=()=>{const g=document.hasFocus()&&!document.hidden;I(g)};window.addEventListener("focus",t),window.addEventListener("blur",t),document.addEventListener("visibilitychange",t);const i=setInterval(t,300);return()=>{window.removeEventListener("focus",t),window.removeEventListener("blur",t),document.removeEventListener("visibilitychange",t),clearInterval(i)}},[]);const N=`test_progress_${m}`,w=u.useMemo(()=>{if(!r)return[];const t=localStorage.getItem(N);if(t&&a===0)try{const o=JSON.parse(t);if(o.questions&&o.answers&&o.locked){y(o.answers),F(new Set(o.locked)),f(o.currentIndex||0);const T=new Set(o.locked),H=o.questions.filter(k=>T.has(k.id)),D=new Set(H.map(k=>k.id)),ne=B(r.filter(k=>!D.has(k.id))),L=Math.min(10,r.length)-H.length,$=ne.slice(0,Math.max(0,L)).map(k=>k.type==="multiple_choice"?{...k,options:B(k.options)}:k.type==="matching"?{...k,leftItems:B(k.leftItems),rightItems:B(k.rightItems)}:k);return[...H,...$]}}catch(o){console.warn("Ошибка восстановления прогресса теста:",o)}return B(r).slice(0,10).map(o=>o.type==="multiple_choice"?{...o,options:B(o.options)}:o.type==="matching"?{...o,leftItems:B(o.leftItems),rightItems:B(o.rightItems)}:o)},[r,a]),s=w[C],x=w.length;u.useEffect(()=>{if(w.length>0&&!V){const t={questions:w,answers:b,locked:[...E],currentIndex:C};localStorage.setItem(N,JSON.stringify(t))}},[b,E,C,w,V]);const S=t=>E.has(t),W=()=>{const t=w[C];if(!t)return;const i=b[t.id];i!=null&&i!==""&&F(g=>new Set([...g,t.id]))},ie=(t,i)=>{S(t)||y(g=>({...g,[t]:i}))},xe=()=>{C<x-1&&(W(),f(t=>t+1))},z=()=>{C>0&&f(t=>t-1)},[R,U]=u.useState(null),A=u.useMemo(()=>w.filter(t=>{const i=b[t.id];return i==null||i===""?!0:t.type==="matching"&&typeof i=="object"?Object.keys(i).length<t.leftItems.length:!1}).length,[b,w]);u.useEffect(()=>{if(j){const t=setTimeout(()=>{p(!1),P("")},3e3);return()=>clearTimeout(t)}},[j]);const ge=()=>{if(W(),A>0){p(!0);const L=n==="ru"?`Вы не ответили на ${A} ${A===1?"вопрос":A<5?"вопроса":"вопросов"}!`:`Шумо ба ${A} савол ҷавоб надодаед!`;P(L);return}let t=0;const i=w.map(L=>{const $=b[L.id];let k=!1;if(L.type==="multiple_choice")k=$===L.correctId;else if(L.type==="matching")k=Object.entries(L.correctMatches).every(([le,q])=>($==null?void 0:$[le])===q);else if(L.type==="numeric"){const le=L.digits.join("");k=$===le}return k&&t++,{question:L,userAnswer:$,isCorrect:k}}),g=Math.round(t/x*100),o=g>=ve,T=`test_history_${m}`,H=JSON.parse(localStorage.getItem(T)||"[]"),D={score:g,correct:t,total:x,timestamp:Date.now(),passed:o},ne=[...H,D];if(localStorage.setItem(T,JSON.stringify(ne)),localStorage.setItem(`test_result_${m}`,JSON.stringify(D)),o){const L=parseInt(localStorage.getItem("user_coins")||"0");localStorage.setItem("user_coins",(L+1).toString())}U({correct:t,total:x,score:g,isPassed:o,details:i}),l(!0),localStorage.removeItem(N)},pe=()=>{localStorage.removeItem(N),f(0),y({}),p(!1),P(""),F(new Set),U(null),l(!1),c(t=>t+1)},be=t=>{const i=n==="tj"&&t.textTj||t.textRu;return de(i||"")},X=t=>{const i=n==="tj"&&t.textTj||t.textRu;return de(i||"")};return!r||r.length===0?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-gaming-card/95 rounded-2xl p-8 text-center max-w-md",children:[e.jsx(ue,{size:48,className:"mx-auto mb-4 text-red-400"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:n==="ru"?"Нет вопросов":"Саволе нест"}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:n==="ru"?"Тест пока не содержит вопросов":"Тест ҳанӯз савол надорад"}),e.jsx("button",{onClick:d,className:"px-6 py-2 bg-gaming-primary text-white rounded-xl",children:n==="ru"?"Закрыть":"Пӯшидан"})]})}):V&&R?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 text-center relative overflow-hidden",children:[R.isPassed?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-green-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-yellow-400 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(250,204,21,0.6)] animate-bounce",children:e.jsx("div",{className:"w-20 h-20 border-4 border-yellow-600 rounded-full flex items-center justify-center bg-yellow-300",children:e.jsx("span",{className:"text-4xl font-bold text-yellow-700",children:"$"})})}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-green-400",children:n==="ru"?"Тест сдан!":"Тест супорида шуд!"}),e.jsx("p",{className:"text-green-300/80 mb-2",children:n==="ru"?"+1 монета в копилку":"+1 танга ба хазина"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(ue,{size:64,className:"mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-red-400",children:n==="ru"?"Тест не сдан":"Тест супорида нашуд"}),e.jsx("p",{className:"text-red-300/80 mb-2",children:n==="ru"?`Нужно набрать минимум ${ve}%`:`Бояд ҳадди аққал ${ve}% гиред`})]})]}),e.jsxs("div",{className:`text-5xl font-bold mb-2 relative z-10 ${R.isPassed?"text-green-400":"text-red-400"}`,children:[R.score,"%"]}),e.jsxs("p",{className:"text-gaming-textMuted relative z-10",children:[R.correct," / ",R.total," ",n==="ru"?"правильных ответов":"ҷавоби дуруст"]})]}),e.jsx("div",{className:"p-6 max-h-[50vh] overflow-y-auto space-y-4",children:R.details.map((t,i)=>e.jsx("div",{className:`p-4 rounded-xl border ${t.isCorrect?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.isCorrect?e.jsx(Y,{className:"text-green-400 mt-1",size:20}):e.jsx(ue,{className:"text-red-400 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium mb-1 flex gap-1",children:[e.jsxs("span",{children:[i+1,"."]}),e.jsx("div",{dangerouslySetInnerHTML:{__html:be(t.question)},className:"[&>p]:inline [&>p]:m-0"})]}),!t.isCorrect&&t.question.type==="multiple_choice"&&e.jsxs("div",{className:"text-sm text-green-400 flex flex-wrap gap-1",children:[e.jsx("span",{children:n==="ru"?"Правильный ответ: ":"Ҷавоби дуруст: "}),e.jsx("span",{className:"font-semibold",dangerouslySetInnerHTML:{__html:X(t.question.options.find(g=>g.id===t.question.correctId))}})]})]})]})},t.question.id))}),e.jsxs("div",{className:"p-6 border-t border-white/10 flex gap-4 justify-center",children:[e.jsxs("button",{onClick:pe,className:"flex items-center gap-2 px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20",children:[e.jsx(We,{size:18}),n==="ru"?"Пройти заново":"Аз нав"]}),R.isPassed&&e.jsxs("button",{onClick:()=>{_&&_(R),d()},className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 shadow-[0_0_15px_rgba(22,163,74,0.5)]",children:[e.jsx(Y,{size:18}),n==="ru"?"Забрать награду":"Гирифтани мукофот"]})]})]})}):e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 select-none",onContextMenu:t=>t.preventDefault(),style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"},children:[!K&&e.jsx("div",{className:"fixed inset-0 z-[100] backdrop-blur-3xl flex items-center justify-center bg-black/90 cursor-not-allowed",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(ue,{size:64,className:"mx-auto mb-4 text-red-500 animate-pulse"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:n==="ru"?"Вернитесь к тесту!":"Ба тест баргардед!"}),e.jsx("p",{className:"text-white/80",children:n==="ru"?"Контент скрыт при потере фокуса":"Мундариҷа ҳангоми гум кардани фокус пинҳон карда мешавад"})]})}),e.jsxs("div",{className:`w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 overflow-hidden relative transition-all duration-300 ${K?"":"opacity-0 pointer-events-none"}`,children:[e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-[0.03] flex flex-wrap content-center justify-center gap-8 rotate-12 scale-150",children:Array.from({length:20}).map((t,i)=>e.jsx("div",{className:"text-2xl font-black text-white whitespace-nowrap",children:"DONISHMAND PLATFORM"},i))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[n==="ru"?"Вопрос":"Савол"," ",C+1," / ",x]}),e.jsx("div",{className:"flex gap-1",children:w.map((t,i)=>{const g=(()=>{const T=b[t==null?void 0:t.id];return T==null||T===""?!1:(t==null?void 0:t.type)==="matching"&&typeof T=="object"?Object.keys(T).length>=t.leftItems.length:!0})(),o=j&&!g;return e.jsx("button",{onClick:()=>f(i),title:`${n==="ru"?"Вопрос":"Савол"} ${i+1}${g?"":n==="ru"?" (нет ответа)":" (ҷавоб нест)"}`,className:`w-2.5 h-2.5 rounded-full transition-all duration-300 cursor-pointer hover:scale-150 ${i===C?"bg-gaming-primary scale-125":g?"bg-white/60":o?"bg-red-500 animate-pulse scale-125":"bg-white/20 hover:bg-white/40"}`},i)})})]}),e.jsx("button",{onClick:d,className:"p-2 text-gaming-textMuted hover:text-white",children:e.jsx(he,{size:24})})]}),e.jsxs("div",{className:"p-6 relative z-10",children:[e.jsx("div",{className:"text-xl font-medium mb-6 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:be(s)}}),s.image&&e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-white/10 bg-black/20 flex justify-center",children:e.jsx("img",{src:s.image,alt:"Question",className:"max-w-full max-h-[400px] object-contain"})}),s.type==="multiple_choice"&&(()=>{const t=S(s.id);return e.jsxs("div",{className:"space-y-3",children:[t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg text-sm text-gaming-textMuted",children:[e.jsx(we,{size:14}),e.jsx("span",{children:n==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"})]}),s.options.map((i,g)=>{const o=b[s.id]===i.id;return e.jsxs("button",{onClick:()=>ie(s.id,i.id),disabled:t,className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${o?"bg-gaming-primary/20 border-gaming-primary":t?"bg-white/5 border-white/5 opacity-40 cursor-not-allowed":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 ${o?"bg-gaming-primary text-white":"bg-white/10"}`,children:String.fromCharCode(65+g)}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:X(i)}}),i.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[200px]",children:e.jsx("img",{src:i.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),o&&t&&e.jsx(we,{size:16,className:"text-gaming-textMuted shrink-0"})]},i.id)})]})})(),s.type==="matching"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4 border-b border-white/10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-pink uppercase tracking-wider mb-2",children:n==="ru"?"Группа 1":"Гурӯҳи 1"}),s.leftItems.map((t,i)=>e.jsxs("div",{className:"text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"font-bold text-gaming-pink min-w-[20px] pt-1",children:[String.fromCharCode(65+i),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:X(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-accent uppercase tracking-wider mb-2",children:n==="ru"?"Группа 2":"Гурӯҳи 2"}),s.rightItems.map((t,i)=>e.jsxs("div",{className:"text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"font-bold text-gaming-accent min-w-[20px] pt-1",children:[i+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:X(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]})]}),e.jsx("p",{className:"text-sm text-gaming-textMuted text-center",children:n==="ru"?"Выберите соответствия в сетке:":"Мувофиқатро дар ҷадвал интихоб кунед:"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"overflow-x-auto max-w-full pb-2",children:e.jsxs("table",{className:"border-separate border-spacing-1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8"}),s.rightItems.map((t,i)=>e.jsx("th",{className:"text-center font-bold text-gaming-accent text-sm p-1",children:i+1},t.id))]})}),e.jsx("tbody",{children:s.leftItems.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-bold text-gaming-pink text-sm p-1",children:String.fromCharCode(65+i)}),s.rightItems.map(g=>{var H;const o=((H=b[s.id])==null?void 0:H[t.id])===g.id,T=S(s.id);return e.jsx("td",{className:"text-center p-0.5",children:e.jsx("button",{onClick:()=>ie(s.id,{...b[s.id]||{},[t.id]:g.id}),disabled:T,className:`w-8 h-8 rounded-full border-2 transition-all flex items-center justify-center
                                                                        ${o?"bg-gaming-primary border-gaming-primary":T?"bg-white/5 border-white/10 opacity-30 cursor-not-allowed":"bg-white/5 border-white/20 hover:border-white/40"}`,children:o&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})},g.id)})]},t.id))})]})})})]}),s.type==="numeric"&&(()=>{const t=S(s.id);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gaming-textMuted",children:t?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(we,{size:14})," ",n==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"]}):n==="ru"?"Введите ответ:":"Ҷавобро ворид кунед:"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[[0,1,2,3].map(i=>e.jsx("input",{type:"text",maxLength:1,disabled:t,value:(b[s.id]||"")[i]||"",onChange:g=>{const o=g.target.value;if(o&&!/^\d$/.test(o))return;const H=(b[s.id]||"").split("");if(H[i]=o,ie(s.id,H.join("")),o&&i<3){const D=g.target.nextElementSibling;D&&D.focus()}},className:`w-14 h-14 text-center text-2xl font-bold rounded-lg text-white focus:outline-none ${t?"bg-gaming-bg/50 border-2 border-gaming-primary/30 opacity-70 cursor-not-allowed":"bg-gaming-bg/50 border-2 border-white/20 focus:border-gaming-primary"}`},i)),s.unit&&e.jsx("span",{className:"text-xl text-gaming-textMuted ml-2",children:s.unit})]})]})})()]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-white/10 relative z-10",children:[C>0?e.jsxs("button",{onClick:z,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white hover:bg-white/10",children:[e.jsx(Ne,{size:18}),n==="ru"?"Назад":"Қафо"]}):e.jsx("div",{}),C===x-1?e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[j&&M&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-500/20 border border-red-500/40 text-red-400 rounded-xl text-sm animate-bounce",children:[e.jsx(Ze,{size:16,className:"shrink-0"}),e.jsx("span",{children:M})]}),e.jsxs("button",{onClick:ge,className:`flex items-center gap-2 px-6 py-2 rounded-xl transition-all ${j?"bg-red-500/80 text-white animate-[shake_0.5s_ease-in-out]":"bg-gaming-primary text-white hover:bg-gaming-primary/80"}`,children:[e.jsx(Y,{size:18}),n==="ru"?"Завершить тест":"Тамом кардан"]})]}):e.jsxs("button",{onClick:xe,className:"flex items-center gap-2 px-4 py-2 text-white hover:bg-white/10 rounded-xl",children:[n==="ru"?"Далее":"Оянда",e.jsx(ye,{size:18})]})]})]})]})},st=({questions:r,lang:m,onClose:n})=>{const[d,_]=u.useState(!1),[C,f]=u.useState({});if(!r||r.length===0)return null;const b=a=>{f(c=>({...c,[a]:!c[a]}))},y=()=>{const a=!d;_(a);const c={};r.forEach(j=>c[j.id]=a),f(c)},V=a=>{const c=m==="tj"&&a.textTj||a.textRu;return de(c||"")},l=a=>{const c=m==="tj"&&a.textTj||a.textRu;return de(c||"")};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-4xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8 shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:m==="ru"?"Режим учителя: Просмотр теста":"Реҷаи омӯзгор: Дидани тест"}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[r.length," ",m==="ru"?"вопросов":"савол"]})]}),e.jsx("button",{onClick:n,className:"p-2 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(he,{size:24})})]}),e.jsx("div",{className:"p-4 bg-black/20 border-b border-white/5 flex justify-between items-center shrink-0",children:e.jsxs("button",{onClick:y,className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all ${d?"bg-gaming-primary text-white":"bg-white/10 text-gaming-textMuted hover:text-white"}`,children:[d?e.jsx(Fe,{size:18}):e.jsx(ce,{size:18}),d?m==="ru"?"Скрыть все ответы":"Пинҳон кардани ҷавобҳо":m==="ru"?"Показать все ответы":"Нишон додани ҷавобҳо"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:r.map((a,c)=>{const j=C[a.id];return e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-gaming-pink/10 text-gaming-pink rounded-lg flex items-center justify-center font-bold text-sm border border-gaming-pink/20",children:c+1}),e.jsx("div",{className:"text-lg font-medium text-white pt-1 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:V(a)}}),a.image&&e.jsx("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-md",children:e.jsx("img",{src:a.image,alt:"Question",className:"w-full h-auto object-cover"})})]}),e.jsx("button",{onClick:()=>b(a.id),className:`p-2 rounded-lg transition-colors ${j?"text-gaming-primary bg-gaming-primary/10":"text-gaming-textMuted hover:bg-white/5"}`,title:m==="ru"?"Показать/Скрыть ответ":"Нишон додан/Пинҳон кардан",children:j?e.jsx(Fe,{size:20}):e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"transition-all duration-300",children:[a.type==="multiple_choice"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pl-11",children:a.options.map((p,M)=>{const E=p.id===a.correctId&&j;return e.jsxs("div",{className:`p-3 rounded-xl border flex items-center gap-3 transition-all duration-300 ${E?"bg-green-500/10 border-green-500/30 text-green-400 font-bold":"bg-black/20 border-white/5 text-gaming-textMuted"}`,children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs transition-colors ${E?"bg-green-500 text-white":"bg-white/10"}`,children:String.fromCharCode(65+M)}),e.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:l(p)}}),p.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[150px]",children:e.jsx("img",{src:p.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),E&&e.jsx(Y,{size:16,className:"ml-auto animate-in zoom-in duration-300 shrink-0"})]},p.id)})}),a.type==="matching"&&e.jsxs("div",{className:"pl-11 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:m==="ru"?"Элементы":"Элементҳо"}),a.leftItems.map((p,M)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"text-gaming-pink font-bold mt-0.5",children:[String.fromCharCode(65+M),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:l(p)}}),p.image&&e.jsx("img",{src:p.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},p.id))]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:m==="ru"?"Определения":"Таърифҳо"}),a.rightItems.map((p,M)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"text-gaming-accent font-bold mt-0.5",children:[M+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:l(p)}}),p.image&&e.jsx("img",{src:p.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},p.id))]})]}),j&&e.jsxs("div",{className:"p-4 bg-green-500/5 border border-green-500/20 rounded-xl animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx("p",{className:"text-sm text-green-400 font-bold mb-2",children:m==="ru"?"Правильные пары:":"Ҷуфтҳои дуруст:"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(a.correctMatches).map(([p,M])=>{const P=a.leftItems.findIndex(F=>F.id===p),E=a.rightItems.findIndex(F=>F.id===M);return e.jsxs("span",{className:"px-2 py-1 bg-green-500/10 rounded border border-green-500/20 text-sm",children:[String.fromCharCode(65+P)," — ",E+1]},p)})})]})]}),a.type==="numeric"&&e.jsx("div",{className:"pl-11",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 bg-green-500/5 border border-white/5 rounded-xl transition-all duration-300",children:[e.jsx("span",{className:"text-sm text-gaming-textMuted",children:m==="ru"?"Ответ:":"Ҷавоб:"}),e.jsx("span",{className:`text-xl font-bold tracking-widest transition-all duration-300 ${j?"text-green-400":"text-white/20"}`,children:j?a.digits.join(""):"****"}),a.unit&&e.jsx("span",{className:"text-gaming-textMuted",children:a.unit}),j&&e.jsx(Y,{size:16,className:"text-green-400 animate-in zoom-in"})]})})]})]},a.id)})})]})})},re=(r,m)=>`progress_${r}_${m}`,dt=({lang:r,t:m,userRole:n})=>{var Ce,Ie,Me,Te,$e,_e,Re,Le,Ee;const{lessonId:d}=Ke(),_=Ue(),C=80,[f,b]=u.useState(!0),[y,V]=u.useState(null),[l,a]=u.useState(()=>({videoWatched:localStorage.getItem(re(d,"video"))==="true",textRead:localStorage.getItem(re(d,"text"))==="true",slidesViewed:JSON.parse(localStorage.getItem(re(d,"slides"))||"[]"),testHistory:JSON.parse(localStorage.getItem(`test_history_${d}`)||"[]")})),[c,j]=u.useState("video"),[p,M]=u.useState(!1),[P,E]=u.useState(!1),[F,K]=u.useState(!1),I=n==="teacher";u.useEffect(()=>{(async()=>{b(!0);try{const v=await Ve.getLesson(d);if(!v){V(null),b(!1);return}const O=v.subject;let Z=null;if(O){const ee=await Ve.getStructure(O);if(ee&&ee.sections)for(let te=0;te<ee.sections.length;te++){const G=ee.sections[te];for(let se=0;se<G.topics.length;se++){const fe=G.topics[se],je=fe.lessons.findIndex(Je=>Je.id===d);if(je!==-1){Z={lesson:{...v,...fe.lessons[je],content:v.content},topic:fe,section:G,subjectKey:O,lessonIndex:je,topicIndex:se,sectionIndex:te};break}}if(Z)break}}V(Z||{lesson:v,subjectKey:O})}catch(v){console.error("Error fetching lesson:",v)}finally{b(!1)}})()},[d]);const N=((Ce=y==null?void 0:y.lesson)==null?void 0:Ce.content)||{},w=!!((Ie=N.video)!=null&&Ie.url),s=!!((Me=N.text)!=null&&Me.bodyRu||(Te=N.text)!=null&&Te.bodyTj),x=r==="tj"?N.slidesTj||[]:N.slidesRu||[],S=x.length>0,W=((_e=($e=N.test)==null?void 0:$e.questions)==null?void 0:_e.length)>0,ie=w||s||S,xe=((Re=N.test)==null?void 0:Re.questions)||[],z=u.useMemo(()=>{if(!l.testHistory||l.testHistory.length===0)return null;const h=l.testHistory.length,v=Math.max(...l.testHistory.map(G=>G.score)),O=l.testHistory.reduce((G,se)=>G+se.score,0)/h,Z=Math.round(100-O),ee=l.testHistory[l.testHistory.length-1].timestamp,te=v>=C;return{totalAttempts:h,bestScore:v,avgErrorRate:Z,lastAttemptAt:ee,isPassed:te}},[l.testHistory]),R=x.length,U=l.slidesViewed.length,A=R>0?U>=R:!0,ge=!w||l.videoWatched,pe=!s||l.textRead,X=I||ge&&pe&&(!S||A),t=[w,s,S,W].filter(Boolean).length;let i=0;w&&l.videoWatched&&i++,s&&l.textRead&&i++,S&&A&&i++,W&&(z!=null&&z.isPassed)&&i++;const g=t>0?Math.round(i/t*100):0;u.useEffect(()=>{!f&&y&&(w?j("video"):s?j("text"):S&&j("slides"))},[f,w,s,S]);const o=()=>{I||(localStorage.setItem(re(d,"video"),"true"),a(h=>({...h,videoWatched:!0})))},T=()=>{I||l.textRead||(localStorage.setItem(re(d,"text"),"true"),a(h=>({...h,textRead:!0})))},H=h=>{if(I)return;const v=[...new Set([...l.slidesViewed,h])];localStorage.setItem(re(d,"slides"),JSON.stringify(v)),a(O=>({...O,slidesViewed:v}))},D=()=>{X?K(!0):E(!0)},ne=h=>{console.log("Test completed:",h);const v=JSON.parse(localStorage.getItem(`test_history_${d}`)||"[]");a(O=>({...O,testHistory:v}))};if(f)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gaming-bg",children:e.jsx(Ge,{size:40,className:"text-gaming-primary animate-spin"})});if(!y)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-white bg-gaming-bg",children:[e.jsx("h2",{className:"text-2xl mb-4",children:r==="ru"?"Урок не найден":"Дарс ёфт нашуд"}),e.jsx("button",{onClick:()=>_(-1),className:"text-gaming-primary hover:underline",children:r==="ru"?"Назад":"Бозгашт"})]});const{lesson:L,topic:$,section:k,subjectKey:le,lessonIndex:q,sectionIndex:Qe,topicIndex:De}=y,ke=h=>r==="tj"&&h.titleTj?h.titleTj:h.title,Se=(Le=$==null?void 0:$.lessons)==null?void 0:Le[q-1],ze=(Ee=$==null?void 0:$.lessons)==null?void 0:Ee[q+1],ae=[];return w&&ae.push({id:"video",icon:He,label:{ru:"Видео",tj:"Видео"},complete:l.videoWatched}),s&&ae.push({id:"text",icon:Oe,label:{ru:"Конспект",tj:"Матн"},complete:l.textRead}),S&&ae.push({id:"slides",icon:me,label:{ru:"Слайды",tj:"Слайдҳо"},complete:A}),e.jsxs(Xe,{subjectId:le,lang:r,children:[e.jsxs("div",{className:"max-w-4xl",children:[e.jsx("header",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gaming-textMuted mb-1",children:[r==="ru"?"Урок":"Дарс"," ",q+1," / ",$.lessons.length]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2 text-gaming-pink",children:[q+1,". ",ke(L)]}),e.jsx("p",{className:"text-gaming-textMuted flex items-center gap-2 text-sm",children:e.jsxs("span",{children:[Qe+1,".",De+1,". ",ke($)]})})]}),I&&e.jsx("div",{className:"px-3 py-1 bg-gaming-pink text-white text-xs font-bold rounded-full uppercase tracking-wider animate-pulse",children:r==="ru"?"Режим учителя":"Реҷаи омӯзгор"})]})}),!I&&e.jsxs("div",{className:"mb-8 bg-gradient-to-br from-gaming-primary/20 to-gaming-pink/20 backdrop-blur-xl border border-white/10 rounded-2xl p-6 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg mb-1",children:r==="ru"?"Прогресс урока":"Пешрафти дарс"}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[i," / ",t," ",r==="ru"?"этапов завершено":"марҳила анҷом ёфт"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-3xl font-bold text-gaming-primary",children:[g,"%"]})})]}),e.jsx("div",{className:"w-full h-3 bg-black/30 rounded-full mb-6 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gaming-primary to-gaming-pink transition-all duration-1000 ease-out",style:{width:`${g}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[w&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${l.videoWatched?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${l.videoWatched?"bg-green-500/20":"bg-white/10"}`,children:l.videoWatched?e.jsx(Q,{size:20}):e.jsx(He,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:"Видео"})]}),s&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${l.textRead?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${l.textRead?"bg-green-500/20":"bg-white/10"}`,children:l.textRead?e.jsx(Q,{size:20}):e.jsx(Oe,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:r==="ru"?"Текст":"Матн"})]}),S&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${A?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${A?"bg-green-500/20":"bg-white/10"}`,children:A?e.jsx(Q,{size:20}):e.jsx(me,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:r==="ru"?"Слайды":"Слайдҳо"}),e.jsxs("span",{className:"text-xs opacity-70",children:[U,"/",R]})]})]}),W&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${z!=null&&z.isPassed?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${z!=null&&z.isPassed?"bg-green-500/20":"bg-white/10"}`,children:z!=null&&z.isPassed?e.jsx(Q,{size:20}):e.jsx(Y,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:"Тест"}),z&&e.jsxs("span",{className:"text-xs font-bold",children:[z.bestScore,"%"]})]})]})]})]}),z&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-white/10 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(We,{size:18,className:"text-gaming-gold"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:r==="ru"?"Попыток":"Кӯшишҳо"}),e.jsx("div",{className:"font-bold text-white",children:z.totalAttempts})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(Ye,{size:18,className:"text-gaming-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:r==="ru"?"Последняя":"Охирин"}),e.jsx("div",{className:"font-bold text-white",children:z.lastAttemptAt?new Intl.DateTimeFormat(r==="tj"?"tg-TJ":"ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}).format(new Date(z.lastAttemptAt)):"-"})]})]})]})]}),ie?e.jsxs(e.Fragment,{children:[ae.length>0&&e.jsx("div",{className:"flex gap-4 mb-6 border-b border-white/5 overflow-x-auto",children:ae.map(h=>{const v=h.icon;return e.jsxs("button",{onClick:()=>j(h.id),className:`pb-3 px-2 text-base font-semibold transition-all relative flex items-center gap-2 whitespace-nowrap ${c===h.id?"text-white":"text-gaming-textMuted hover:text-white"}`,children:[e.jsx(v,{size:18}),h.label[r],h.complete&&!I&&e.jsx(Q,{size:14,className:"text-green-400"}),c===h.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gaming-pink rounded-t-full shadow-[0_0_10px_rgba(236,72,153,0.5)]"})]},h.id)})}),e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-6 mb-6 shadow-xl overflow-hidden relative group",children:[e.jsx("div",{className:"absolute -left-20 -top-20 w-64 h-64 bg-gaming-pink/5 rounded-full blur-3xl group-hover:bg-gaming-pink/10 transition-all duration-700"}),e.jsxs("div",{className:"relative z-10",children:[c==="video"&&w&&e.jsxs("div",{className:"aspect-video bg-black/60 rounded-xl flex flex-col items-center justify-center border border-white/10 shadow-inner overflow-hidden relative",children:[N.video.url.includes("youtube")||N.video.url.includes("youtu.be")?e.jsx("iframe",{src:N.video.url.replace("watch?v=","embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onLoad:o}):e.jsx("video",{src:N.video.url,controls:!0,className:"w-full h-full",onEnded:o,onPlay:()=>setTimeout(o,3e4)}),!l.videoWatched&&!I&&e.jsxs("button",{onClick:o,className:"absolute bottom-4 right-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(ce,{size:16}),r==="ru"?"Отметить как просмотренное":"Ҳамчун дидашуда қайд кунед"]})]}),c==="text"&&s&&e.jsxs("div",{className:"prose prose-invert max-w-none prose-p:text-gaming-textMuted prose-headings:text-white prose-li:text-gaming-textMuted",onScroll:h=>{const{scrollTop:v,scrollHeight:O,clientHeight:Z}=h.target;v+Z>=O-50&&T()},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:de(r==="tj"&&N.text.bodyTj||N.text.bodyRu)}}),!l.textRead&&!I&&e.jsxs("button",{onClick:T,className:"mt-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(ce,{size:16}),r==="ru"?"Отметить как прочитанное":"Ҳамчун хондашуда қайд кунед"]})]}),c==="slides"&&S&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gaming-textMuted",children:[U," / ",R," ",r==="ru"?"слайдов просмотрено":"слайд дида шуд"]}),e.jsxs("button",{onClick:()=>M(!0),className:"flex items-center gap-2 px-4 py-2 bg-gaming-gold/20 text-gaming-gold rounded-xl hover:bg-gaming-gold/30 transition-colors",children:[e.jsx(me,{size:18}),r==="ru"?"Открыть презентацию":"Кушодани презентатсия"]})]}),e.jsx("div",{className:"flex flex-col gap-6",children:x.map((h,v)=>e.jsxs("button",{onClick:()=>{H(h.id),M(!0)},className:"relative w-full rounded-2xl overflow-hidden border border-white/5 hover:border-gaming-gold/30 transition-all group shadow-lg",children:[e.jsx("img",{src:h.imageUrl,alt:`Slide ${v+1}`,className:"w-full h-auto object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-sm",children:e.jsx("div",{className:"bg-black/60 p-3 rounded-full border border-white/20 transform scale-90 group-hover:scale-100 transition-transform",children:e.jsx(me,{size:24,className:"text-white"})})}),e.jsx("div",{className:"absolute top-4 left-4 bg-black/60 backdrop-blur px-3 py-1 rounded-full text-white font-bold text-sm border border-white/10",children:v+1}),(l.slidesViewed.includes(h.id)||I)&&e.jsx("div",{className:"absolute top-4 right-4 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center shadow-lg animate-in fade-in zoom-in",children:e.jsx(Q,{size:16,className:"text-white"})})]},h.id))})]})]})]})]}):e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-8 mb-6 text-center",children:[e.jsx(Be,{size:48,className:"mx-auto mb-4 text-gaming-primary opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:r==="ru"?"Тестирование":"Санҷиш"}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:r==="ru"?"Этот урок содержит только тест.":"Ин дарс танҳо тест дорад."})]}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-red-500/30 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-400 mb-4",children:[e.jsx(oe,{size:24}),e.jsx("h3",{className:"text-lg font-semibold",children:r==="ru"?"Просмотрите материалы":"Маводҳоро бинед"})]}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:r==="ru"?"Перед началом теста необходимо просмотреть все материалы урока:":"Пеш аз оғози тест бояд ҳамаи маводҳои дарсро бинед:"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[w&&e.jsxs("li",{className:`flex items-center gap-2 ${l.videoWatched?"text-green-400":"text-red-400"}`,children:[l.videoWatched?e.jsx(Q,{size:16}):e.jsx(oe,{size:16}),"Видео"]}),s&&e.jsxs("li",{className:`flex items-center gap-2 ${l.textRead?"text-green-400":"text-red-400"}`,children:[l.textRead?e.jsx(Q,{size:16}):e.jsx(oe,{size:16}),r==="ru"?"Текст":"Матн"]}),S&&e.jsxs("li",{className:`flex items-center gap-2 ${A?"text-green-400":"text-red-400"}`,children:[A?e.jsx(Q,{size:16}):e.jsx(oe,{size:16}),r==="ru"?`Слайды (${U}/${R})`:`Слайдҳо (${U}/${R})`]})]}),e.jsx("button",{onClick:()=>E(!1),className:"w-full px-4 py-3 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors",children:r==="ru"?"Понятно":"Фаҳмидам"})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[Se&&e.jsxs("button",{onClick:()=>_(`/lesson/${Se.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx(Ne,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:r==="ru"?"Предыдущий":"Пешина"})]}),ze&&e.jsxs("button",{onClick:()=>_(`/lesson/${ze.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:r==="ru"?"Следующий":"Оянда"}),e.jsx(ye,{size:16})]})]}),e.jsxs("button",{onClick:D,className:`group font-bold py-3 px-8 rounded-xl flex items-center gap-2 transition-all transform hover:scale-[1.02] active:scale-95 shadow-lg border border-white/10 ${X?I?"bg-gaming-pink hover:bg-gaming-pink/80 text-white shadow-gaming-pink/25":"bg-gaming-primary hover:bg-gaming-primary/80 text-white shadow-gaming-primary/25":"bg-gaming-card/60 text-gaming-textMuted cursor-not-allowed"}`,children:[I?e.jsx(ce,{size:20}):e.jsx(Y,{size:20}),e.jsx("span",{children:I?r==="ru"?"Просмотреть тест":"Дидани тест":r==="ru"?"Пройти тест":"Супоридани тест"}),!X&&e.jsx(oe,{size:16,className:"text-yellow-400"})]})]})]}),p&&S&&e.jsx(et,{slides:x,lessonId:d,lang:r,onClose:()=>M(!1),onSlideView:H}),F&&(I?e.jsx(st,{questions:xe,lang:r,onClose:()=>K(!1)}):e.jsx(tt,{questions:xe,lessonId:d,lang:r,onClose:()=>K(!1),onComplete:ne}))]})};export{dt as default};
