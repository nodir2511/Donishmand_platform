import{e as ve,u as Xe,R as Be,r as h,j as e,X as je,C as Ce,a as et,b as tt,c as st,L as rt}from"./index-CrMD2eKm.js";import{C as nt}from"./CourseLayout-Cji7AdFi.js";import{C as K,a as we,k as Qe,V as De,P as pe,b as it}from"./katex-CDMxUWGs.js";import{C as q,A as xe}from"./check-circle-BgF3bWMp.js";import{L as ke}from"./lock-DxRwDj5d.js";import{A as lt}from"./alert-triangle-D8YQNU7J.js";import{E as Je,a as me}from"./eye-BWEePMy6.js";import{F as Ke,s as Ue}from"./SyllabusContext-BFdS8Iuu.js";import"./home-Te0i9fN5.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=ve("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=ve("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ve("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=ve("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ct=({slides:s,lessonId:u,onClose:r,onSlideView:g})=>{const{i18n:L}=Xe(),C=L.resolvedLanguage||"ru",I=Be.useRef(null),[b,y]=h.useState(0),[T,o]=h.useState(!1),[l,N]=h.useState(()=>{const i=localStorage.getItem(`viewed_slides_${u}`);return i?JSON.parse(i):[]}),d=s[b];h.useEffect(()=>{if(d&&!l.includes(d.id)){const i=[...l,d.id];N(i),localStorage.setItem(`viewed_slides_${u}`,JSON.stringify(i)),g&&g(d.id)}},[b,d,l,u,g]);const p=h.useCallback(i=>{i.key==="ArrowLeft"||i.key==="ArrowUp"?y(x=>x>0?x-1:x):i.key==="ArrowRight"||i.key==="ArrowDown"||i.key===" "?y(x=>x<s.length-1?x+1:x):i.key==="Escape"?T?o(!1):r():(i.key==="f"||i.key==="F")&&o(x=>!x)},[s.length,T,r]);h.useEffect(()=>(window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)),[p]),h.useEffect(()=>{const i=()=>{o(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",i),I.current&&I.current.requestFullscreen().catch(x=>{console.log("Auto-fullscreen blocked:",x)}),()=>{document.removeEventListener("fullscreenchange",i),document.fullscreenElement&&document.exitFullscreen().catch(x=>console.log("Exit fullscreen error:",x))}},[]);const[z,H]=h.useState(null),E=i=>{H(i.touches[0].clientX)},P=i=>{if(!z)return;const x=i.changedTouches[0].clientX,M=z-x;Math.abs(M)>50&&(M>0&&b<s.length-1?y(O=>O+1):M<0&&b>0&&y(O=>O-1)),H(null)},X=()=>y(i=>i>0?i-1:i),ae=()=>y(i=>i<s.length-1?i+1:i),W=()=>{var i;document.fullscreenElement?document.exitFullscreen().catch(x=>console.log(x)):(i=I.current)==null||i.requestFullscreen().catch(x=>console.log(x))},j=T?"fixed inset-0 z-[100] bg-black":"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",c=T?"w-full h-full flex items-center justify-center":"w-full max-w-5xl max-h-[80vh] flex items-center justify-center";return e.jsxs("div",{ref:I,className:j,onTouchStart:E,onTouchEnd:P,children:[!T&&e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[b+1," / ",s.length]}),l.includes(d==null?void 0:d.id)&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs",children:[e.jsx(K,{size:12}),C==="ru"?"Просмотрено":"Дида шуд"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:W,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",title:"Fullscreen (F)",children:e.jsx(ot,{size:20})}),e.jsx("button",{onClick:r,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",children:e.jsx(je,{size:24})})]})]}),T&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("button",{onClick:r,className:"p-2 text-white/50 hover:text-white transition-colors",children:e.jsx(je,{size:24})})}),e.jsx("div",{className:c,children:d&&e.jsx("img",{src:d.imageUrl,alt:C==="tj"&&d.captionTj||d.captionRu,className:T?"max-w-full max-h-full object-contain":"max-w-full max-h-[70vh] object-contain rounded-lg"})}),!T&&d&&(d.captionRu||d.captionTj)&&e.jsx("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 max-w-2xl text-center",children:e.jsx("p",{className:"text-white/90 text-lg bg-black/50 px-6 py-3 rounded-xl backdrop-blur-sm",children:C==="tj"&&d.captionTj||d.captionRu})}),e.jsx("button",{onClick:X,disabled:b===0,className:`absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${b===0?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(we,{size:32})}),e.jsx("button",{onClick:ae,disabled:b===s.length-1,className:`absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${b===s.length-1?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(Ce,{size:32})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-2",children:s.map((i,x)=>e.jsx("button",{onClick:()=>y(x),className:`w-2 h-2 rounded-full transition-all ${x===b?"bg-white w-4":l.includes(i.id)?"bg-green-500/70 hover:bg-green-500":"bg-white/30 hover:bg-white/50"}`},i.id))}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/10",children:e.jsx("div",{className:"h-full bg-gaming-primary transition-all duration-300",style:{width:`${(b+1)/s.length*100}%`}})})]})},Y=s=>{const u=[...s];for(let r=u.length-1;r>0;r--){const g=Math.floor(Math.random()*(r+1));[u[r],u[g]]=[u[g],u[r]]}return u},ue=s=>{if(!s||typeof s!="string")return s;let u=s.replace(/\$\$([^$]+?)\$\$/g,(r,g)=>{try{return Qe.renderToString(g.trim(),{displayMode:!0,throwOnError:!1,output:"html"})}catch(L){return console.warn("Ошибка рендеринга KaTeX:",L),r}});return u=u.replace(/\$([^$]+?)\$/g,(r,g)=>{try{return Qe.renderToString(g.trim(),{displayMode:!1,throwOnError:!1,output:"html"})}catch(L){return console.warn("Ошибка рендеринга KaTeX:",L),r}}),u},Se=80,dt=({questions:s,lessonId:u,lang:r,onClose:g,onComplete:L})=>{const[C,I]=h.useState(0),[b,y]=h.useState({}),[T,o]=h.useState(!1),[l,N]=h.useState(0),[d,p]=h.useState(!1),[z,H]=h.useState(""),[E,P]=h.useState(new Set),[X,ae]=h.useState(!0);Be.useEffect(()=>{const t=()=>{const f=document.hasFocus()&&!document.hidden;ae(f)};window.addEventListener("focus",t),window.addEventListener("blur",t),document.addEventListener("visibilitychange",t);const n=setInterval(t,300);return()=>{window.removeEventListener("focus",t),window.removeEventListener("blur",t),document.removeEventListener("visibilitychange",t),clearInterval(n)}},[]);const W=`test_progress_v2_${u}`,j=h.useMemo(()=>{if(!s)return[];const t=localStorage.getItem(W);if(t&&l===0)try{const a=JSON.parse(t);if(!(a.questions&&a.questions.every($=>$.textRu&&$.textRu.trim().length>0||$.textTj&&$.textTj.trim().length>0)))console.warn("Кэш теста содержит пустые вопросы. Очистка..."),localStorage.removeItem(W);else if(a.questions&&a.answers&&a.locked){y(a.answers),P(new Set(a.locked)),I(a.currentIndex||0);const $=new Set(a.locked),A=a.questions.filter(S=>$.has(S.id)),se=new Set(A.map(S=>S.id)),_=Y(s.filter(S=>!se.has(S.id))),J=Math.min(10,s.length)-A.length,U=_.slice(0,Math.max(0,J)).map(S=>S.type==="multiple_choice"?{...S,options:Y(S.options)}:S.type==="matching"?{...S,leftItems:Y(S.leftItems),rightItems:Y(S.rightItems)}:S);return[...A,...U]}}catch(a){console.warn("Ошибка восстановления прогресса теста:",a),localStorage.removeItem(W)}return Y(s).slice(0,10).map(a=>a.type==="multiple_choice"?{...a,options:Y(a.options)}:a.type==="matching"?{...a,leftItems:Y(a.leftItems),rightItems:Y(a.rightItems)}:a)},[s,l,W]),c=j[C],i=j.length;h.useEffect(()=>{if(j.length>0&&!T){const t={questions:j,answers:b,locked:[...E],currentIndex:C};localStorage.setItem(W,JSON.stringify(t))}},[b,E,C,j,T]);const x=t=>E.has(t),M=()=>{const t=j[C];if(!t)return;const n=b[t.id];n!=null&&n!==""&&P(f=>new Set([...f,t.id]))},O=(t,n)=>{x(t)||y(f=>({...f,[t]:n}))},V=()=>{C<i-1&&(M(),I(t=>t+1))},oe=()=>{C>0&&I(t=>t-1)},[Q,ce]=h.useState(null),v=h.useMemo(()=>j.filter(t=>{const n=b[t.id];return n==null||n===""?!0:t.type==="matching"&&typeof n=="object"?Object.keys(n).length<t.leftItems.length:!1}).length,[b,j]);h.useEffect(()=>{if(d){const t=setTimeout(()=>{p(!1),H("")},3e3);return()=>clearTimeout(t)}},[d]);const G=()=>{if(M(),v>0){p(!0);const _=r==="ru"?`Вы не ответили на ${v} ${v===1?"вопрос":v<5?"вопроса":"вопросов"}!`:`Шумо ба ${v} савол ҷавоб надодаед!`;H(_);return}let t=0;const n=j.map(_=>{const J=b[_.id];let U=!1;if(_.type==="multiple_choice")U=J===_.correctId;else if(_.type==="matching")U=Object.entries(_.correctMatches).every(([S,R])=>(J==null?void 0:J[S])===R);else if(_.type==="numeric"){const S=_.digits.join("");U=J===S}return U&&t++,{question:_,userAnswer:J,isCorrect:U}}),f=Math.round(t/i*100),a=f>=Se,k=`test_history_${u}`,$=JSON.parse(localStorage.getItem(k)||"[]"),A={score:f,correct:t,total:i,timestamp:Date.now(),passed:a},se=[...$,A];if(localStorage.setItem(k,JSON.stringify(se)),localStorage.setItem(`test_result_${u}`,JSON.stringify(A)),a){const _=parseInt(localStorage.getItem("user_coins")||"0");localStorage.setItem("user_coins",(_+1).toString())}ce({correct:t,total:i,score:f,isPassed:a,details:n}),o(!0),localStorage.removeItem(W)},ee=()=>{localStorage.removeItem(W),I(0),y({}),p(!1),H(""),P(new Set),ce(null),o(!1),N(t=>t+1)},D=t=>{const n=r==="tj"&&t.textTj||t.textRu;return ue(n||"")},te=t=>{const n=r==="tj"&&t.textTj||t.textRu;return ue(n||"")};return!s||s.length===0?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-gaming-card/95 rounded-2xl p-8 text-center max-w-md",children:[e.jsx(fe,{size:48,className:"mx-auto mb-4 text-red-400"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:r==="ru"?"Нет вопросов":"Саволе нест"}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:r==="ru"?"Тест пока не содержит вопросов":"Тест ҳанӯз савол надорад"}),e.jsx("button",{onClick:g,className:"px-6 py-2 bg-gaming-primary text-white rounded-xl",children:r==="ru"?"Закрыть":"Пӯшидан"})]})}):T&&Q?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 text-center relative overflow-hidden",children:[Q.isPassed?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-green-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-yellow-400 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(250,204,21,0.6)] animate-bounce",children:e.jsx("div",{className:"w-20 h-20 border-4 border-yellow-600 rounded-full flex items-center justify-center bg-yellow-300",children:e.jsx("span",{className:"text-4xl font-bold text-yellow-700",children:"$"})})}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-green-400",children:r==="ru"?"Тест сдан!":"Тест супорида шуд!"}),e.jsx("p",{className:"text-green-300/80 mb-2",children:r==="ru"?"+1 монета в копилку":"+1 танга ба хазина"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(fe,{size:64,className:"mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-red-400",children:r==="ru"?"Тест не сдан":"Тест супорида нашуд"}),e.jsx("p",{className:"text-red-300/80 mb-2",children:r==="ru"?`Нужно набрать минимум ${Se}%`:`Бояд ҳадди аққал ${Se}% гиред`})]})]}),e.jsxs("div",{className:`text-5xl font-bold mb-2 relative z-10 ${Q.isPassed?"text-green-400":"text-red-400"}`,children:[Q.score,"%"]}),e.jsxs("p",{className:"text-gaming-textMuted relative z-10",children:[Q.correct," / ",Q.total," ",r==="ru"?"правильных ответов":"ҷавоби дуруст"]})]}),e.jsx("div",{className:"p-6 max-h-[50vh] overflow-y-auto space-y-4",children:Q.details.map((t,n)=>e.jsx("div",{className:`p-4 rounded-xl border ${t.isCorrect?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.isCorrect?e.jsx(q,{className:"text-green-400 mt-1",size:20}):e.jsx(fe,{className:"text-red-400 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium mb-1 flex gap-1",children:[e.jsxs("span",{children:[n+1,"."]}),e.jsx("div",{dangerouslySetInnerHTML:{__html:D(t.question)},className:"[&>p]:inline [&>p]:m-0"})]}),!t.isCorrect&&t.question.type==="multiple_choice"&&e.jsxs("div",{className:"text-sm text-green-400 flex flex-wrap gap-1",children:[e.jsx("span",{children:r==="ru"?"Правильный ответ: ":"Ҷавоби дуруст: "}),e.jsx("span",{className:"font-semibold",dangerouslySetInnerHTML:{__html:te(t.question.options.find(f=>f.id===t.question.correctId))}})]})]})]})},t.question.id))}),e.jsxs("div",{className:"p-6 border-t border-white/10 flex gap-4 justify-center",children:[e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20",children:[e.jsx(Ye,{size:18}),r==="ru"?"Пройти заново":"Аз нав"]}),Q.isPassed&&e.jsxs("button",{onClick:()=>{L&&L(Q),g()},className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 shadow-[0_0_15px_rgba(22,163,74,0.5)]",children:[e.jsx(q,{size:18}),r==="ru"?"Забрать награду":"Гирифтани мукофот"]})]})]})}):e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 select-none",onContextMenu:t=>t.preventDefault(),style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"},children:[!X&&e.jsx("div",{className:"fixed inset-0 z-[100] backdrop-blur-3xl flex items-center justify-center bg-black/90 cursor-not-allowed",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(fe,{size:64,className:"mx-auto mb-4 text-red-500 animate-pulse"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:r==="ru"?"Вернитесь к тесту!":"Ба тест баргардед!"}),e.jsx("p",{className:"text-white/80",children:r==="ru"?"Контент скрыт при потере фокуса":"Мундариҷа ҳангоми гум кардани фокус пинҳон карда мешавад"})]})}),e.jsxs("div",{className:`w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 overflow-hidden relative transition-all duration-300 flex flex-col max-h-[90vh] ${X?"":"opacity-0 pointer-events-none"}`,children:[e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-[0.03] flex flex-wrap content-center justify-center gap-8 rotate-12 scale-150",children:Array.from({length:20}).map((t,n)=>e.jsx("div",{className:"text-2xl font-black text-white whitespace-nowrap",children:"DONISHMAND PLATFORM"},n))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[r==="ru"?"Вопрос":"Савол"," ",C+1," / ",i]}),e.jsx("div",{className:"flex gap-1",children:j.map((t,n)=>{const f=(()=>{const k=b[t==null?void 0:t.id];return k==null||k===""?!1:(t==null?void 0:t.type)==="matching"&&typeof k=="object"?Object.keys(k).length>=t.leftItems.length:!0})(),a=d&&!f;return e.jsx("button",{onClick:()=>I(n),title:`${r==="ru"?"Вопрос":"Савол"} ${n+1}${f?"":r==="ru"?" (нет ответа)":" (ҷавоб нест)"}`,className:`w-2.5 h-2.5 rounded-full transition-all duration-300 cursor-pointer hover:scale-150 ${n===C?"bg-gaming-primary scale-125":f?"bg-white/60":a?"bg-red-500 animate-pulse scale-125":"bg-white/20 hover:bg-white/40"}`},n)})})]}),e.jsx("button",{onClick:g,className:"p-2 text-gaming-textMuted hover:text-white",children:e.jsx(je,{size:24})})]}),e.jsxs("div",{className:"p-6 relative z-10 overflow-y-auto flex-1",children:[e.jsx("div",{className:"text-xl font-medium mb-6 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:D(c)}}),c.image&&e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-white/10 bg-black/20 flex justify-center",children:e.jsx("img",{src:c.image,alt:"Question",className:"max-w-full max-h-[400px] object-contain"})}),c.type==="multiple_choice"&&(()=>{const t=x(c.id);return e.jsxs("div",{className:"space-y-3",children:[t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg text-sm text-gaming-textMuted",children:[e.jsx(ke,{size:14}),e.jsx("span",{children:r==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"})]}),c.options.map((n,f)=>{const a=b[c.id]===n.id;return e.jsxs("button",{onClick:()=>O(c.id,n.id),disabled:t,className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${a?"bg-gaming-primary/20 border-gaming-primary":t?"bg-white/5 border-white/5 opacity-40 cursor-not-allowed":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 ${a?"bg-gaming-primary text-white":"bg-white/10"}`,children:String.fromCharCode(65+f)}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:te(n)}}),n.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[200px]",children:e.jsx("img",{src:n.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),a&&t&&e.jsx(ke,{size:16,className:"text-gaming-textMuted shrink-0"})]},n.id)})]})})(),c.type==="matching"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 pb-4 border-b border-white/10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-pink uppercase tracking-wider mb-2",children:r==="ru"?"Группа 1":"Гурӯҳи 1"}),c.leftItems.map((t,n)=>e.jsxs("div",{className:"text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"font-bold text-gaming-pink min-w-[20px]",children:[String.fromCharCode(65+n),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:te(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-accent uppercase tracking-wider mb-2",children:r==="ru"?"Группа 2":"Гурӯҳи 2"}),c.rightItems.map((t,n)=>e.jsxs("div",{className:"text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"font-bold text-gaming-accent min-w-[20px]",children:[n+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:te(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]})]}),e.jsx("p",{className:"text-sm text-gaming-textMuted text-center",children:r==="ru"?"Выберите соответствия в сетке:":"Мувофиқатро дар ҷадвал интихоб кунед:"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"overflow-x-auto max-w-full pb-2",children:e.jsxs("table",{className:"border-separate border-spacing-1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8"}),c.rightItems.map((t,n)=>e.jsx("th",{className:"text-center font-bold text-gaming-accent text-sm p-1",children:n+1},t.id))]})}),e.jsx("tbody",{children:c.leftItems.map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-bold text-gaming-pink text-sm p-1",children:String.fromCharCode(65+n)}),c.rightItems.map(f=>{var $;const a=(($=b[c.id])==null?void 0:$[t.id])===f.id,k=x(c.id);return e.jsx("td",{className:"text-center p-0.5",children:e.jsx("button",{onClick:()=>O(c.id,{...b[c.id]||{},[t.id]:f.id}),disabled:k,className:`w-8 h-8 rounded-full border-2 transition-all flex items-center justify-center
                                                                        ${a?"bg-gaming-primary border-gaming-primary":k?"bg-white/5 border-white/10 opacity-30 cursor-not-allowed":"bg-white/5 border-white/20 hover:border-white/40"}`,children:a&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})},f.id)})]},t.id))})]})})})]}),c.type==="numeric"&&(()=>{const t=x(c.id);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gaming-textMuted",children:t?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{size:14})," ",r==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"]}):r==="ru"?"Введите ответ:":"Ҷавобро ворид кунед:"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[[0,1,2,3].map(n=>e.jsx("input",{type:"text",maxLength:1,disabled:t,value:(b[c.id]||"")[n]||"",onChange:f=>{const a=f.target.value;if(a&&!/^\d$/.test(a))return;const $=(b[c.id]||"").split("");if($[n]=a,O(c.id,$.join("")),a&&n<3){const A=f.target.nextElementSibling;A&&A.focus()}},className:`w-14 h-14 text-center text-2xl font-bold rounded-lg text-white focus:outline-none ${t?"bg-gaming-bg/50 border-2 border-gaming-primary/30 opacity-70 cursor-not-allowed":"bg-gaming-bg/50 border-2 border-white/20 focus:border-gaming-primary"}`},n)),c.unit&&e.jsx("span",{className:"text-xl text-gaming-textMuted ml-2",children:c.unit})]})]})})()]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-white/10 relative z-10",children:[C>0?e.jsxs("button",{onClick:oe,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white hover:bg-white/10",children:[e.jsx(we,{size:18}),r==="ru"?"Назад":"Қафо"]}):e.jsx("div",{}),C===i-1?e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[d&&z&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-500/20 border border-red-500/40 text-red-400 rounded-xl text-sm animate-bounce",children:[e.jsx(lt,{size:16,className:"shrink-0"}),e.jsx("span",{children:z})]}),e.jsxs("button",{onClick:G,className:`flex items-center gap-2 px-6 py-2 rounded-xl transition-all ${d?"bg-red-500/80 text-white animate-[shake_0.5s_ease-in-out]":"bg-gaming-primary text-white hover:bg-gaming-primary/80"}`,children:[e.jsx(q,{size:18}),r==="ru"?"Завершить тест":"Тамом кардан"]})]}):e.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-4 py-2 text-white hover:bg-white/10 rounded-xl",children:[r==="ru"?"Далее":"Оянда",e.jsx(Ce,{size:18})]})]})]})]})},xt=({questions:s,lang:u,onClose:r})=>{const[g,L]=h.useState(!1),[C,I]=h.useState({});if(!s||s.length===0)return null;const b=l=>{I(N=>({...N,[l]:!N[l]}))},y=()=>{const l=!g;L(l);const N={};s.forEach(d=>N[d.id]=l),I(N)},T=l=>{const N=u==="tj"&&l.textTj||l.textRu;return ue(N||"")},o=l=>{const N=u==="tj"&&l.textTj||l.textRu;return ue(N||"")};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-4xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8 shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:u==="ru"?"Режим учителя: Просмотр теста":"Реҷаи омӯзгор: Дидани тест"}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[s.length," ",u==="ru"?"вопросов":"савол"]})]}),e.jsx("button",{onClick:r,className:"p-2 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(je,{size:24})})]}),e.jsx("div",{className:"p-4 bg-black/20 border-b border-white/5 flex justify-between items-center shrink-0",children:e.jsxs("button",{onClick:y,className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all ${g?"bg-gaming-primary text-white":"bg-white/10 text-gaming-textMuted hover:text-white"}`,children:[g?e.jsx(Je,{size:18}):e.jsx(me,{size:18}),g?u==="ru"?"Скрыть все ответы":"Пинҳон кардани ҷавобҳо":u==="ru"?"Показать все ответы":"Нишон додани ҷавобҳо"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:s.map((l,N)=>{const d=C[l.id];return e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-gaming-pink/10 text-gaming-pink rounded-lg flex items-center justify-center font-bold text-sm border border-gaming-pink/20",children:N+1}),e.jsx("div",{className:"text-lg font-medium text-white pt-1 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:T(l)}}),l.image&&e.jsx("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-md",children:e.jsx("img",{src:l.image,alt:"Question",className:"w-full h-auto object-cover"})})]}),e.jsx("button",{onClick:()=>b(l.id),className:`p-2 rounded-lg transition-colors ${d?"text-gaming-primary bg-gaming-primary/10":"text-gaming-textMuted hover:bg-white/5"}`,title:u==="ru"?"Показать/Скрыть ответ":"Нишон додан/Пинҳон кардан",children:d?e.jsx(Je,{size:20}):e.jsx(me,{size:20})})]}),e.jsxs("div",{className:"transition-all duration-300",children:[l.type==="multiple_choice"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pl-11",children:l.options.map((p,z)=>{const E=p.id===l.correctId&&d;return e.jsxs("div",{className:`p-3 rounded-xl border flex items-center gap-3 transition-all duration-300 ${E?"bg-green-500/10 border-green-500/30 text-green-400 font-bold":"bg-black/20 border-white/5 text-gaming-textMuted"}`,children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs transition-colors ${E?"bg-green-500 text-white":"bg-white/10"}`,children:String.fromCharCode(65+z)}),e.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:o(p)}}),p.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[150px]",children:e.jsx("img",{src:p.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),E&&e.jsx(q,{size:16,className:"ml-auto animate-in zoom-in duration-300 shrink-0"})]},p.id)})}),l.type==="matching"&&e.jsxs("div",{className:"pl-11 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:u==="ru"?"Элементы":"Элементҳо"}),l.leftItems.map((p,z)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"text-gaming-pink font-bold",children:[String.fromCharCode(65+z),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:o(p)}}),p.image&&e.jsx("img",{src:p.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},p.id))]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:u==="ru"?"Определения":"Таърифҳо"}),l.rightItems.map((p,z)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"text-gaming-accent font-bold",children:[z+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:o(p)}}),p.image&&e.jsx("img",{src:p.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},p.id))]})]}),d&&e.jsxs("div",{className:"p-4 bg-green-500/5 border border-green-500/20 rounded-xl animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx("p",{className:"text-sm text-green-400 font-bold mb-2",children:u==="ru"?"Правильные пары:":"Ҷуфтҳои дуруст:"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(l.correctMatches).map(([p,z])=>{const H=l.leftItems.findIndex(P=>P.id===p),E=l.rightItems.findIndex(P=>P.id===z);return e.jsxs("span",{className:"px-2 py-1 bg-green-500/10 rounded border border-green-500/20 text-sm",children:[String.fromCharCode(65+H)," — ",E+1]},p)})})]})]}),l.type==="numeric"&&e.jsx("div",{className:"pl-11",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 bg-green-500/5 border border-white/5 rounded-xl transition-all duration-300",children:[e.jsx("span",{className:"text-sm text-gaming-textMuted",children:u==="ru"?"Ответ:":"Ҷавоб:"}),e.jsx("span",{className:`text-xl font-bold tracking-widest transition-all duration-300 ${d?"text-green-400":"text-white/20"}`,children:d?l.digits.join(""):"****"}),l.unit&&e.jsx("span",{className:"text-gaming-textMuted",children:l.unit}),d&&e.jsx(q,{size:16,className:"text-green-400 animate-in zoom-in"})]})})]})]},l.id)})})]})})},le=(s,u)=>`progress_${s}_${u}`,vt=()=>{var Me,$e,_e,Re,Le,Ee,Ae,He,Ve,Oe,Fe,Pe,We;const{t:s,i18n:u}=Xe(),r=u.resolvedLanguage||"ru",{lessonId:g}=et(),L=tt(),C=80,[I,b]=h.useState(!0),[y,T]=h.useState(null),[o,l]=h.useState(()=>({videoWatched:localStorage.getItem(le(g,"video"))==="true",textRead:localStorage.getItem(le(g,"text"))==="true",slidesViewed:JSON.parse(localStorage.getItem(le(g,"slides"))||"[]"),testHistory:JSON.parse(localStorage.getItem(`test_history_${g}`)||"[]")})),[N,d]=h.useState("video"),[p,z]=h.useState(!1),[H,E]=h.useState(!1),[P,X]=h.useState(!1),{isTeacher:ae,isAdmin:W}=st(),j=ae||W;h.useEffect(()=>{(async()=>{b(!0);try{const w=await Ue.getLesson(g,r);if(!w){T(null),b(!1);return}const F=w.subject;let Z=null;if(F){const re=await Ue.getStructure(F);if(re&&re.sections)for(let ne=0;ne<re.sections.length;ne++){const B=re.sections[ne];if(B.topics){for(let ie=0;ie<B.topics.length;ie++){const be=B.topics[ie];if(!be.lessons)continue;const ye=be.lessons.findIndex(qe=>qe.id===g);if(ye!==-1){Z={lesson:{...w,...be.lessons[ye],content:w.content},topic:be,section:B,subjectKey:F,lessonIndex:ye,topicIndex:ie,sectionIndex:ne};break}}if(Z)break}}}T(Z||{lesson:w,subjectKey:F})}catch(w){console.error("Error fetching lesson:",w)}finally{b(!1)}})()},[g,r]);const c=((Me=y==null?void 0:y.lesson)==null?void 0:Me.content)||{},i=r==="tj"?(($e=c.video)==null?void 0:$e.urlTj)||((_e=c.video)==null?void 0:_e.url):((Re=c.video)==null?void 0:Re.url)||((Le=c.video)==null?void 0:Le.urlTj),x=!!i,M=!!((Ee=c.text)!=null&&Ee.bodyRu||(Ae=c.text)!=null&&Ae.bodyTj),O=r==="tj"?c.slidesTj||[]:c.slidesRu||[],V=O.length>0,oe=((Ve=(He=c.test)==null?void 0:He.questions)==null?void 0:Ve.length)>0,Q=x||M||V,ce=((Oe=c.test)==null?void 0:Oe.questions)||[],v=h.useMemo(()=>{if(!o.testHistory||o.testHistory.length===0)return null;const m=o.testHistory.length,w=Math.max(...o.testHistory.map(B=>B.score)),F=o.testHistory.reduce((B,ie)=>B+ie.score,0)/m,Z=Math.round(100-F),re=o.testHistory[o.testHistory.length-1].timestamp,ne=w>=C;return{totalAttempts:m,bestScore:w,avgErrorRate:Z,lastAttemptAt:re,isPassed:ne}},[o.testHistory]),G=O.length,ee=o.slidesViewed.length,D=G>0?ee>=G:!0,te=!x||o.videoWatched,t=!M||o.textRead,f=j||te&&t&&(!V||D),a=[x,M,V,oe].filter(Boolean).length;let k=0;x&&o.videoWatched&&k++,M&&o.textRead&&k++,V&&D&&k++,oe&&(v!=null&&v.isPassed)&&k++;const $=a>0?Math.round(k/a*100):0;h.useEffect(()=>{!I&&y&&(x?d("video"):M?d("text"):V&&d("slides"))},[I,x,M,V]);const A=()=>{j||(localStorage.setItem(le(g,"video"),"true"),l(m=>({...m,videoWatched:!0})))},se=()=>{j||o.textRead||(localStorage.setItem(le(g,"text"),"true"),l(m=>({...m,textRead:!0})))},_=m=>{if(j)return;const w=[...new Set([...o.slidesViewed,m])];localStorage.setItem(le(g,"slides"),JSON.stringify(w)),l(F=>({...F,slidesViewed:w}))},J=()=>{f?X(!0):E(!0)},U=m=>{const w=JSON.parse(localStorage.getItem(`test_history_${g}`)||"[]");l(F=>({...F,testHistory:w}))};if(h.useEffect(()=>{const m=w=>{w.key==="Escape"&&(H&&E(!1),p&&z(!1))};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[H,p]),I)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gaming-bg",children:e.jsx(rt,{size:40,className:"text-gaming-primary animate-spin"})});if(!y)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-white bg-gaming-bg",children:[e.jsx("h2",{className:"text-2xl mb-4",children:s("lesson.notFound")}),e.jsx("button",{onClick:()=>L(-1),className:"text-gaming-primary hover:underline",children:s("lesson.back")})]});const{lesson:S,topic:R,section:he,subjectKey:Ne,lessonIndex:ge,sectionIndex:Ge,topicIndex:Ze}=y,ze=m=>r==="tj"&&m.titleTj?m.titleTj:m.title,Ie=(Fe=R==null?void 0:R.lessons)==null?void 0:Fe[ge-1],Te=(Pe=R==null?void 0:R.lessons)==null?void 0:Pe[ge+1],de=[];return x&&de.push({id:"video",icon:De,label:"lesson.video",complete:o.videoWatched}),M&&de.push({id:"text",icon:Ke,label:"lesson.text",complete:o.textRead}),V&&de.push({id:"slides",icon:pe,label:"lesson.slides",complete:D}),e.jsxs(nt,{subjectId:Ne,children:[e.jsxs("div",{className:"max-w-4xl",children:[e.jsxs("header",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>{Ne&&(he!=null&&he.id)&&(R!=null&&R.id)?L(`/subject/${Ne}/section/${he.id}/topic/${R.id}`):L(-1)},className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-gaming-textMuted hover:text-white transition-all mb-4 group w-fit",children:[e.jsx(we,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:s("lesson.backToTopic")})]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gaming-textMuted mb-1",children:[s("lesson.lesson")," ",ge+1," / ",((We=R==null?void 0:R.lessons)==null?void 0:We.length)||0]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2 text-gaming-pink",children:[ge+1,". ",ze(S)]}),R&&e.jsx("p",{className:"text-gaming-textMuted flex items-center gap-2 text-sm",children:e.jsxs("span",{children:[Ge+1,".",Ze+1,". ",ze(R)]})})]}),j&&e.jsx("div",{className:"px-3 py-1 bg-gaming-pink text-white text-xs font-bold rounded-full uppercase tracking-wider animate-pulse",children:s("lesson.teacherMode")})]})]}),!j&&e.jsxs("div",{className:"mb-8 bg-gradient-to-br from-gaming-primary/20 to-gaming-pink/20 backdrop-blur-xl border border-white/10 rounded-2xl p-6 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg mb-1",children:s("lesson.progress")}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[k," / ",a," ",s("lesson.stepsCompleted")]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-3xl font-bold text-gaming-primary",children:[$,"%"]})})]}),e.jsx("div",{className:"w-full h-3 bg-black/30 rounded-full mb-6 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gaming-primary to-gaming-pink transition-all duration-1000 ease-out",style:{width:`${$}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[x&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${o.videoWatched?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${o.videoWatched?"bg-green-500/20":"bg-white/10"}`,children:o.videoWatched?e.jsx(K,{size:20}):e.jsx(De,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:s("lesson.video")})]}),M&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${o.textRead?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${o.textRead?"bg-green-500/20":"bg-white/10"}`,children:o.textRead?e.jsx(K,{size:20}):e.jsx(Ke,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:s("lesson.text")})]}),V&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${D?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${D?"bg-green-500/20":"bg-white/10"}`,children:D?e.jsx(K,{size:20}):e.jsx(pe,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:s("lesson.slides")}),e.jsxs("span",{className:"text-xs opacity-70",children:[ee,"/",G]})]})]}),oe&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${v!=null&&v.isPassed?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${v!=null&&v.isPassed?"bg-green-500/20":"bg-white/10"}`,children:v!=null&&v.isPassed?e.jsx(K,{size:20}):e.jsx(q,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:s("lesson.test")}),v&&e.jsxs("span",{className:"text-xs font-bold",children:[v.bestScore,"%"]})]})]})]})]}),v&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-white/10 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(Ye,{size:18,className:"text-gaming-gold"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:s("lesson.attempts")}),e.jsx("div",{className:"font-bold text-white",children:v.totalAttempts})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(at,{size:18,className:"text-gaming-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:s("lesson.lastAttempt")}),e.jsx("div",{className:"font-bold text-white",children:v.lastAttemptAt?new Intl.DateTimeFormat(r==="tj"?"tg-TJ":"ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}).format(new Date(v.lastAttemptAt)):"-"})]})]})]})]}),Q?e.jsxs(e.Fragment,{children:[de.length>0&&e.jsx("div",{className:"flex gap-4 mb-6 border-b border-white/5 overflow-x-auto",children:de.map(m=>{const w=m.icon;return e.jsxs("button",{onClick:()=>d(m.id),className:`pb-3 px-2 text-base font-semibold transition-all relative flex items-center gap-2 whitespace-nowrap ${N===m.id?"text-white":"text-gaming-textMuted hover:text-white"}`,children:[e.jsx(w,{size:18}),s(m.label),m.complete&&!j&&e.jsx(K,{size:14,className:"text-green-400"}),N===m.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gaming-pink rounded-t-full shadow-[0_0_10px_rgba(236,72,153,0.5)]"})]},m.id)})}),e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-6 mb-6 shadow-xl overflow-hidden relative group",children:[e.jsx("div",{className:"absolute -left-20 -top-20 w-64 h-64 bg-gaming-pink/5 rounded-full blur-3xl group-hover:bg-gaming-pink/10 transition-all duration-700"}),e.jsxs("div",{className:"relative z-10",children:[N==="video"&&x&&e.jsxs("div",{className:"aspect-video bg-black/60 rounded-xl flex flex-col items-center justify-center border border-white/10 shadow-inner overflow-hidden relative",children:[i.includes("youtube")||i.includes("youtu.be")?(()=>{const m=i.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|.*\/|.*embed\/))([^&?]*)/),w=m?m[1]:null;return w?e.jsx("iframe",{src:`https://www.youtube.com/embed/${w}`,className:"w-full h-full",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onLoad:A}):e.jsxs("div",{className:"text-white text-center p-4",children:[e.jsx("p",{children:"Не удалось загрузить видео"}),e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"text-gaming-primary hover:underline mt-2 inline-block",children:"Открыть на YouTube"})]})})():e.jsx("video",{src:i,controls:!0,className:"w-full h-full",onEnded:A,onPlay:()=>setTimeout(A,3e4)}),!o.videoWatched&&!j&&e.jsxs("button",{onClick:A,className:"absolute bottom-4 right-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(me,{size:16}),s("lesson.markAsWatched")]})]}),N==="text"&&M&&e.jsxs("div",{className:"prose prose-invert max-w-none prose-p:text-gaming-textMuted prose-headings:text-white prose-li:text-gaming-textMuted",onScroll:m=>{const{scrollTop:w,scrollHeight:F,clientHeight:Z}=m.target;w+Z>=F-50&&se()},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:ue(r==="tj"&&c.text.bodyTj||c.text.bodyRu)}}),!o.textRead&&!j&&e.jsxs("button",{onClick:se,className:"mt-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(me,{size:16}),s("lesson.markAsRead")]})]}),N==="slides"&&V&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gaming-textMuted",children:[ee," / ",G," ",s("lesson.slidesCount")]}),e.jsxs("button",{onClick:()=>z(!0),className:"flex items-center gap-2 px-4 py-2 bg-gaming-gold/20 text-gaming-gold rounded-xl hover:bg-gaming-gold/30 transition-colors",children:[e.jsx(pe,{size:18}),s("lesson.openPresentation")]})]}),e.jsx("div",{className:"flex flex-col gap-6",children:O.map((m,w)=>e.jsxs("button",{onClick:()=>{_(m.id),z(!0)},className:"relative w-full rounded-2xl overflow-hidden border border-white/5 hover:border-gaming-gold/30 transition-all group shadow-lg",children:[e.jsx("img",{src:m.imageUrl,alt:`Slide ${w+1}`,className:"w-full h-auto object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-sm",children:e.jsx("div",{className:"bg-black/60 p-3 rounded-full border border-white/20 transform scale-90 group-hover:scale-100 transition-transform",children:e.jsx(pe,{size:24,className:"text-white"})})}),e.jsx("div",{className:"absolute top-4 left-4 bg-black/60 backdrop-blur px-3 py-1 rounded-full text-white font-bold text-sm border border-white/10",children:w+1}),(o.slidesViewed.includes(m.id)||j)&&e.jsx("div",{className:"absolute top-4 right-4 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center shadow-lg animate-in fade-in zoom-in",children:e.jsx(K,{size:16,className:"text-white"})})]},m.id))})]})]})]})]}):e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-8 mb-6 text-center",children:[e.jsx(it,{size:48,className:"mx-auto mb-4 text-gaming-primary opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s("lesson.testing")}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:s("lesson.onlyTest")})]}),H&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-red-500/30 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-400 mb-4",children:[e.jsx(xe,{size:24}),e.jsx("h3",{className:"text-lg font-semibold",children:s("lesson.reviewMaterialsTitle")})]}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:s("lesson.reviewMaterialsText")}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[x&&e.jsxs("li",{className:`flex items-center gap-2 ${o.videoWatched?"text-green-400":"text-red-400"}`,children:[o.videoWatched?e.jsx(K,{size:16}):e.jsx(xe,{size:16}),s("lesson.video")]}),M&&e.jsxs("li",{className:`flex items-center gap-2 ${o.textRead?"text-green-400":"text-red-400"}`,children:[o.textRead?e.jsx(K,{size:16}):e.jsx(xe,{size:16}),s("lesson.text")]}),V&&e.jsxs("li",{className:`flex items-center gap-2 ${D?"text-green-400":"text-red-400"}`,children:[D?e.jsx(K,{size:16}):e.jsx(xe,{size:16}),s("lesson.slides")," (",ee,"/",G,")"]})]}),e.jsx("button",{onClick:()=>E(!1),className:"w-full px-4 py-3 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors",children:s("lesson.understood")})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[Ie&&e.jsxs("button",{onClick:()=>L(`/lesson/${Ie.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx(we,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:s("lesson.prev")})]}),Te&&e.jsxs("button",{onClick:()=>L(`/lesson/${Te.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:s("lesson.next")}),e.jsx(Ce,{size:16})]})]}),e.jsxs("button",{onClick:J,className:`group font-bold py-3 px-8 rounded-xl flex items-center gap-2 transition-all transform hover:scale-[1.02] active:scale-95 shadow-lg border border-white/10 ${f?j?"bg-gaming-pink hover:bg-gaming-pink/80 text-white shadow-gaming-pink/25":"bg-gaming-primary hover:bg-gaming-primary/80 text-white shadow-gaming-primary/25":"bg-gaming-card/60 text-gaming-textMuted cursor-not-allowed"}`,children:[j?e.jsx(me,{size:20}):e.jsx(q,{size:20}),e.jsx("span",{children:s(j?"lesson.viewTest":"lesson.takeTest")}),!f&&e.jsx(xe,{size:16,className:"text-yellow-400"})]})]})]}),p&&V&&e.jsx(ct,{slides:O,lessonId:g,onClose:()=>z(!1),onSlideView:_}),P&&(j?e.jsx(xt,{questions:ce,lang:r,onClose:()=>X(!1)}):e.jsx(dt,{questions:ce,lessonId:g,lang:r,onClose:()=>X(!1),onComplete:U}))]})};export{vt as default};
