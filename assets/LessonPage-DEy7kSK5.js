import{c as re,R as Ke,r as h,j as e,X as pe,C as ke,u as Ge,a as Ze}from"./index-1GtkQsl0.js";import{C as qe}from"./CourseLayout-B_aFyDmI.js";import{C as J,a as fe,k as Pe,V as We,P as ge,b as et}from"./katex-TZt9F88Z.js";import{L as Ne,E as Qe,a as ce}from"./lock-Bl3zDgYq.js";import{A as tt}from"./alert-triangle-CLq4YVwm.js";import{L as st,F as De,s as Je}from"./SyllabusContext-BNDKyOBU.js";import"./home-mJ3iBQl4.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=re("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=re("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=re("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=re("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=re("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=re("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),nt=({slides:r,lessonId:x,lang:n,onClose:u,onSlideView:I})=>{const C=Ke.useRef(null),[w,j]=h.useState(0),[S,H]=h.useState(!1),[l,a]=h.useState(()=>{const s=localStorage.getItem(`viewed_slides_${x}`);return s?JSON.parse(s):[]}),d=r[w];h.useEffect(()=>{if(d&&!l.includes(d.id)){const s=[...l,d.id];a(s),localStorage.setItem(`viewed_slides_${x}`,JSON.stringify(s)),I&&I(d.id)}},[w,d,l,x,I]);const v=h.useCallback(s=>{s.key==="ArrowLeft"||s.key==="ArrowUp"?j(c=>c>0?c-1:c):s.key==="ArrowRight"||s.key==="ArrowDown"||s.key===" "?j(c=>c<r.length-1?c+1:c):s.key==="Escape"?S?H(!1):u():(s.key==="f"||s.key==="F")&&H(c=>!c)},[r.length,S,u]);h.useEffect(()=>(window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)),[v]),h.useEffect(()=>{const s=()=>{H(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",s),C.current&&C.current.requestFullscreen().catch(c=>{console.log("Auto-fullscreen blocked:",c)}),()=>{document.removeEventListener("fullscreenchange",s),document.fullscreenElement&&document.exitFullscreen().catch(c=>console.log("Exit fullscreen error:",c))}},[]);const[b,T]=h.useState(null),V=s=>{T(s.touches[0].clientX)},E=s=>{if(!b)return;const c=s.changedTouches[0].clientX,A=b-c;Math.abs(A)>50&&(A>0&&w<r.length-1?j($=>$+1):A<0&&w>0&&j($=>$-1)),T(null)},P=()=>j(s=>s>0?s-1:s),U=()=>j(s=>s<r.length-1?s+1:s),M=()=>{var s;document.fullscreenElement?document.exitFullscreen().catch(c=>console.log(c)):(s=C.current)==null||s.requestFullscreen().catch(c=>console.log(c))},N=S?"fixed inset-0 z-[100] bg-black":"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",z=S?"w-full h-full flex items-center justify-center":"w-full max-w-5xl max-h-[80vh] flex items-center justify-center";return e.jsxs("div",{ref:C,className:N,onTouchStart:V,onTouchEnd:E,children:[!S&&e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[w+1," / ",r.length]}),l.includes(d==null?void 0:d.id)&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs",children:[e.jsx(J,{size:12}),n==="ru"?"Просмотрено":"Дида шуд"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:M,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",title:"Fullscreen (F)",children:e.jsx(it,{size:20})}),e.jsx("button",{onClick:u,className:"p-2 text-white/70 hover:text-white transition-colors rounded-lg hover:bg-white/10",children:e.jsx(pe,{size:24})})]})]}),S&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("button",{onClick:u,className:"p-2 text-white/50 hover:text-white transition-colors",children:e.jsx(pe,{size:24})})}),e.jsx("div",{className:z,children:d&&e.jsx("img",{src:d.imageUrl,alt:n==="tj"&&d.captionTj||d.captionRu,className:S?"max-w-full max-h-full object-contain":"max-w-full max-h-[70vh] object-contain rounded-lg"})}),!S&&d&&(d.captionRu||d.captionTj)&&e.jsx("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 max-w-2xl text-center",children:e.jsx("p",{className:"text-white/90 text-lg bg-black/50 px-6 py-3 rounded-xl backdrop-blur-sm",children:n==="tj"&&d.captionTj||d.captionRu})}),e.jsx("button",{onClick:P,disabled:w===0,className:`absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${w===0?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(fe,{size:32})}),e.jsx("button",{onClick:U,disabled:w===r.length-1,className:`absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full transition-all ${w===r.length-1?"text-white/20 cursor-not-allowed":"text-white/70 hover:text-white hover:bg-white/10"}`,children:e.jsx(ke,{size:32})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-2",children:r.map((s,c)=>e.jsx("button",{onClick:()=>j(c),className:`w-2 h-2 rounded-full transition-all ${c===w?"bg-white w-4":l.includes(s.id)?"bg-green-500/70 hover:bg-green-500":"bg-white/30 hover:bg-white/50"}`},s.id))}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/10",children:e.jsx("div",{className:"h-full bg-gaming-primary transition-all duration-300",style:{width:`${(w+1)/r.length*100}%`}})})]})},B=r=>{const x=[...r];for(let n=x.length-1;n>0;n--){const u=Math.floor(Math.random()*(n+1));[x[n],x[u]]=[x[u],x[n]]}return x},de=r=>{if(!r||typeof r!="string")return r;let x=r.replace(/\$\$([^$]+?)\$\$/g,(n,u)=>{try{return Pe.renderToString(u.trim(),{displayMode:!0,throwOnError:!1,output:"html"})}catch(I){return console.warn("Ошибка рендеринга KaTeX:",I),n}});return x=x.replace(/\$([^$]+?)\$/g,(n,u)=>{try{return Pe.renderToString(u.trim(),{displayMode:!1,throwOnError:!1,output:"html"})}catch(I){return console.warn("Ошибка рендеринга KaTeX:",I),n}}),x},ye=80,lt=({questions:r,lessonId:x,lang:n,onClose:u,onComplete:I})=>{const[C,w]=h.useState(0),[j,S]=h.useState({}),[H,l]=h.useState(!1),[a,d]=h.useState(0),[v,b]=h.useState(!1),[T,V]=h.useState(""),[E,P]=h.useState(new Set),[U,M]=h.useState(!0);Ke.useEffect(()=>{const t=()=>{const g=document.hasFocus()&&!document.hidden;M(g)};window.addEventListener("focus",t),window.addEventListener("blur",t),document.addEventListener("visibilitychange",t);const i=setInterval(t,300);return()=>{window.removeEventListener("focus",t),window.removeEventListener("blur",t),document.removeEventListener("visibilitychange",t),clearInterval(i)}},[]);const N=`test_progress_v2_${x}`,z=h.useMemo(()=>{if(!r)return[];const t=localStorage.getItem(N);if(t&&a===0)try{const o=JSON.parse(t);if(!(o.questions&&o.questions.every(R=>R.textRu&&R.textRu.trim().length>0||R.textTj&&R.textTj.trim().length>0)))console.warn("Кэш теста содержит пустые вопросы. Очистка..."),localStorage.removeItem(N);else if(o.questions&&o.answers&&o.locked){S(o.answers),P(new Set(o.locked)),w(o.currentIndex||0);const R=new Set(o.locked),O=o.questions.filter(k=>R.has(k.id)),ne=new Set(O.map(k=>k.id)),L=B(r.filter(k=>!ne.has(k.id))),D=Math.min(10,r.length)-O.length,y=L.slice(0,Math.max(0,D)).map(k=>k.type==="multiple_choice"?{...k,options:B(k.options)}:k.type==="matching"?{...k,leftItems:B(k.leftItems),rightItems:B(k.rightItems)}:k);return[...O,...y]}}catch(o){console.warn("Ошибка восстановления прогресса теста:",o),localStorage.removeItem(N)}return B(r).slice(0,10).map(o=>o.type==="multiple_choice"?{...o,options:B(o.options)}:o.type==="matching"?{...o,leftItems:B(o.leftItems),rightItems:B(o.rightItems)}:o)},[r,a,N]),s=z[C],c=z.length;h.useEffect(()=>{if(z.length>0&&!H){const t={questions:z,answers:j,locked:[...E],currentIndex:C};localStorage.setItem(N,JSON.stringify(t))}},[j,E,C,z,H]);const A=t=>E.has(t),$=()=>{const t=z[C];if(!t)return;const i=j[t.id];i!=null&&i!==""&&P(g=>new Set([...g,t.id]))},Y=(t,i)=>{A(t)||S(g=>({...g,[t]:i}))},je=()=>{C<c-1&&($(),w(t=>t+1))},xe=()=>{C>0&&w(t=>t-1)},[p,K]=h.useState(null),W=h.useMemo(()=>z.filter(t=>{const i=j[t.id];return i==null||i===""?!0:t.type==="matching"&&typeof i=="object"?Object.keys(i).length<t.leftItems.length:!1}).length,[j,z]);h.useEffect(()=>{if(v){const t=setTimeout(()=>{b(!1),V("")},3e3);return()=>clearTimeout(t)}},[v]);const Q=()=>{if($(),W>0){b(!0);const L=n==="ru"?`Вы не ответили на ${W} ${W===1?"вопрос":W<5?"вопроса":"вопросов"}!`:`Шумо ба ${W} савол ҷавоб надодаед!`;V(L);return}let t=0;const i=z.map(L=>{const D=j[L.id];let y=!1;if(L.type==="multiple_choice")y=D===L.correctId;else if(L.type==="matching")y=Object.entries(L.correctMatches).every(([k,le])=>(D==null?void 0:D[k])===le);else if(L.type==="numeric"){const k=L.digits.join("");y=D===k}return y&&t++,{question:L,userAnswer:D,isCorrect:y}}),g=Math.round(t/c*100),o=g>=ye,_=`test_history_${x}`,R=JSON.parse(localStorage.getItem(_)||"[]"),O={score:g,correct:t,total:c,timestamp:Date.now(),passed:o},ne=[...R,O];if(localStorage.setItem(_,JSON.stringify(ne)),localStorage.setItem(`test_result_${x}`,JSON.stringify(O)),o){const L=parseInt(localStorage.getItem("user_coins")||"0");localStorage.setItem("user_coins",(L+1).toString())}K({correct:t,total:c,score:g,isPassed:o,details:i}),l(!0),localStorage.removeItem(N)},we=()=>{localStorage.removeItem(N),w(0),S({}),b(!1),V(""),P(new Set),K(null),l(!1),d(t=>t+1)},me=t=>{const i=n==="tj"&&t.textTj||t.textRu;return de(i||"")},ie=t=>{const i=n==="tj"&&t.textTj||t.textRu;return de(i||"")};return!r||r.length===0?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-gaming-card/95 rounded-2xl p-8 text-center max-w-md",children:[e.jsx(be,{size:48,className:"mx-auto mb-4 text-red-400"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:n==="ru"?"Нет вопросов":"Саволе нест"}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:n==="ru"?"Тест пока не содержит вопросов":"Тест ҳанӯз савол надорад"}),e.jsx("button",{onClick:u,className:"px-6 py-2 bg-gaming-primary text-white rounded-xl",children:n==="ru"?"Закрыть":"Пӯшидан"})]})}):H&&p?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 text-center relative overflow-hidden",children:[p.isPassed?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-green-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-yellow-400 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(250,204,21,0.6)] animate-bounce",children:e.jsx("div",{className:"w-20 h-20 border-4 border-yellow-600 rounded-full flex items-center justify-center bg-yellow-300",children:e.jsx("span",{className:"text-4xl font-bold text-yellow-700",children:"$"})})}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-green-400",children:n==="ru"?"Тест сдан!":"Тест супорида шуд!"}),e.jsx("p",{className:"text-green-300/80 mb-2",children:n==="ru"?"+1 монета в копилку":"+1 танга ба хазина"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(be,{size:64,className:"mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-red-400",children:n==="ru"?"Тест не сдан":"Тест супорида нашуд"}),e.jsx("p",{className:"text-red-300/80 mb-2",children:n==="ru"?`Нужно набрать минимум ${ye}%`:`Бояд ҳадди аққал ${ye}% гиред`})]})]}),e.jsxs("div",{className:`text-5xl font-bold mb-2 relative z-10 ${p.isPassed?"text-green-400":"text-red-400"}`,children:[p.score,"%"]}),e.jsxs("p",{className:"text-gaming-textMuted relative z-10",children:[p.correct," / ",p.total," ",n==="ru"?"правильных ответов":"ҷавоби дуруст"]})]}),e.jsx("div",{className:"p-6 max-h-[50vh] overflow-y-auto space-y-4",children:p.details.map((t,i)=>e.jsx("div",{className:`p-4 rounded-xl border ${t.isCorrect?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.isCorrect?e.jsx(Z,{className:"text-green-400 mt-1",size:20}):e.jsx(be,{className:"text-red-400 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium mb-1 flex gap-1",children:[e.jsxs("span",{children:[i+1,"."]}),e.jsx("div",{dangerouslySetInnerHTML:{__html:me(t.question)},className:"[&>p]:inline [&>p]:m-0"})]}),!t.isCorrect&&t.question.type==="multiple_choice"&&e.jsxs("div",{className:"text-sm text-green-400 flex flex-wrap gap-1",children:[e.jsx("span",{children:n==="ru"?"Правильный ответ: ":"Ҷавоби дуруст: "}),e.jsx("span",{className:"font-semibold",dangerouslySetInnerHTML:{__html:ie(t.question.options.find(g=>g.id===t.question.correctId))}})]})]})]})},t.question.id))}),e.jsxs("div",{className:"p-6 border-t border-white/10 flex gap-4 justify-center",children:[e.jsxs("button",{onClick:we,className:"flex items-center gap-2 px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20",children:[e.jsx(Ue,{size:18}),n==="ru"?"Пройти заново":"Аз нав"]}),p.isPassed&&e.jsxs("button",{onClick:()=>{I&&I(p),u()},className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 shadow-[0_0_15px_rgba(22,163,74,0.5)]",children:[e.jsx(Z,{size:18}),n==="ru"?"Забрать награду":"Гирифтани мукофот"]})]})]})}):e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 select-none",onContextMenu:t=>t.preventDefault(),style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"},children:[!U&&e.jsx("div",{className:"fixed inset-0 z-[100] backdrop-blur-3xl flex items-center justify-center bg-black/90 cursor-not-allowed",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(be,{size:64,className:"mx-auto mb-4 text-red-500 animate-pulse"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:n==="ru"?"Вернитесь к тесту!":"Ба тест баргардед!"}),e.jsx("p",{className:"text-white/80",children:n==="ru"?"Контент скрыт при потере фокуса":"Мундариҷа ҳангоми гум кардани фокус пинҳон карда мешавад"})]})}),e.jsxs("div",{className:`w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 overflow-hidden relative transition-all duration-300 flex flex-col max-h-[90vh] ${U?"":"opacity-0 pointer-events-none"}`,children:[e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-[0.03] flex flex-wrap content-center justify-center gap-8 rotate-12 scale-150",children:Array.from({length:20}).map((t,i)=>e.jsx("div",{className:"text-2xl font-black text-white whitespace-nowrap",children:"DONISHMAND PLATFORM"},i))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[n==="ru"?"Вопрос":"Савол"," ",C+1," / ",c]}),e.jsx("div",{className:"flex gap-1",children:z.map((t,i)=>{const g=(()=>{const _=j[t==null?void 0:t.id];return _==null||_===""?!1:(t==null?void 0:t.type)==="matching"&&typeof _=="object"?Object.keys(_).length>=t.leftItems.length:!0})(),o=v&&!g;return e.jsx("button",{onClick:()=>w(i),title:`${n==="ru"?"Вопрос":"Савол"} ${i+1}${g?"":n==="ru"?" (нет ответа)":" (ҷавоб нест)"}`,className:`w-2.5 h-2.5 rounded-full transition-all duration-300 cursor-pointer hover:scale-150 ${i===C?"bg-gaming-primary scale-125":g?"bg-white/60":o?"bg-red-500 animate-pulse scale-125":"bg-white/20 hover:bg-white/40"}`},i)})})]}),e.jsx("button",{onClick:u,className:"p-2 text-gaming-textMuted hover:text-white",children:e.jsx(pe,{size:24})})]}),e.jsxs("div",{className:"p-6 relative z-10 overflow-y-auto flex-1",children:[e.jsx("div",{className:"text-xl font-medium mb-6 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:me(s)}}),s.image&&e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-white/10 bg-black/20 flex justify-center",children:e.jsx("img",{src:s.image,alt:"Question",className:"max-w-full max-h-[400px] object-contain"})}),s.type==="multiple_choice"&&(()=>{const t=A(s.id);return e.jsxs("div",{className:"space-y-3",children:[t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg text-sm text-gaming-textMuted",children:[e.jsx(Ne,{size:14}),e.jsx("span",{children:n==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"})]}),s.options.map((i,g)=>{const o=j[s.id]===i.id;return e.jsxs("button",{onClick:()=>Y(s.id,i.id),disabled:t,className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${o?"bg-gaming-primary/20 border-gaming-primary":t?"bg-white/5 border-white/5 opacity-40 cursor-not-allowed":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 ${o?"bg-gaming-primary text-white":"bg-white/10"}`,children:String.fromCharCode(65+g)}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:ie(i)}}),i.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[200px]",children:e.jsx("img",{src:i.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),o&&t&&e.jsx(Ne,{size:16,className:"text-gaming-textMuted shrink-0"})]},i.id)})]})})(),s.type==="matching"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 pb-4 border-b border-white/10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-pink uppercase tracking-wider mb-2",children:n==="ru"?"Группа 1":"Гурӯҳи 1"}),s.leftItems.map((t,i)=>e.jsxs("div",{className:"text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"font-bold text-gaming-pink min-w-[20px] pt-1",children:[String.fromCharCode(65+i),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:ie(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-accent uppercase tracking-wider mb-2",children:n==="ru"?"Группа 2":"Гурӯҳи 2"}),s.rightItems.map((t,i)=>e.jsxs("div",{className:"text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"font-bold text-gaming-accent min-w-[20px] pt-1",children:[i+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:ie(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]})]}),e.jsx("p",{className:"text-sm text-gaming-textMuted text-center",children:n==="ru"?"Выберите соответствия в сетке:":"Мувофиқатро дар ҷадвал интихоб кунед:"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"overflow-x-auto max-w-full pb-2",children:e.jsxs("table",{className:"border-separate border-spacing-1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8"}),s.rightItems.map((t,i)=>e.jsx("th",{className:"text-center font-bold text-gaming-accent text-sm p-1",children:i+1},t.id))]})}),e.jsx("tbody",{children:s.leftItems.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-bold text-gaming-pink text-sm p-1",children:String.fromCharCode(65+i)}),s.rightItems.map(g=>{var R;const o=((R=j[s.id])==null?void 0:R[t.id])===g.id,_=A(s.id);return e.jsx("td",{className:"text-center p-0.5",children:e.jsx("button",{onClick:()=>Y(s.id,{...j[s.id]||{},[t.id]:g.id}),disabled:_,className:`w-8 h-8 rounded-full border-2 transition-all flex items-center justify-center
                                                                        ${o?"bg-gaming-primary border-gaming-primary":_?"bg-white/5 border-white/10 opacity-30 cursor-not-allowed":"bg-white/5 border-white/20 hover:border-white/40"}`,children:o&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})},g.id)})]},t.id))})]})})})]}),s.type==="numeric"&&(()=>{const t=A(s.id);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gaming-textMuted",children:t?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ne,{size:14})," ",n==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"]}):n==="ru"?"Введите ответ:":"Ҷавобро ворид кунед:"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[[0,1,2,3].map(i=>e.jsx("input",{type:"text",maxLength:1,disabled:t,value:(j[s.id]||"")[i]||"",onChange:g=>{const o=g.target.value;if(o&&!/^\d$/.test(o))return;const R=(j[s.id]||"").split("");if(R[i]=o,Y(s.id,R.join("")),o&&i<3){const O=g.target.nextElementSibling;O&&O.focus()}},className:`w-14 h-14 text-center text-2xl font-bold rounded-lg text-white focus:outline-none ${t?"bg-gaming-bg/50 border-2 border-gaming-primary/30 opacity-70 cursor-not-allowed":"bg-gaming-bg/50 border-2 border-white/20 focus:border-gaming-primary"}`},i)),s.unit&&e.jsx("span",{className:"text-xl text-gaming-textMuted ml-2",children:s.unit})]})]})})()]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-white/10 relative z-10",children:[C>0?e.jsxs("button",{onClick:xe,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white hover:bg-white/10",children:[e.jsx(fe,{size:18}),n==="ru"?"Назад":"Қафо"]}):e.jsx("div",{}),C===c-1?e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[v&&T&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-500/20 border border-red-500/40 text-red-400 rounded-xl text-sm animate-bounce",children:[e.jsx(tt,{size:16,className:"shrink-0"}),e.jsx("span",{children:T})]}),e.jsxs("button",{onClick:Q,className:`flex items-center gap-2 px-6 py-2 rounded-xl transition-all ${v?"bg-red-500/80 text-white animate-[shake_0.5s_ease-in-out]":"bg-gaming-primary text-white hover:bg-gaming-primary/80"}`,children:[e.jsx(Z,{size:18}),n==="ru"?"Завершить тест":"Тамом кардан"]})]}):e.jsxs("button",{onClick:je,className:"flex items-center gap-2 px-4 py-2 text-white hover:bg-white/10 rounded-xl",children:[n==="ru"?"Далее":"Оянда",e.jsx(ke,{size:18})]})]})]})]})},at=({questions:r,lang:x,onClose:n})=>{const[u,I]=h.useState(!1),[C,w]=h.useState({});if(!r||r.length===0)return null;const j=a=>{w(d=>({...d,[a]:!d[a]}))},S=()=>{const a=!u;I(a);const d={};r.forEach(v=>d[v.id]=a),w(d)},H=a=>{const d=x==="tj"&&a.textTj||a.textRu;return de(d||"")},l=a=>{const d=x==="tj"&&a.textTj||a.textRu;return de(d||"")};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-4xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8 shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:x==="ru"?"Режим учителя: Просмотр теста":"Реҷаи омӯзгор: Дидани тест"}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[r.length," ",x==="ru"?"вопросов":"савол"]})]}),e.jsx("button",{onClick:n,className:"p-2 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(pe,{size:24})})]}),e.jsx("div",{className:"p-4 bg-black/20 border-b border-white/5 flex justify-between items-center shrink-0",children:e.jsxs("button",{onClick:S,className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all ${u?"bg-gaming-primary text-white":"bg-white/10 text-gaming-textMuted hover:text-white"}`,children:[u?e.jsx(Qe,{size:18}):e.jsx(ce,{size:18}),u?x==="ru"?"Скрыть все ответы":"Пинҳон кардани ҷавобҳо":x==="ru"?"Показать все ответы":"Нишон додани ҷавобҳо"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:r.map((a,d)=>{const v=C[a.id];return e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 bg-gaming-pink/10 text-gaming-pink rounded-lg flex items-center justify-center font-bold text-sm border border-gaming-pink/20",children:d+1}),e.jsx("div",{className:"text-lg font-medium text-white pt-1 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:H(a)}}),a.image&&e.jsx("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-md",children:e.jsx("img",{src:a.image,alt:"Question",className:"w-full h-auto object-cover"})})]}),e.jsx("button",{onClick:()=>j(a.id),className:`p-2 rounded-lg transition-colors ${v?"text-gaming-primary bg-gaming-primary/10":"text-gaming-textMuted hover:bg-white/5"}`,title:x==="ru"?"Показать/Скрыть ответ":"Нишон додан/Пинҳон кардан",children:v?e.jsx(Qe,{size:20}):e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"transition-all duration-300",children:[a.type==="multiple_choice"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pl-11",children:a.options.map((b,T)=>{const E=b.id===a.correctId&&v;return e.jsxs("div",{className:`p-3 rounded-xl border flex items-center gap-3 transition-all duration-300 ${E?"bg-green-500/10 border-green-500/30 text-green-400 font-bold":"bg-black/20 border-white/5 text-gaming-textMuted"}`,children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs transition-colors ${E?"bg-green-500 text-white":"bg-white/10"}`,children:String.fromCharCode(65+T)}),e.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:l(b)}}),b.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[150px]",children:e.jsx("img",{src:b.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),E&&e.jsx(Z,{size:16,className:"ml-auto animate-in zoom-in duration-300 shrink-0"})]},b.id)})}),a.type==="matching"&&e.jsxs("div",{className:"pl-11 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:x==="ru"?"Элементы":"Элементҳо"}),a.leftItems.map((b,T)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"text-gaming-pink font-bold mt-0.5",children:[String.fromCharCode(65+T),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:l(b)}}),b.image&&e.jsx("img",{src:b.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},b.id))]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gaming-textMuted uppercase mb-2",children:x==="ru"?"Определения":"Таърифҳо"}),a.rightItems.map((b,T)=>e.jsxs("div",{className:"mb-2 text-sm flex gap-2 items-start",children:[e.jsxs("span",{className:"text-gaming-accent font-bold mt-0.5",children:[T+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white/80",dangerouslySetInnerHTML:{__html:l(b)}}),b.image&&e.jsx("img",{src:b.image,alt:"Item",className:"w-16 h-16 object-cover rounded-md border border-white/10"})]})]},b.id))]})]}),v&&e.jsxs("div",{className:"p-4 bg-green-500/5 border border-green-500/20 rounded-xl animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx("p",{className:"text-sm text-green-400 font-bold mb-2",children:x==="ru"?"Правильные пары:":"Ҷуфтҳои дуруст:"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(a.correctMatches).map(([b,T])=>{const V=a.leftItems.findIndex(P=>P.id===b),E=a.rightItems.findIndex(P=>P.id===T);return e.jsxs("span",{className:"px-2 py-1 bg-green-500/10 rounded border border-green-500/20 text-sm",children:[String.fromCharCode(65+V)," — ",E+1]},b)})})]})]}),a.type==="numeric"&&e.jsx("div",{className:"pl-11",children:e.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 bg-green-500/5 border border-white/5 rounded-xl transition-all duration-300",children:[e.jsx("span",{className:"text-sm text-gaming-textMuted",children:x==="ru"?"Ответ:":"Ҷавоб:"}),e.jsx("span",{className:`text-xl font-bold tracking-widest transition-all duration-300 ${v?"text-green-400":"text-white/20"}`,children:v?a.digits.join(""):"****"}),a.unit&&e.jsx("span",{className:"text-gaming-textMuted",children:a.unit}),v&&e.jsx(Z,{size:16,className:"text-green-400 animate-in zoom-in"})]})})]})]},a.id)})})]})})},se=(r,x)=>`progress_${r}_${x}`,gt=({lang:r,t:x,userRole:n})=>{var Ie,Te,Me,$e,_e,Re,Le,Ee,Ae,He,Ve,Oe,Fe;const{lessonId:u}=Ge(),I=Ze(),C=80,[w,j]=h.useState(!0),[S,H]=h.useState(null),[l,a]=h.useState(()=>({videoWatched:localStorage.getItem(se(u,"video"))==="true",textRead:localStorage.getItem(se(u,"text"))==="true",slidesViewed:JSON.parse(localStorage.getItem(se(u,"slides"))||"[]"),testHistory:JSON.parse(localStorage.getItem(`test_history_${u}`)||"[]")})),[d,v]=h.useState("video"),[b,T]=h.useState(!1),[V,E]=h.useState(!1),[P,U]=h.useState(!1),M=n==="teacher";h.useEffect(()=>{(async()=>{j(!0);try{const f=await Je.getLesson(u,r);if(!f){H(null),j(!1);return}const F=f.subject;let G=null;if(F){const q=await Je.getStructure(F);if(q&&q.sections)for(let ee=0;ee<q.sections.length;ee++){const X=q.sections[ee];if(X.topics){for(let te=0;te<X.topics.length;te++){const he=X.topics[te];if(!he.lessons)continue;const ve=he.lessons.findIndex(Ye=>Ye.id===u);if(ve!==-1){G={lesson:{...f,...he.lessons[ve],content:f.content},topic:he,section:X,subjectKey:F,lessonIndex:ve,topicIndex:te,sectionIndex:ee};break}}if(G)break}}}H(G||{lesson:f,subjectKey:F})}catch(f){console.error("Error fetching lesson:",f)}finally{j(!1)}})()},[u,r]);const N=((Ie=S==null?void 0:S.lesson)==null?void 0:Ie.content)||{},z=r==="tj"?((Te=N.video)==null?void 0:Te.urlTj)||((Me=N.video)==null?void 0:Me.url):(($e=N.video)==null?void 0:$e.url)||((_e=N.video)==null?void 0:_e.urlTj),s=!!z,c=!!((Re=N.text)!=null&&Re.bodyRu||(Le=N.text)!=null&&Le.bodyTj),A=r==="tj"?N.slidesTj||[]:N.slidesRu||[],$=A.length>0,Y=((Ae=(Ee=N.test)==null?void 0:Ee.questions)==null?void 0:Ae.length)>0,je=s||c||$,xe=((He=N.test)==null?void 0:He.questions)||[],p=h.useMemo(()=>{if(!l.testHistory||l.testHistory.length===0)return null;const m=l.testHistory.length,f=Math.max(...l.testHistory.map(X=>X.score)),F=l.testHistory.reduce((X,te)=>X+te.score,0)/m,G=Math.round(100-F),q=l.testHistory[l.testHistory.length-1].timestamp,ee=f>=C;return{totalAttempts:m,bestScore:f,avgErrorRate:G,lastAttemptAt:q,isPassed:ee}},[l.testHistory]),K=A.length,W=l.slidesViewed.length,Q=K>0?W>=K:!0,we=!s||l.videoWatched,me=!c||l.textRead,t=M||we&&me&&(!$||Q),i=[s,c,$,Y].filter(Boolean).length;let g=0;s&&l.videoWatched&&g++,c&&l.textRead&&g++,$&&Q&&g++,Y&&(p!=null&&p.isPassed)&&g++;const o=i>0?Math.round(g/i*100):0;h.useEffect(()=>{!w&&S&&(s?v("video"):c?v("text"):$&&v("slides"))},[w,s,c,$]);const _=()=>{M||(localStorage.setItem(se(u,"video"),"true"),a(m=>({...m,videoWatched:!0})))},R=()=>{M||l.textRead||(localStorage.setItem(se(u,"text"),"true"),a(m=>({...m,textRead:!0})))},O=m=>{if(M)return;const f=[...new Set([...l.slidesViewed,m])];localStorage.setItem(se(u,"slides"),JSON.stringify(f)),a(F=>({...F,slidesViewed:f}))},ne=()=>{t?U(!0):E(!0)},L=m=>{const f=JSON.parse(localStorage.getItem(`test_history_${u}`)||"[]");a(F=>({...F,testHistory:f}))};if(h.useEffect(()=>{const m=f=>{f.key==="Escape"&&(V&&E(!1),b&&T(!1))};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[V,b]),w)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gaming-bg",children:e.jsx(st,{size:40,className:"text-gaming-primary animate-spin"})});if(!S)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-white bg-gaming-bg",children:[e.jsx("h2",{className:"text-2xl mb-4",children:x.lessonNotFound}),e.jsx("button",{onClick:()=>I(-1),className:"text-gaming-primary hover:underline",children:x.errorBack})]});const{lesson:D,topic:y,section:k,subjectKey:le,lessonIndex:ue,sectionIndex:Xe,topicIndex:Be}=S,Se=m=>r==="tj"&&m.titleTj?m.titleTj:m.title,Ce=(Ve=y==null?void 0:y.lessons)==null?void 0:Ve[ue-1],ze=(Oe=y==null?void 0:y.lessons)==null?void 0:Oe[ue+1],ae=[];return s&&ae.push({id:"video",icon:We,label:{ru:"Видео",tj:"Видео"},complete:l.videoWatched}),c&&ae.push({id:"text",icon:De,label:{ru:"Конспект",tj:"Матн"},complete:l.textRead}),$&&ae.push({id:"slides",icon:ge,label:{ru:"Слайды",tj:"Слайдҳо"},complete:Q}),e.jsxs(qe,{subjectId:le,lang:r,children:[e.jsxs("div",{className:"max-w-4xl",children:[e.jsxs("header",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>{le&&(k!=null&&k.id)&&(y!=null&&y.id)?I(`/subject/${le}/section/${k.id}/topic/${y.id}`):I(-1)},className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-gaming-textMuted hover:text-white transition-all mb-4 group w-fit",children:[e.jsx(fe,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:x.backToTopic})]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gaming-textMuted mb-1",children:[r==="ru"?"Урок":"Дарс"," ",ue+1," / ",((Fe=y==null?void 0:y.lessons)==null?void 0:Fe.length)||0]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2 text-gaming-pink",children:[ue+1,". ",Se(D)]}),y&&e.jsx("p",{className:"text-gaming-textMuted flex items-center gap-2 text-sm",children:e.jsxs("span",{children:[Xe+1,".",Be+1,". ",Se(y)]})})]}),M&&e.jsx("div",{className:"px-3 py-1 bg-gaming-pink text-white text-xs font-bold rounded-full uppercase tracking-wider animate-pulse",children:x.teacherMode})]})]}),!M&&e.jsxs("div",{className:"mb-8 bg-gradient-to-br from-gaming-primary/20 to-gaming-pink/20 backdrop-blur-xl border border-white/10 rounded-2xl p-6 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg mb-1",children:x.lessonProgress}),e.jsxs("p",{className:"text-gaming-textMuted text-sm",children:[g," / ",i," ",r==="ru"?"этапов завершено":"марҳила анҷом ёфт"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-3xl font-bold text-gaming-primary",children:[o,"%"]})})]}),e.jsx("div",{className:"w-full h-3 bg-black/30 rounded-full mb-6 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gaming-primary to-gaming-pink transition-all duration-1000 ease-out",style:{width:`${o}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[s&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${l.videoWatched?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${l.videoWatched?"bg-green-500/20":"bg-white/10"}`,children:l.videoWatched?e.jsx(J,{size:20}):e.jsx(We,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:"Видео"})]}),c&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${l.textRead?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${l.textRead?"bg-green-500/20":"bg-white/10"}`,children:l.textRead?e.jsx(J,{size:20}):e.jsx(De,{size:20})}),e.jsx("span",{className:"font-medium text-sm",children:r==="ru"?"Текст":"Матн"})]}),$&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${Q?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${Q?"bg-green-500/20":"bg-white/10"}`,children:Q?e.jsx(J,{size:20}):e.jsx(ge,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:r==="ru"?"Слайды":"Слайдҳо"}),e.jsxs("span",{className:"text-xs opacity-70",children:[W,"/",K]})]})]}),Y&&e.jsxs("div",{className:`p-4 rounded-xl border flex flex-col items-center justify-center gap-2 transition-colors ${p!=null&&p.isPassed?"bg-green-500/10 border-green-500/30 text-green-400":"bg-white/5 border-white/10 text-gaming-textMuted"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${p!=null&&p.isPassed?"bg-green-500/20":"bg-white/10"}`,children:p!=null&&p.isPassed?e.jsx(J,{size:20}):e.jsx(Z,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:"Тест"}),p&&e.jsxs("span",{className:"text-xs font-bold",children:[p.bestScore,"%"]})]})]})]})]}),p&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-white/10 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(Ue,{size:18,className:"text-gaming-gold"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:r==="ru"?"Попыток":"Кӯшишҳо"}),e.jsx("div",{className:"font-bold text-white",children:p.totalAttempts})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/5",children:[e.jsx(rt,{size:18,className:"text-gaming-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider",children:r==="ru"?"Последняя":"Охирин"}),e.jsx("div",{className:"font-bold text-white",children:p.lastAttemptAt?new Intl.DateTimeFormat(r==="tj"?"tg-TJ":"ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}).format(new Date(p.lastAttemptAt)):"-"})]})]})]})]}),je?e.jsxs(e.Fragment,{children:[ae.length>0&&e.jsx("div",{className:"flex gap-4 mb-6 border-b border-white/5 overflow-x-auto",children:ae.map(m=>{const f=m.icon;return e.jsxs("button",{onClick:()=>v(m.id),className:`pb-3 px-2 text-base font-semibold transition-all relative flex items-center gap-2 whitespace-nowrap ${d===m.id?"text-white":"text-gaming-textMuted hover:text-white"}`,children:[e.jsx(f,{size:18}),m.label[r],m.complete&&!M&&e.jsx(J,{size:14,className:"text-green-400"}),d===m.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gaming-pink rounded-t-full shadow-[0_0_10px_rgba(236,72,153,0.5)]"})]},m.id)})}),e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-6 mb-6 shadow-xl overflow-hidden relative group",children:[e.jsx("div",{className:"absolute -left-20 -top-20 w-64 h-64 bg-gaming-pink/5 rounded-full blur-3xl group-hover:bg-gaming-pink/10 transition-all duration-700"}),e.jsxs("div",{className:"relative z-10",children:[d==="video"&&s&&e.jsxs("div",{className:"aspect-video bg-black/60 rounded-xl flex flex-col items-center justify-center border border-white/10 shadow-inner overflow-hidden relative",children:[z.includes("youtube")||z.includes("youtu.be")?(()=>{const m=z.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|.*\/|.*embed\/))([^&?]*)/),f=m?m[1]:null;return f?e.jsx("iframe",{src:`https://www.youtube.com/embed/${f}`,className:"w-full h-full",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onLoad:_}):e.jsxs("div",{className:"text-white text-center p-4",children:[e.jsx("p",{children:"Не удалось загрузить видео"}),e.jsx("a",{href:z,target:"_blank",rel:"noopener noreferrer",className:"text-gaming-primary hover:underline mt-2 inline-block",children:"Открыть на YouTube"})]})})():e.jsx("video",{src:z,controls:!0,className:"w-full h-full",onEnded:_,onPlay:()=>setTimeout(_,3e4)}),!l.videoWatched&&!M&&e.jsxs("button",{onClick:_,className:"absolute bottom-4 right-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(ce,{size:16}),r==="ru"?"Отметить как просмотренное":"Ҳамчун дидашуда қайд кунед"]})]}),d==="text"&&c&&e.jsxs("div",{className:"prose prose-invert max-w-none prose-p:text-gaming-textMuted prose-headings:text-white prose-li:text-gaming-textMuted",onScroll:m=>{const{scrollTop:f,scrollHeight:F,clientHeight:G}=m.target;f+G>=F-50&&R()},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:de(r==="tj"&&N.text.bodyTj||N.text.bodyRu)}}),!l.textRead&&!M&&e.jsxs("button",{onClick:R,className:"mt-4 flex items-center gap-2 px-3 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm",children:[e.jsx(ce,{size:16}),r==="ru"?"Отметить как прочитанное":"Ҳамчун хондашуда қайд кунед"]})]}),d==="slides"&&$&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gaming-textMuted",children:[W," / ",K," ",r==="ru"?"слайдов просмотрено":"слайд дида шуд"]}),e.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-2 px-4 py-2 bg-gaming-gold/20 text-gaming-gold rounded-xl hover:bg-gaming-gold/30 transition-colors",children:[e.jsx(ge,{size:18}),r==="ru"?"Открыть презентацию":"Кушодани презентатсия"]})]}),e.jsx("div",{className:"flex flex-col gap-6",children:A.map((m,f)=>e.jsxs("button",{onClick:()=>{O(m.id),T(!0)},className:"relative w-full rounded-2xl overflow-hidden border border-white/5 hover:border-gaming-gold/30 transition-all group shadow-lg",children:[e.jsx("img",{src:m.imageUrl,alt:`Slide ${f+1}`,className:"w-full h-auto object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-sm",children:e.jsx("div",{className:"bg-black/60 p-3 rounded-full border border-white/20 transform scale-90 group-hover:scale-100 transition-transform",children:e.jsx(ge,{size:24,className:"text-white"})})}),e.jsx("div",{className:"absolute top-4 left-4 bg-black/60 backdrop-blur px-3 py-1 rounded-full text-white font-bold text-sm border border-white/10",children:f+1}),(l.slidesViewed.includes(m.id)||M)&&e.jsx("div",{className:"absolute top-4 right-4 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center shadow-lg animate-in fade-in zoom-in",children:e.jsx(J,{size:16,className:"text-white"})})]},m.id))})]})]})]})]}):e.jsxs("div",{className:"bg-gaming-card/40 backdrop-blur-xl rounded-2xl border border-white/5 p-8 mb-6 text-center",children:[e.jsx(et,{size:48,className:"mx-auto mb-4 text-gaming-primary opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:r==="ru"?"Тестирование":"Санҷиш"}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:r==="ru"?"Этот урок содержит только тест.":"Ин дарс танҳо тест дорад."})]}),V&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-gaming-card/95 backdrop-blur-xl rounded-2xl border border-red-500/30 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-400 mb-4",children:[e.jsx(oe,{size:24}),e.jsx("h3",{className:"text-lg font-semibold",children:r==="ru"?"Просмотрите материалы":"Маводҳоро бинед"})]}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:r==="ru"?"Перед началом теста необходимо просмотреть все материалы урока:":"Пеш аз оғози тест бояд ҳамаи маводҳои дарсро бинед:"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[s&&e.jsxs("li",{className:`flex items-center gap-2 ${l.videoWatched?"text-green-400":"text-red-400"}`,children:[l.videoWatched?e.jsx(J,{size:16}):e.jsx(oe,{size:16}),"Видео"]}),c&&e.jsxs("li",{className:`flex items-center gap-2 ${l.textRead?"text-green-400":"text-red-400"}`,children:[l.textRead?e.jsx(J,{size:16}):e.jsx(oe,{size:16}),r==="ru"?"Текст":"Матн"]}),$&&e.jsxs("li",{className:`flex items-center gap-2 ${Q?"text-green-400":"text-red-400"}`,children:[Q?e.jsx(J,{size:16}):e.jsx(oe,{size:16}),r==="ru"?`Слайды (${W}/${K})`:`Слайдҳо (${W}/${K})`]})]}),e.jsx("button",{onClick:()=>E(!1),className:"w-full px-4 py-3 bg-gaming-primary text-white rounded-xl hover:bg-gaming-primary/80 transition-colors",children:r==="ru"?"Понятно":"Фаҳмидам"})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[Ce&&e.jsxs("button",{onClick:()=>I(`/lesson/${Ce.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx(fe,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:r==="ru"?"Предыдущий":"Пешина"})]}),ze&&e.jsxs("button",{onClick:()=>I(`/lesson/${ze.id}`),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gaming-textMuted hover:text-white transition-colors text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:r==="ru"?"Следующий":"Оянда"}),e.jsx(ke,{size:16})]})]}),e.jsxs("button",{onClick:ne,className:`group font-bold py-3 px-8 rounded-xl flex items-center gap-2 transition-all transform hover:scale-[1.02] active:scale-95 shadow-lg border border-white/10 ${t?M?"bg-gaming-pink hover:bg-gaming-pink/80 text-white shadow-gaming-pink/25":"bg-gaming-primary hover:bg-gaming-primary/80 text-white shadow-gaming-primary/25":"bg-gaming-card/60 text-gaming-textMuted cursor-not-allowed"}`,children:[M?e.jsx(ce,{size:20}):e.jsx(Z,{size:20}),e.jsx("span",{children:M?r==="ru"?"Просмотреть тест":"Дидани тест":r==="ru"?"Пройти тест":"Супоридани тест"}),!t&&e.jsx(oe,{size:16,className:"text-yellow-400"})]})]})]}),b&&$&&e.jsx(nt,{slides:A,lessonId:u,lang:r,onClose:()=>T(!1),onSlideView:O}),P&&(M?e.jsx(at,{questions:xe,lang:r,onClose:()=>U(!1)}):e.jsx(lt,{questions:xe,lessonId:u,lang:r,onClose:()=>U(!1),onComplete:L}))]})};export{gt as default};
