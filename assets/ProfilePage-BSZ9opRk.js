import{e as g,u as k,c as _,r as d,j as e,U as m,B as b,m as P,n as S,L as C,s as z}from"./index-DRfO7QNx.js";import{C as M,A as D}from"./check-circle-DbkDMSwU.js";import{M as X}from"./mail-BSfYk_PE.js";import{G as f,S as A}from"./save-CHh5reZj.js";import{S as R,a as U,b as I}from"./shield-DwlyXhVX.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=g("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=g("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=g("School",[["path",{d:"M14 22v-4a2 2 0 1 0-4 0v4",key:"hhkicm"}],["path",{d:"m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2",key:"1vwozw"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"m4 6 8-4 8 4",key:"1q0ilc"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]),H=()=>{var p;const{t}=k(),{user:r,profile:a}=_(),[s,x]=d.useState({full_name:"",phone:"",birth_date:"",school:"",grade:"",branch:"",group_name:"",language:"tj",subject:"",cluster_id:""}),[u,h]=d.useState(!1),[o,i]=d.useState(null);d.useEffect(()=>{a&&x({full_name:a.full_name||"",phone:a.phone||"",birth_date:a.birth_date||"",school:a.school||"",grade:a.grade||"",branch:a.branch||"",group_name:a.group_name||"",language:a.language||"tj",subject:a.subject||"",cluster_id:a.cluster_id||""})},[a]);const n=l=>{const{name:v,value:w}=l.target;x(N=>({...N,[v]:w})),i(null)},j=async()=>{h(!0),i(null);try{const{error:l}=await z.from("profiles").update({full_name:s.full_name,phone:s.phone||null,birth_date:s.birth_date||null,school:s.school||null,grade:s.grade?parseInt(s.grade):null,branch:s.branch||null,group_name:s.group_name||null,language:s.language,subject:s.subject||null,cluster_id:s.cluster_id?parseInt(s.cluster_id):null,updated_at:new Date().toISOString()}).eq("id",r.id);if(l)throw l;i("success"),setTimeout(()=>i(null),3e3)}catch(l){console.error("Ошибка сохранения профиля:",l),i("error")}finally{h(!1)}},c=(l=>{switch(l){case"super_admin":return{icon:e.jsx(I,{className:"text-red-500",size:20}),color:"border-red-500/50 bg-red-500/10 text-red-400",label:t("profilePage.roleSuperAdmin")};case"admin":return{icon:e.jsx(U,{className:"text-gaming-accent",size:20}),color:"border-gaming-accent/50 bg-gaming-accent/10 text-gaming-accent",label:t("profilePage.roleAdmin")};case"teacher":return{icon:e.jsx(R,{className:"text-gaming-primary",size:20}),color:"border-gaming-primary/50 bg-gaming-primary/10 text-gaming-primary",label:t("profilePage.roleTeacher")};default:return{icon:e.jsx(m,{className:"text-gray-400",size:20}),color:"border-white/10 bg-white/5 text-gray-400",label:t("profilePage.roleStudent")}}})(a==null?void 0:a.role),y=a!=null&&a.full_name?a.full_name.split(" ").map(l=>l[0]).join("").substring(0,2).toUpperCase():((p=r==null?void 0:r.email)==null?void 0:p[0].toUpperCase())||"U";return e.jsxs("div",{className:"min-h-screen pb-12 px-4 container mx-auto max-w-4xl",children:[e.jsx("div",{className:"mb-8 animate-fade-in-up",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-2xl bg-gradient-to-br from-gaming-primary via-gaming-purple to-gaming-pink flex items-center justify-center text-white font-heading font-bold text-3xl shadow-xl shadow-gaming-primary/20 border-2 border-white/10",children:y}),e.jsx("div",{className:`absolute -bottom-2 -right-2 p-1.5 rounded-lg border ${c.color}`,children:c.icon})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-3xl font-heading font-bold text-white",children:(a==null?void 0:a.full_name)||(r==null?void 0:r.email)}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 justify-center sm:justify-start",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${c.color}`,children:c.label}),e.jsx("span",{className:"text-gaming-textMuted text-sm",children:r==null?void 0:r.email})]})]})]})}),o&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl border flex items-center gap-3 animate-fade-in-up ${o==="success"?"bg-green-500/10 border-green-500/30 text-green-400":"bg-red-500/10 border-red-500/30 text-red-400"}`,children:[o==="success"?e.jsx(M,{size:20}):e.jsx(D,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:t(o==="success"?"profilePage.saved":"profilePage.error")})]}),e.jsxs("div",{className:`grid gap-6 ${(a==null?void 0:a.role)!=="super_admin"&&(a==null?void 0:a.role)!=="admin"?"lg:grid-cols-2":""}`,children:[e.jsxs("div",{className:"bg-gaming-card/60 backdrop-blur-xl border border-white/5 rounded-2xl p-6 animate-fade-in-up",style:{animationDelay:"0.1s"},children:[e.jsxs("h2",{className:"text-lg font-heading font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(m,{size:20,className:"text-gaming-primary"}),t("profilePage.personalInfo")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(m,{size:14}),t("profilePage.fullName")]}),e.jsx("input",{type:"text",name:"full_name",value:s.full_name,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.fullName")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(X,{size:14}),t("profilePage.email")]}),e.jsx("input",{type:"email",value:(r==null?void 0:r.email)||"",readOnly:!0,className:"w-full bg-black/30 border border-white/5 rounded-xl py-2.5 px-4 text-gray-400 cursor-not-allowed opacity-60"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(L,{size:14}),t("profilePage.phone")]}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:"+992 XXX XX XX XX"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(T,{size:14}),t("profilePage.birthDate")]}),e.jsx("input",{type:"date",name:"birth_date",value:s.birth_date,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors [color-scheme:dark]"})]})]})]}),(a==null?void 0:a.role)!=="super_admin"&&(a==null?void 0:a.role)!=="admin"&&e.jsxs("div",{className:"bg-gaming-card/60 backdrop-blur-xl border border-white/5 rounded-2xl p-6 animate-fade-in-up",style:{animationDelay:"0.2s"},children:[e.jsxs("h2",{className:"text-lg font-heading font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(f,{size:20,className:"text-gaming-accent"}),t("profilePage.educationInfo")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx($,{size:14}),t("profilePage.school")]}),e.jsx("input",{type:"text",name:"school",value:s.school,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.school")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(b,{size:14}),t("profilePage.grade")]}),e.jsxs("select",{name:"grade",value:s.grade,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:t("profilePage.notSpecified")}),[1,2,3,4,5,6,7,8,9,10,11].map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:t("profilePage.branch")}),e.jsx("input",{type:"text",name:"branch",value:s.branch,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.branch")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:t("profilePage.group")}),e.jsx("input",{type:"text",name:"group_name",value:s.group_name,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.group")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(P,{size:14}),t("profilePage.language")]}),e.jsxs("select",{name:"language",value:s.language,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"ru",children:t("profilePage.langRu")}),e.jsx("option",{value:"tj",children:t("profilePage.langTj")})]})]}),(a==null?void 0:a.role)==="teacher"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(b,{size:14}),t("profilePage.subject")]}),e.jsx("input",{type:"text",name:"subject",value:s.subject,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.subject")})]}),(a==null?void 0:a.role)!=="teacher"&&(a==null?void 0:a.role)!=="admin"&&(a==null?void 0:a.role)!=="super_admin"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(f,{size:14}),"Кластер обучения"]}),e.jsxs("select",{name:"cluster_id",value:s.cluster_id,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:t("profilePage.notSpecified")}),S.map(l=>e.jsx("option",{value:l.id,children:`Кластер ${l.id}: ${l.titleRu}`},l.id))]})]})]})]})]}),e.jsx("div",{className:"mt-8 flex justify-center animate-fade-in-up",style:{animationDelay:"0.3s"},children:e.jsx("button",{onClick:j,disabled:u,className:"flex items-center gap-3 px-8 py-3 bg-gradient-to-r from-gaming-primary to-gaming-pink text-white rounded-xl font-medium transition-all shadow-lg shadow-gaming-primary/25 hover:shadow-gaming-pink/25 hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:u?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:20,className:"animate-spin"}),t("profilePage.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{size:20}),t("profilePage.save")]})})})]})};export{H as default};
