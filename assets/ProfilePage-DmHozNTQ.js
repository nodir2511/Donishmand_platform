import{j as e}from"./editor-y_DXvsmM.js";import{r as d}from"./vendor-DfgOC3sD.js";import{u as N,C as _,s as k}from"./index-CZ7BpQlM.js";import{u as P,r as C,w as S,U as m,a3 as z,am as M,a8 as D,x as h,an as X,f as b,c as R,k as U,D as T,a1 as I,a0 as $,a2 as A}from"./ui-DqTeed5j.js";import"./supabase-CQnWzhEg.js";const G=()=>{var p;const{t}=P(),{user:r,profile:a}=N(),[s,g]=d.useState({full_name:"",phone:"",birth_date:"",school:"",grade:"",branch:"",group_name:"",language:"tj",subject:"",cluster_id:""}),[x,u]=d.useState(!1),[o,i]=d.useState(null);d.useEffect(()=>{a&&g({full_name:a.full_name||"",phone:a.phone||"",birth_date:a.birth_date||"",school:a.school||"",grade:a.grade||"",branch:a.branch||"",group_name:a.group_name||"",language:a.language||"tj",subject:a.subject||"",cluster_id:a.cluster_id||""})},[a]);const n=l=>{const{name:y,value:v}=l.target;g(w=>({...w,[y]:v})),i(null)},f=async()=>{u(!0),i(null);try{const{error:l}=await k.from("profiles").update({full_name:s.full_name,phone:s.phone||null,birth_date:s.birth_date||null,school:s.school||null,grade:s.grade?parseInt(s.grade):null,branch:s.branch||null,group_name:s.group_name||null,language:s.language,subject:s.subject||null,cluster_id:s.cluster_id?parseInt(s.cluster_id):null,updated_at:new Date().toISOString()}).eq("id",r.id);if(l)throw l;i("success"),setTimeout(()=>i(null),3e3)}catch(l){console.error("Ошибка сохранения профиля:",l),i("error")}finally{u(!1)}},c=(l=>{switch(l){case"super_admin":return{icon:e.jsx(A,{className:"text-red-500",size:20}),color:"border-red-500/50 bg-red-500/10 text-red-400",label:t("profilePage.roleSuperAdmin")};case"admin":return{icon:e.jsx($,{className:"text-gaming-accent",size:20}),color:"border-gaming-accent/50 bg-gaming-accent/10 text-gaming-accent",label:t("profilePage.roleAdmin")};case"teacher":return{icon:e.jsx(I,{className:"text-gaming-primary",size:20}),color:"border-gaming-primary/50 bg-gaming-primary/10 text-gaming-primary",label:t("profilePage.roleTeacher")};default:return{icon:e.jsx(m,{className:"text-gray-400",size:20}),color:"border-white/10 bg-white/5 text-gray-400",label:t("profilePage.roleStudent")}}})(a==null?void 0:a.role),j=a!=null&&a.full_name?a.full_name.split(" ").map(l=>l[0]).join("").substring(0,2).toUpperCase():((p=r==null?void 0:r.email)==null?void 0:p[0].toUpperCase())||"U";return e.jsxs("div",{className:"min-h-screen pb-12 px-4 container mx-auto max-w-4xl",children:[e.jsx("div",{className:"mb-8 animate-fade-in-up",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-2xl bg-gradient-to-br from-gaming-primary via-gaming-purple to-gaming-pink flex items-center justify-center text-white font-heading font-bold text-3xl shadow-xl shadow-gaming-primary/20 border-2 border-white/10",children:j}),e.jsx("div",{className:`absolute -bottom-2 -right-2 p-1.5 rounded-lg border ${c.color}`,children:c.icon})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-3xl font-heading font-bold text-white",children:(a==null?void 0:a.full_name)||(r==null?void 0:r.email)}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 justify-center sm:justify-start",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${c.color}`,children:c.label}),e.jsx("span",{className:"text-gaming-textMuted text-sm",children:r==null?void 0:r.email})]})]})]})}),o&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl border flex items-center gap-3 animate-fade-in-up ${o==="success"?"bg-green-500/10 border-green-500/30 text-green-400":"bg-red-500/10 border-red-500/30 text-red-400"}`,children:[o==="success"?e.jsx(C,{size:20}):e.jsx(S,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:t(o==="success"?"profilePage.saved":"profilePage.error")})]}),e.jsxs("div",{className:`grid gap-6 ${(a==null?void 0:a.role)!=="super_admin"&&(a==null?void 0:a.role)!=="admin"?"lg:grid-cols-2":""}`,children:[e.jsxs("div",{className:"bg-gaming-card/60 backdrop-blur-xl border border-white/5 rounded-2xl p-6 animate-fade-in-up",style:{animationDelay:"0.1s"},children:[e.jsxs("h2",{className:"text-lg font-heading font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(m,{size:20,className:"text-gaming-primary"}),t("profilePage.personalInfo")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(m,{size:14}),t("profilePage.fullName")]}),e.jsx("input",{type:"text",name:"full_name",value:s.full_name,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.fullName")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(z,{size:14}),t("profilePage.email")]}),e.jsx("input",{type:"email",value:(r==null?void 0:r.email)||"",readOnly:!0,className:"w-full bg-black/30 border border-white/5 rounded-xl py-2.5 px-4 text-gray-400 cursor-not-allowed opacity-60"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(M,{size:14}),t("profilePage.phone")]}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:"+992 XXX XX XX XX"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(D,{size:14}),t("profilePage.birthDate")]}),e.jsx("input",{type:"date",name:"birth_date",value:s.birth_date,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors [color-scheme:dark]"})]})]})]}),(a==null?void 0:a.role)!=="super_admin"&&(a==null?void 0:a.role)!=="admin"&&e.jsxs("div",{className:"bg-gaming-card/60 backdrop-blur-xl border border-white/5 rounded-2xl p-6 animate-fade-in-up",style:{animationDelay:"0.2s"},children:[e.jsxs("h2",{className:"text-lg font-heading font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(h,{size:20,className:"text-gaming-accent"}),t("profilePage.educationInfo")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(X,{size:14}),t("profilePage.school")]}),e.jsx("input",{type:"text",name:"school",value:s.school,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.school")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(b,{size:14}),t("profilePage.grade")]}),e.jsxs("select",{name:"grade",value:s.grade,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:t("profilePage.notSpecified")}),[1,2,3,4,5,6,7,8,9,10,11].map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:t("profilePage.branch")}),e.jsx("input",{type:"text",name:"branch",value:s.branch,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.branch")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gaming-textMuted mb-1.5",children:t("profilePage.group")}),e.jsx("input",{type:"text",name:"group_name",value:s.group_name,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.group")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(R,{size:14}),t("profilePage.language")]}),e.jsxs("select",{name:"language",value:s.language,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"ru",children:t("profilePage.langRu")}),e.jsx("option",{value:"tj",children:t("profilePage.langTj")})]})]}),(a==null?void 0:a.role)==="teacher"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(b,{size:14}),t("profilePage.subject")]}),e.jsx("input",{type:"text",name:"subject",value:s.subject,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white placeholder-gray-500 focus:outline-none focus:border-gaming-primary transition-colors",placeholder:t("profilePage.subject")})]}),(a==null?void 0:a.role)!=="teacher"&&(a==null?void 0:a.role)!=="admin"&&(a==null?void 0:a.role)!=="super_admin"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gaming-textMuted mb-1.5 flex items-center gap-1.5",children:[e.jsx(h,{size:14}),"Кластер обучения"]}),e.jsxs("select",{name:"cluster_id",value:s.cluster_id,onChange:n,className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-white focus:outline-none focus:border-gaming-primary transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:t("profilePage.notSpecified")}),_.map(l=>e.jsx("option",{value:l.id,children:`Кластер ${l.id}: ${l.titleRu}`},l.id))]})]})]})]})]}),e.jsx("div",{className:"mt-8 flex justify-center animate-fade-in-up",style:{animationDelay:"0.3s"},children:e.jsx("button",{onClick:f,disabled:x,className:"flex items-center gap-3 px-8 py-3 bg-gradient-to-r from-gaming-primary to-gaming-pink text-white rounded-xl font-medium transition-all shadow-lg shadow-gaming-primary/25 hover:shadow-gaming-pink/25 hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:x?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:20,className:"animate-spin"}),t("profilePage.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{size:20}),t("profilePage.save")]})})})]})};export{G as default};
