import{e as I,k as w,r as _,j as H}from"./index-CrMD2eKm.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=I("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=I("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),E=t=>{var a,o,d,c,p,f,h;if(!t)return{contentRu:null,contentTj:null};const u=j=>{if(!j||!Array.isArray(j))return{ru:[],tj:[]};const l=j.map(e=>{const n={id:e.id,type:e.type,image:e.image};return n.text=e.textRu||"",e.type==="multiple_choice"?(n.options=(e.options||[]).map(r=>({id:r.id,text:r.textRu||"",image:r.image})),n.correctId=e.correctId):e.type==="matching"?(n.leftItems=(e.leftItems||[]).map(r=>({id:r.id,text:r.textRu||"",image:r.image})),n.rightItems=(e.rightItems||[]).map(r=>({id:r.id,text:r.textRu||"",image:r.image})),n.correctMatches=e.correctMatches):e.type==="numeric"&&(n.digits=e.digits,n.unit=e.unit),n}),x=j.map(e=>{const n={id:e.id,type:e.type,image:e.image};return n.text=e.textTj||"",e.type==="multiple_choice"?(n.options=(e.options||[]).map(r=>({id:r.id,text:r.textTj||"",image:r.image})),n.correctId=e.correctId):e.type==="matching"?(n.leftItems=(e.leftItems||[]).map(r=>({id:r.id,text:r.textTj||"",image:r.image})),n.rightItems=(e.rightItems||[]).map(r=>({id:r.id,text:r.textTj||"",image:r.image})),n.correctMatches=e.correctMatches):e.type==="numeric"&&(n.digits=e.digits,n.unit=e.unit),n});return{ru:l,tj:x}},{ru:i,tj:s}=u((a=t.test)==null?void 0:a.questions);return{contentRu:{video:{url:((o=t.video)==null?void 0:o.url)||"",description:((d=t.video)==null?void 0:d.descriptionRu)||""},text:{body:((c=t.text)==null?void 0:c.bodyRu)||""},test:{questions:i},slides:t.slidesRu||[]},contentTj:{video:{url:((p=t.video)==null?void 0:p.urlTj)||"",description:((f=t.video)==null?void 0:f.descriptionTj)||""},text:{body:((h=t.text)==null?void 0:h.bodyTj)||""},test:{questions:s},slides:t.slidesTj||[]}}},L=(t,u)=>{var o,d,c,p,f,h,j,l,x;if(t&&(t.slidesRu||(o=t.text)!=null&&o.bodyRu))return t;const i=t||{},s=u||{},a=(e,n)=>{const r=e||[],k=n||[];return r.map((m,C)=>{const S=k[C]||{},T={id:m.id,type:m.type,image:m.image,textRu:m.text||"",textTj:S.text||""};return m.type==="multiple_choice"?(T.options=(m.options||[]).map((y,v)=>{var b,R;return{id:y.id,image:y.image,textRu:y.text||"",textTj:((R=(b=S.options)==null?void 0:b[v])==null?void 0:R.text)||""}}),T.correctId=m.correctId):m.type==="matching"?(T.leftItems=(m.leftItems||[]).map((y,v)=>{var b,R;return{id:y.id,image:y.image,textRu:y.text||"",textTj:((R=(b=S.leftItems)==null?void 0:b[v])==null?void 0:R.text)||""}}),T.rightItems=(m.rightItems||[]).map((y,v)=>{var b,R;return{id:y.id,image:y.image,textRu:y.text||"",textTj:((R=(b=S.rightItems)==null?void 0:b[v])==null?void 0:R.text)||""}}),T.correctMatches=m.correctMatches):m.type==="numeric"&&(T.digits=m.digits,T.unit=m.unit),T})};return{video:{url:((d=i.video)==null?void 0:d.url)||"",urlTj:((c=s.video)==null?void 0:c.url)||"",descriptionRu:((p=i.video)==null?void 0:p.description)||"",descriptionTj:((f=s.video)==null?void 0:f.description)||""},text:{bodyRu:((h=i.text)==null?void 0:h.body)||"",bodyTj:((j=s.text)==null?void 0:j.body)||""},test:{questions:a((l=i.test)==null?void 0:l.questions,(x=s.test)==null?void 0:x.questions)},slidesRu:i.slides||[],slidesTj:s.slides||[]}},P={async saveStructure(t,u){const i=u.sections.map(a=>({id:a.id,title:a.title,titleTj:a.titleTj,topics:a.topics.map(o=>({id:o.id,title:o.title,titleTj:o.titleTj,lessons:o.lessons.map(d=>({id:d.id,title:d.title,titleTj:d.titleTj,type:d.type}))}))})),{error:s}=await w.from("subject_syllabus").upsert({subject:t,data:{sections:i},updated_at:new Date},{onConflict:"subject"});if(s)throw console.error("Ошибка сохранения структуры:",s),s;return!0},async getStructure(t){const{data:u,error:i}=await w.from("subject_syllabus").select("data").eq("subject",t).single();if(i){if(i.code==="PGRST116")return null;throw i}return u.data},async saveLesson(t,u){const{contentRu:i,contentTj:s}=E(t.content),{error:a}=await w.from("lessons").upsert({id:t.id,title_ru:t.title,title_tj:t.titleTj,subject:u,content_ru:i,content_tj:s,is_published:!0,updated_at:new Date},{onConflict:"id"});if(a)throw a;return!0},async getLesson(t,u=null){var d;const i=u==="ru"?"id, title_ru, title_tj, subject, content_ru":u==="tj"?"id, title_ru, title_tj, subject, content_tj":"*",{data:s,error:a}=await w.from("lessons").select(i).eq("id",t).single();if(a){if(a.code==="PGRST116")return null;throw a}let o;if(u){const c=u==="ru"?s.content_ru:s.content_tj;c&&(c.slidesRu||(d=c.text)!=null&&d.bodyRu)?o=c:o=Q(c,u)}else o=L(s.content_ru,s.content_tj);return{id:s.id,title:s.title_ru,titleTj:s.title_tj,content:o,subject:s.subject}}},Q=(t,u)=>{var a,o,d,c,p,f,h;if(!t)return{video:{url:"",urlTj:"",descriptionRu:"",descriptionTj:""},text:{bodyRu:"",bodyTj:""},test:{questions:[]},slidesRu:[],slidesTj:[]};const i=u==="ru",s=j=>(j||[]).map(l=>{const x={id:l.id,type:l.type,image:l.image,textRu:i&&l.text||"",textTj:i?"":l.text||""};return l.type==="multiple_choice"?(x.options=(l.options||[]).map(e=>({id:e.id,image:e.image,textRu:i&&e.text||"",textTj:i?"":e.text||""})),x.correctId=l.correctId):l.type==="matching"?(x.leftItems=(l.leftItems||[]).map(e=>({id:e.id,image:e.image,textRu:i&&e.text||"",textTj:i?"":e.text||""})),x.rightItems=(l.rightItems||[]).map(e=>({id:e.id,image:e.image,textRu:i&&e.text||"",textTj:i?"":e.text||""})),x.correctMatches=l.correctMatches):l.type==="numeric"&&(x.digits=l.digits,x.unit=l.unit),x});return{video:{url:i&&((a=t.video)==null?void 0:a.url)||"",urlTj:i?"":((o=t.video)==null?void 0:o.url)||"",descriptionRu:i&&((d=t.video)==null?void 0:d.description)||"",descriptionTj:i?"":((c=t.video)==null?void 0:c.description)||""},text:{bodyRu:i&&((p=t.text)==null?void 0:p.body)||"",bodyTj:i?"":((f=t.text)==null?void 0:f.body)||""},test:{questions:s((h=t.test)==null?void 0:h.questions)},slidesRu:i?t.slides||[]:[],slidesTj:i?[]:t.slides||[]}},M=_.createContext(null),g={},F=t=>{t?delete g[t]:Object.keys(g).forEach(u=>delete g[u])},z=({subjectId:t,children:u})=>{const[i,s]=_.useState(g[t]||null),[a,o]=_.useState(!g[t]);return _.useEffect(()=>{if(g[t]){s(g[t]),o(!1);return}t?(async()=>{o(!0),s(null);try{const c=await P.getStructure(t);if(c)g[t]=c,s(c);else{const p={sections:[]};g[t]=p,s(p)}}catch(c){console.error(`Ошибка загрузки структуры предмета "${t}":`,c);const p={sections:[]};g[t]=p,s(p)}finally{o(!1)}})():o(!1)},[t]),H.jsx(M.Provider,{value:{subjectData:i,loading:a,subjectId:t},children:u})},G=()=>{const t=_.useContext(M);if(t===null)throw new Error("useSyllabus должен использоваться внутри SyllabusProvider");return t};export{A as B,B as F,z as S,F as i,P as s,G as u};
