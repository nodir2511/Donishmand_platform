import{e as ne,r as m,R as ie,j as e,X as ae,C as le}from"./index-DRfO7QNx.js";import{R as ce,r as G}from"./LessonPage-CRuSMgAq.js";import{C as H}from"./check-circle-DbkDMSwU.js";import{L as F}from"./lock-CSFYjScz.js";import{C as oe}from"./chevron-left-DH9hOaJo.js";import{A as de}from"./alert-triangle-BhOJVak3.js";import"./CourseLayout-p4e9S4D6.js";import"./SyllabusContext-x_XbzDWO.js";import"./home-C7kFw3rz.js";import"./katex-BMcjISZR.js";import"./video-GjhmAmWB.js";import"./eye-DijbaegS.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=ne("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),w=p=>{const u=[...p];for(let n=u.length-1;n>0;n--){const y=Math.floor(Math.random()*(n+1));[u[n],u[y]]=[u[y],u[n]]}return u},P=80,ye=({questions:p,lessonId:u,lang:n,onClose:y,onComplete:D})=>{const[h,S]=m.useState(0),[x,L]=m.useState({}),[$,V]=m.useState(!1),[J,Y]=m.useState(0),[I,R]=m.useState(!1),[W,T]=m.useState(""),[E,O]=m.useState(new Set),[U,Z]=m.useState(!0);ie.useEffect(()=>{const t=()=>{const a=document.hasFocus()&&!document.hidden;Z(a)};window.addEventListener("focus",t),window.addEventListener("blur",t),document.addEventListener("visibilitychange",t);const s=setInterval(t,300);return()=>{window.removeEventListener("focus",t),window.removeEventListener("blur",t),document.removeEventListener("visibilitychange",t),clearInterval(s)}},[]);const v=`test_progress_v2_${u}`,g=m.useMemo(()=>{if(!p)return[];const t=localStorage.getItem(v);if(t&&J===0)try{const r=JSON.parse(t);if(!(r.questions&&r.questions.every(c=>c.textRu&&c.textRu.trim().length>0||c.textTj&&c.textTj.trim().length>0)))console.warn("Кэш теста содержит пустые вопросы. Очистка..."),localStorage.removeItem(v);else if(r.questions&&r.answers&&r.locked){L(r.answers),O(new Set(r.locked)),S(r.currentIndex||0);const c=new Set(r.locked),b=r.questions.filter(l=>c.has(l.id)),A=new Set(b.map(l=>l.id)),o=w(p.filter(l=>!A.has(l.id))),j=Math.min(10,p.length)-b.length,N=o.slice(0,Math.max(0,j)).map(l=>l.type==="multiple_choice"?{...l,options:w(l.options)}:l.type==="matching"?{...l,leftItems:w(l.leftItems),rightItems:w(l.rightItems)}:l);return[...b,...N]}}catch(r){console.warn("Ошибка восстановления прогресса теста:",r),localStorage.removeItem(v)}return w(p).slice(0,10).map(r=>r.type==="multiple_choice"?{...r,options:w(r.options)}:r.type==="matching"?{...r,leftItems:w(r.leftItems),rightItems:w(r.rightItems)}:r)},[p,J,v]),i=g[h],k=g.length;m.useEffect(()=>{if(g.length>0&&!$){const t={questions:g,answers:x,locked:[...E],currentIndex:h};localStorage.setItem(v,JSON.stringify(t))}},[x,E,h,g,$]);const _=t=>E.has(t),K=()=>{const t=g[h];if(!t)return;const s=x[t.id];s!=null&&s!==""&&O(a=>new Set([...a,t.id]))},Q=(t,s)=>{_(t)||L(a=>({...a,[t]:s}))},q=()=>{h<k-1&&(K(),S(t=>t+1))},ee=()=>{h>0&&S(t=>t-1)},[f,X]=m.useState(null),C=m.useMemo(()=>g.filter(t=>{const s=x[t.id];return s==null||s===""?!0:t.type==="matching"&&typeof s=="object"?Object.keys(s).length<t.leftItems.length:!1}).length,[x,g]);m.useEffect(()=>{if(I){const t=setTimeout(()=>{R(!1),T("")},3e3);return()=>clearTimeout(t)}},[I]);const te=()=>{if(K(),C>0){R(!0);const o=n==="ru"?`Вы не ответили на ${C} ${C===1?"вопрос":C<5?"вопроса":"вопросов"}!`:`Шумо ба ${C} савол ҷавоб надодаед!`;T(o);return}let t=0;const s=g.map(o=>{const j=x[o.id];let N=!1;if(o.type==="multiple_choice")N=j===o.correctId;else if(o.type==="matching")N=Object.entries(o.correctMatches).every(([l,re])=>(j==null?void 0:j[l])===re);else if(o.type==="numeric"){const l=o.digits.join("");N=j===l}return N&&t++,{question:o,userAnswer:j,isCorrect:N}}),a=Math.round(t/k*100),r=a>=P,d=`test_history_${u}`,c=JSON.parse(localStorage.getItem(d)||"[]"),b={score:a,correct:t,total:k,timestamp:Date.now(),passed:r},A=[...c,b];if(localStorage.setItem(d,JSON.stringify(A)),localStorage.setItem(`test_result_${u}`,JSON.stringify(b)),r){const o=parseInt(localStorage.getItem("user_coins")||"0");localStorage.setItem("user_coins",(o+1).toString())}X({correct:t,total:k,score:a,isPassed:r,details:s}),V(!0),localStorage.removeItem(v)},se=()=>{localStorage.removeItem(v),S(0),L({}),R(!1),T(""),O(new Set),X(null),V(!1),Y(t=>t+1)},B=t=>{const s=n==="tj"&&t.textTj||t.textRu;return G(s||"")},z=t=>{const s=n==="tj"&&t.textTj||t.textRu;return G(s||"")};return!p||p.length===0?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-gaming-card/95 rounded-2xl p-8 text-center max-w-md",children:[e.jsx(M,{size:48,className:"mx-auto mb-4 text-red-400"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:n==="ru"?"Нет вопросов":"Саволе нест"}),e.jsx("p",{className:"text-gaming-textMuted mb-4",children:n==="ru"?"Тест пока не содержит вопросов":"Тест ҳанӯз савол надорад"}),e.jsx("button",{onClick:y,className:"px-6 py-2 bg-gaming-primary text-white rounded-xl",children:n==="ru"?"Закрыть":"Пӯшидан"})]})}):$&&f?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 my-8",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 text-center relative overflow-hidden",children:[f.isPassed?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-green-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-yellow-400 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(250,204,21,0.6)] animate-bounce",children:e.jsx("div",{className:"w-20 h-20 border-4 border-yellow-600 rounded-full flex items-center justify-center bg-yellow-300",children:e.jsx("span",{className:"text-4xl font-bold text-yellow-700",children:"$"})})}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-green-400",children:n==="ru"?"Тест сдан!":"Тест супорида шуд!"}),e.jsx("p",{className:"text-green-300/80 mb-2",children:n==="ru"?"+1 монета в копилку":"+1 танга ба хазина"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(M,{size:64,className:"mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-red-400",children:n==="ru"?"Тест не сдан":"Тест супорида нашуд"}),e.jsx("p",{className:"text-red-300/80 mb-2",children:n==="ru"?`Нужно набрать минимум ${P}%`:`Бояд ҳадди аққал ${P}% гиред`})]})]}),e.jsxs("div",{className:`text-5xl font-bold mb-2 relative z-10 ${f.isPassed?"text-green-400":"text-red-400"}`,children:[f.score,"%"]}),e.jsxs("p",{className:"text-gaming-textMuted relative z-10",children:[f.correct," / ",f.total," ",n==="ru"?"правильных ответов":"ҷавоби дуруст"]})]}),e.jsx("div",{className:"p-6 max-h-[50vh] overflow-y-auto space-y-4",children:f.details.map((t,s)=>e.jsx("div",{className:`p-4 rounded-xl border ${t.isCorrect?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.isCorrect?e.jsx(H,{className:"text-green-400 mt-1",size:20}):e.jsx(M,{className:"text-red-400 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium mb-1 flex gap-1",children:[e.jsxs("span",{children:[s+1,"."]}),e.jsx("div",{dangerouslySetInnerHTML:{__html:B(t.question)},className:"[&>p]:inline [&>p]:m-0"})]}),!t.isCorrect&&t.question.type==="multiple_choice"&&e.jsxs("div",{className:"text-sm text-green-400 flex flex-wrap gap-1",children:[e.jsx("span",{children:n==="ru"?"Правильный ответ: ":"Ҷавоби дуруст: "}),e.jsx("span",{className:"font-semibold",dangerouslySetInnerHTML:{__html:z(t.question.options.find(a=>a.id===t.question.correctId))}})]})]})]})},t.question.id))}),e.jsxs("div",{className:"p-6 border-t border-white/10 flex gap-4 justify-center",children:[e.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20",children:[e.jsx(ce,{size:18}),n==="ru"?"Пройти заново":"Аз нав"]}),f.isPassed&&e.jsxs("button",{onClick:()=>{D&&D(f),y()},className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 shadow-[0_0_15px_rgba(22,163,74,0.5)]",children:[e.jsx(H,{size:18}),n==="ru"?"Забрать награду":"Гирифтани мукофот"]})]})]})}):e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 select-none",onContextMenu:t=>t.preventDefault(),style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"},children:[!U&&e.jsx("div",{className:"fixed inset-0 z-[100] backdrop-blur-3xl flex items-center justify-center bg-black/90 cursor-not-allowed",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(M,{size:64,className:"mx-auto mb-4 text-red-500 animate-pulse"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:n==="ru"?"Вернитесь к тесту!":"Ба тест баргардед!"}),e.jsx("p",{className:"text-white/80",children:n==="ru"?"Контент скрыт при потере фокуса":"Мундариҷа ҳангоми гум кардани фокус пинҳон карда мешавад"})]})}),e.jsxs("div",{className:`w-full max-w-2xl bg-gaming-card/95 rounded-3xl border border-white/10 overflow-hidden relative transition-all duration-300 flex flex-col max-h-[90vh] ${U?"":"opacity-0 pointer-events-none"}`,children:[e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden opacity-[0.03] flex flex-wrap content-center justify-center gap-8 rotate-12 scale-150",children:Array.from({length:20}).map((t,s)=>e.jsx("div",{className:"text-2xl font-black text-white whitespace-nowrap",children:"DONISHMAND PLATFORM"},s))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[n==="ru"?"Вопрос":"Савол"," ",h+1," / ",k]}),e.jsx("div",{className:"flex gap-1",children:g.map((t,s)=>{const a=(()=>{const d=x[t==null?void 0:t.id];return d==null||d===""?!1:(t==null?void 0:t.type)==="matching"&&typeof d=="object"?Object.keys(d).length>=t.leftItems.length:!0})(),r=I&&!a;return e.jsx("button",{onClick:()=>S(s),title:`${n==="ru"?"Вопрос":"Савол"} ${s+1}${a?"":n==="ru"?" (нет ответа)":" (ҷавоб нест)"}`,className:`w-2.5 h-2.5 rounded-full transition-all duration-300 cursor-pointer hover:scale-150 ${s===h?"bg-gaming-primary scale-125":a?"bg-white/60":r?"bg-red-500 animate-pulse scale-125":"bg-white/20 hover:bg-white/40"}`},s)})})]}),e.jsx("button",{onClick:y,className:"p-2 text-gaming-textMuted hover:text-white",children:e.jsx(ae,{size:24})})]}),e.jsxs("div",{className:"p-6 relative z-10 overflow-y-auto flex-1",children:[e.jsx("div",{className:"text-xl font-medium mb-6 prose prose-invert max-w-none [&>p]:inline [&>p]:m-0",dangerouslySetInnerHTML:{__html:B(i)}}),i.image&&e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-white/10 bg-black/20 flex justify-center",children:e.jsx("img",{src:i.image,alt:"Question",className:"max-w-full max-h-[400px] object-contain"})}),i.type==="multiple_choice"&&(()=>{const t=_(i.id);return e.jsxs("div",{className:"space-y-3",children:[t&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg text-sm text-gaming-textMuted",children:[e.jsx(F,{size:14}),e.jsx("span",{children:n==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"})]}),i.options.map((s,a)=>{const r=x[i.id]===s.id;return e.jsxs("button",{onClick:()=>Q(i.id,s.id),disabled:t,className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${r?"bg-gaming-primary/20 border-gaming-primary":t?"bg-white/5 border-white/5 opacity-40 cursor-not-allowed":"bg-white/5 border-white/10 hover:bg-white/10"}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold shrink-0 ${r?"bg-gaming-primary text-white":"bg-white/10"}`,children:String.fromCharCode(65+a)}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:z(s)}}),s.image&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-white/10 bg-black/20 max-w-[200px]",children:e.jsx("img",{src:s.image,alt:"Option",className:"w-full h-auto object-cover"})})]}),r&&t&&e.jsx(F,{size:16,className:"text-gaming-textMuted shrink-0"})]},s.id)})]})})(),i.type==="matching"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 pb-4 border-b border-white/10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-pink uppercase tracking-wider mb-2",children:n==="ru"?"Группа 1":"Гурӯҳи 1"}),i.leftItems.map((t,s)=>e.jsxs("div",{className:"text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"font-bold text-gaming-pink min-w-[20px]",children:[String.fromCharCode(65+s),")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:z(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gaming-accent uppercase tracking-wider mb-2",children:n==="ru"?"Группа 2":"Гурӯҳи 2"}),i.rightItems.map((t,s)=>e.jsxs("div",{className:"text-sm flex gap-2 items-baseline",children:[e.jsxs("span",{className:"font-bold text-gaming-accent min-w-[20px]",children:[s+1,")"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gaming-textMuted leading-tight",dangerouslySetInnerHTML:{__html:z(t)}}),t.image&&e.jsx("img",{src:t.image,alt:"Item",className:"w-24 h-24 object-cover rounded-lg border border-white/10"})]})]},t.id))]})]}),e.jsx("p",{className:"text-sm text-gaming-textMuted text-center",children:n==="ru"?"Выберите соответствия в сетке:":"Мувофиқатро дар ҷадвал интихоб кунед:"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"overflow-x-auto max-w-full pb-2",children:e.jsxs("table",{className:"border-separate border-spacing-1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8"}),i.rightItems.map((t,s)=>e.jsx("th",{className:"text-center font-bold text-gaming-accent text-sm p-1",children:s+1},t.id))]})}),e.jsx("tbody",{children:i.leftItems.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-bold text-gaming-pink text-sm p-1",children:String.fromCharCode(65+s)}),i.rightItems.map(a=>{var c;const r=((c=x[i.id])==null?void 0:c[t.id])===a.id,d=_(i.id);return e.jsx("td",{className:"text-center p-0.5",children:e.jsx("button",{onClick:()=>Q(i.id,{...x[i.id]||{},[t.id]:a.id}),disabled:d,className:`w-8 h-8 rounded-full border-2 transition-all flex items-center justify-center
                                                                        ${r?"bg-gaming-primary border-gaming-primary":d?"bg-white/5 border-white/10 opacity-30 cursor-not-allowed":"bg-white/5 border-white/20 hover:border-white/40"}`,children:r&&e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})},a.id)})]},t.id))})]})})})]}),i.type==="numeric"&&(()=>{const t=_(i.id);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gaming-textMuted",children:t?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(F,{size:14})," ",n==="ru"?"Ответ зафиксирован":"Ҷавоб қайд шуд"]}):n==="ru"?"Введите ответ:":"Ҷавобро ворид кунед:"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[[0,1,2,3].map(s=>e.jsx("input",{type:"text",maxLength:1,disabled:t,value:(x[i.id]||"")[s]||"",onChange:a=>{const r=a.target.value;if(r&&!/^\d$/.test(r))return;const c=(x[i.id]||"").split("");if(c[s]=r,Q(i.id,c.join("")),r&&s<3){const b=a.target.nextElementSibling;b&&b.focus()}},className:`w-14 h-14 text-center text-2xl font-bold rounded-lg text-white focus:outline-none ${t?"bg-gaming-bg/50 border-2 border-gaming-primary/30 opacity-70 cursor-not-allowed":"bg-gaming-bg/50 border-2 border-white/20 focus:border-gaming-primary"}`},s)),i.unit&&e.jsx("span",{className:"text-xl text-gaming-textMuted ml-2",children:i.unit})]})]})})()]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-white/10 relative z-10",children:[h>0?e.jsxs("button",{onClick:ee,className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white hover:bg-white/10",children:[e.jsx(oe,{size:18}),n==="ru"?"Назад":"Қафо"]}):e.jsx("div",{}),h===k-1?e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[I&&W&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-500/20 border border-red-500/40 text-red-400 rounded-xl text-sm animate-bounce",children:[e.jsx(de,{size:16,className:"shrink-0"}),e.jsx("span",{children:W})]}),e.jsxs("button",{onClick:te,className:`flex items-center gap-2 px-6 py-2 rounded-xl transition-all ${I?"bg-red-500/80 text-white animate-[shake_0.5s_ease-in-out]":"bg-gaming-primary text-white hover:bg-gaming-primary/80"}`,children:[e.jsx(H,{size:18}),n==="ru"?"Завершить тест":"Тамом кардан"]})]}):e.jsxs("button",{onClick:q,className:"flex items-center gap-2 px-4 py-2 text-white hover:bg-white/10 rounded-xl",children:[n==="ru"?"Далее":"Оянда",e.jsx(le,{size:18})]})]})]})]})};export{ye as default};
