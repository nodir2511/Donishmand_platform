import{j as e}from"./editor-8tw8cCTw.js";import{f as v,u as N,L as w}from"./vendor-DfgOC3sD.js";import{C as y}from"./CourseLayout-x-mcFUPb.js";import{g as k,a as T}from"./progressHelpers-CJ7J7Gvk.js";import{u as L}from"./SyllabusContext-DSvaRxe3.js";import{u as C}from"./index-YN3naZQP.js";import{u as $,k as M,n as z,F as u,P as A,A as S}from"./ui-DOqj-4Eh.js";import"./supabase-CQnWzhEg.js";const P=({subjectId:o,sectionId:s,topicId:c,isTeacher:d,navigate:x})=>{const{t:i,i18n:h}=$(),r=h.resolvedLanguage||"ru",{subjectData:n,loading:f}=L();if(f)return e.jsx("div",{className:"flex items-center justify-center min-h-[40vh]",children:e.jsx(M,{size:40,className:"text-gaming-primary animate-spin"})});const a=n==null?void 0:n.sections.find(t=>t.id===s),j=(n==null?void 0:n.sections.findIndex(t=>t.id===s))??-1,l=a==null?void 0:a.topics.find(t=>t.id===c),b=(a==null?void 0:a.topics.findIndex(t=>t.id===c))??-1;if(!l)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[40vh] text-white",children:[e.jsx("h2",{className:"text-2xl mb-4",children:i("topicNotFound")}),e.jsx("button",{onClick:()=>x(`/subject/${o}/section/${s}`),className:"text-gaming-primary hover:underline",children:i("backToSection")})]});const g=t=>r==="tj"&&t.titleTj?t.titleTj:t.title;return e.jsxs("div",{className:"max-w-5xl",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2 text-gaming-accent",children:[j+1,".",b+1,". ",g(l)]}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs("button",{onClick:()=>x(`/subject/${o}/section/${s}`),className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-gaming-textMuted hover:text-white transition-all group w-fit",children:[e.jsx(z,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:i("backToSection")})]}),e.jsxs("p",{className:"text-gaming-textMuted",children:[l.lessons.length," ",i("lessonsCount")]})]}),(()=>{const t=k(l.lessons.map(m=>m.id));return t&&!d?e.jsxs("div",{className:"mb-8 p-6 bg-gradient-to-r from-gaming-primary/10 to-gaming-purple/10 rounded-2xl border border-white/5 flex items-center gap-6",children:[e.jsx("div",{className:"p-4 bg-gaming-primary/20 rounded-full text-gaming-primary",children:e.jsx(u,{size:32})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-white mb-1",children:[t.avgErrorRate,"%"]}),e.jsx("div",{className:"text-gaming-textMuted text-sm",children:r==="ru"?"Средний % ошибок по теме":"Миёна % хатогиҳо дар мавзӯъ"}),e.jsx("div",{className:"text-xs text-gaming-textMuted mt-1 opacity-70",children:r==="ru"?`На основе ${t.completedLessons} пройденных уроков`:`Дар асоси ${t.completedLessons} дарсҳои гузашта`})]})]}):null})(),e.jsx("div",{className:"space-y-4",children:l.lessons.map((t,m)=>{const p=T(t.id);return e.jsxs(w,{to:`/lesson/${t.id}`,className:"group flex items-center gap-4 bg-gaming-card/40 backdrop-blur-xl border border-white/5 p-5 rounded-2xl hover:border-gaming-pink/50 transition-all duration-300 hover:bg-gaming-card/60",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gaming-pink/10 flex items-center justify-center text-gaming-pink group-hover:scale-110 transition-transform",children:t.type==="video"?e.jsx(A,{size:24}):e.jsx(u,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-lg font-bold group-hover:text-gaming-pink transition-colors truncate",children:[m+1,". ",g(t)]}),e.jsx("span",{className:"uppercase text-[10px] font-bold bg-white/5 border border-white/10 px-2 py-0.5 rounded text-gaming-textMuted tracking-wider",children:t.type==="video"?"видео":r==="ru"?"текст":"матн"})]}),p&&!d&&e.jsxs("div",{className:"mr-2 text-right",children:[e.jsxs("div",{className:"text-xl font-bold text-white leading-none",children:[p.avgErrorRate,"%"]}),e.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider opacity-70",children:r==="ru"?"ошибок":"хато"})]}),e.jsx(S,{className:"text-white/20 group-hover:text-gaming-pink transition-colors shrink-0"})]},t.id)})})]})},J=()=>{const{subjectId:o,sectionId:s,topicId:c}=v(),d=N(),{isTeacher:x,isAdmin:i}=C();return e.jsx(y,{subjectId:o,children:e.jsx(P,{subjectId:o,sectionId:s,topicId:c,isTeacher:x||i,navigate:d})})};export{J as default};
