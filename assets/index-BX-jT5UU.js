const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SubjectPage-APGjP5LB.js","assets/editor-y_DXvsmM.js","assets/vendor-DfgOC3sD.js","assets/ui-DqTeed5j.js","assets/CourseLayout-Buqr-hqM.js","assets/SyllabusContext-BwXa2ym8.js","assets/supabase-CQnWzhEg.js","assets/SectionPage-MZzUWHx5.js","assets/TopicPage-C0G9mn2N.js","assets/LessonPage-CYrrL5SL.js","assets/katex-G9EdgA5J.js","assets/CreatorPage-Bt3060-v.js","assets/useDebounce-DE7P2URC.js","assets/AdminPage-T0gTL-OU.js","assets/branchService-9HGOuNFW.js","assets/AuthPage-DfBsZXL6.js","assets/ClassesPage-TMC7M-5I.js","assets/ClassDetailsPage-4KXXuIJJ.js","assets/ProfilePage-z_nDuqTW.js","assets/NotFoundPage-BIAaCTtI.js","assets/browser-ponyfill-DPU6vdVN.js"])))=>i.map(i=>d[i]);
import{j as i}from"./editor-y_DXvsmM.js";import{a as Me,r as k,u as Ue,c as ee,L as I,N as Q,R as te,B as $e,d as He,e as P}from"./vendor-DfgOC3sD.js";import{c as ve}from"./supabase-CQnWzhEg.js";import{u as z,S as Se,C as ze,U as Fe,L as ue,X as Be,M as Xe,A as Ve,a as _e,b as Ne,c as K,d as Ge,G as Je,e as We,B as Qe,f as ie,g as Ke,h as qe,i as Ye,j as Ze,k as et,l as tt,m as rt}from"./ui-DqTeed5j.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var oe={},de=Me;oe.createRoot=de.createRoot,oe.hydrateRoot=de.hydrateRoot;const nt="modulepreload",st=function(e){return"/Donishmand_platform/"+e},me={},L=function(r,n,t){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(n.map(d=>{if(d=st(d),d in me)return;me[d]=!0;const p=d.endsWith(".css"),f=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":nt,p||(g.as="script"),g.crossOrigin="",g.href=d,l&&g.setAttribute("nonce",l),document.head.appendChild(g),p)return new Promise((h,y)=>{g.addEventListener("load",h),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&s(l.reason);return r().catch(s)})},ke="https://holeptxxbmpmhlkgzpoa.supabase.co",Te="sb_publishable_p6Y6Ff7daOq0qNRUwD_aWQ_a14jcoFg",R=ve(ke,Te),it={getItem:()=>null,setItem:()=>{},removeItem:()=>{}},gr=ve(ke,Te,{auth:{storageKey:"sb-admin-create-user",storage:it,persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}),Re=k.createContext({}),re=()=>k.useContext(Re),ot=()=>{Object.keys(localStorage).forEach(e=>{e.startsWith("sb-")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("sb-")&&sessionStorage.removeItem(e)})},at=({children:e})=>{var M;const n=(()=>{try{const m=localStorage.getItem("sb-profile-cache");if(m){let w;try{w=JSON.parse(m)}catch(_){return console.warn("⚠️ Ошибка парсинга кеша профиля, кеш будет сброшен",_),localStorage.removeItem("sb-profile-cache"),{user:null,profile:null,permissions:[],loading:!0}}if(Date.now()-w.timestamp<864e5)return{user:{id:w.userId},profile:w.profile,permissions:w.permissions||[],loading:!1}}}catch(m){console.error("Error reading initial cache",m)}return{user:null,profile:null,permissions:[],loading:!0}})(),[t,o]=k.useState(n.user),[s,a]=k.useState(n.profile),[l,d]=k.useState(n.permissions),[p,f]=k.useState(n.loading),g=k.useRef(!1),h=k.useRef(((M=n.user)==null?void 0:M.id)||null),y=async m=>{if(!m)return null;const w=(c,j=5e3)=>Promise.race([c,new Promise((x,v)=>setTimeout(()=>v(new Error("TIMEOUT")),j))]),_=async c=>{let j=[];if((c==null?void 0:c.role)==="teacher"){const{data:x}=await R.from("subject_permissions").select("subject_id, can_edit").eq("user_id",m.id);j=x||[]}d(j);try{c&&localStorage.setItem("sb-profile-cache",JSON.stringify({profile:c,permissions:j,userId:m.id,timestamp:Date.now()}))}catch(x){console.error("Ошибка сохранения кеша:",x)}return c};try{try{let{data:c,error:j}=await w(R.rpc("get_my_profile"),5e3);if(c&&c.length>0?c=c[0]:!j&&(!c||c.length===0)&&(c=null),c&&!j)return await _(c)}catch{}try{const{data:c,error:j}=await w(R.from("profiles").select("*").eq("id",m.id).maybeSingle(),1e4);if(c&&!j)return await _(c);j&&console.error("Ошибка прямого запроса:",j)}catch(c){console.error("Таймаут прямого запроса:",c)}}catch(c){console.error("Ошибка загрузки профиля (Global):",c)}return null};k.useEffect(()=>{let m=!0,w=!1;(async()=>{try{const{data:{session:x}}=await R.auth.getSession();if(x!=null&&x.user){h.current===x.user.id||m&&f(!0),m&&(o(x.user),h.current=x.user.id);const N=await y(x.user);m&&a(N)}else m&&(o(null),h.current=null,a(null),d([]))}catch(x){console.error("Ошибка при инициализации auth:",x)}finally{m&&(w=!0,f(!1))}})();const{data:{subscription:c}}=R.auth.onAuthStateChange(async(x,v)=>{if(!g.current&&m){if(x==="SIGNED_OUT")o(null),h.current=null,a(null),d([]),f(!1);else if((x==="SIGNED_IN"||x==="TOKEN_REFRESHED")&&(v==null?void 0:v.user)&&v.user.id!==h.current){if(w&&h.current===v.user.id)return;f(!0),o(v.user),h.current=v.user.id;const T=await y(v.user);m&&(a(T),f(!1))}}}),j=setTimeout(()=>{m&&f(x=>x&&(console.warn("⚠️ Сработала логика безопасного таймаута"),!1))},1e4);return()=>{m=!1,c.unsubscribe(),clearTimeout(j)}},[]);const b={user:t,profile:s,permissions:l,loading:p,signOut:async()=>{ot(),o(null),a(null);try{await Promise.race([R.auth.signOut(),new Promise(m=>setTimeout(m,2e3))])}catch(m){console.error("SignOut error (ignored):",m)}window.location.href="/Donishmand_platform/"},updateSelectedSubjects:async m=>{if(!t)return!1;try{const{error:w}=await R.from("profiles").update({selected_subjects:m}).eq("id",t.id);if(w)throw w;a(_=>({..._,selected_subjects:m}));try{const _=localStorage.getItem("sb-profile-cache");if(_){const c=JSON.parse(_);c.profile={...c.profile,selected_subjects:m},localStorage.setItem("sb-profile-cache",JSON.stringify(c))}}catch{}return!0}catch(w){return console.error("Ошибка при обновлении выбранных предметов:",w),!1}},isAuthenticated:!!t,isTeacher:(s==null?void 0:s.role)==="teacher",isAdmin:(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="super_admin",isSuperAdmin:(s==null?void 0:s.role)==="super_admin",setSkipAuthChange:m=>{g.current=m},canEditSubject:m=>(s==null?void 0:s.role)==="super_admin"?!0:(s==null?void 0:s.role)==="teacher"?l.some(w=>w.subject_id===m&&w.can_edit):!1,canViewSubject:m=>(s==null?void 0:s.role)==="super_admin"||(s==null?void 0:s.role)==="admin"?!0:(s==null?void 0:s.role)==="teacher"?(s==null?void 0:s.subject)===m:!0};return i.jsx(Re.Provider,{value:b,children:e})},lt=()=>{var _;const{t:e,i18n:r}=z(),{user:n,profile:t,signOut:o,permissions:s}=re(),a=Ue(),l=ee(),[d,p]=k.useState(!1),[f,g]=k.useState(!1),[h,y]=k.useState(!1),u=k.useRef(null);k.useEffect(()=>{const c=()=>g(window.scrollY>20);window.addEventListener("scroll",c);const j=x=>{u.current&&!u.current.contains(x.target)&&y(!1)};return document.addEventListener("mousedown",j),()=>{window.removeEventListener("scroll",c),document.removeEventListener("mousedown",j)}},[]);const S=()=>{const c=r.resolvedLanguage==="ru"?"tj":"ru";r.changeLanguage(c)},b=async()=>{await o(),a("/"),y(!1),p(!1)},M=r.resolvedLanguage||"ru",m=t!=null&&t.full_name?t.full_name.split(" ").map(c=>c[0]).join("").substring(0,2).toUpperCase():((_=n==null?void 0:n.email)==null?void 0:_[0].toUpperCase())||"U",w=c=>{switch(c){case"super_admin":return e("profilePage.roleSuperAdmin");case"admin":return e("profilePage.roleAdmin");case"teacher":return e("profilePage.roleTeacher");default:return e("studentRole")}};return i.jsxs("nav",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${f?"bg-gaming-bg/80 backdrop-blur-xl border-b border-white/5 py-3":"bg-transparent py-6"}`,children:[i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs(I,{to:"/",className:"flex items-center gap-3 group cursor-pointer",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-gaming-primary to-gaming-pink rounded-xl flex items-center justify-center shadow-lg shadow-gaming-primary/20 group-hover:scale-105 transition-transform duration-300",children:i.jsx(Se,{className:"text-white w-6 h-6"})}),i.jsx("span",{className:"font-bold text-2xl tracking-tight text-white group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-white group-hover:to-gaming-primary/80 transition-all",children:"Donishmand"})]}),i.jsxs("div",{className:"hidden md:flex items-center bg-white/5 backdrop-blur-md rounded-full border border-white/5 p-1.5 shadow-sm",children:[i.jsxs("button",{onClick:()=>{var c;l.pathname!=="/"?a({pathname:"/",hash:"#courses-section"}):(c=document.getElementById("courses-section"))==null||c.scrollIntoView({behavior:"smooth"})},className:"px-5 py-2 text-sm font-medium text-gaming-textMuted hover:text-white transition-colors relative group",children:[e("navCourses"),i.jsx("span",{className:"absolute bottom-1 left-1/2 w-0 h-0.5 bg-gaming-accent -translate-x-1/2 group-hover:w-1/2 transition-all duration-300"})]}),i.jsxs(I,{to:"/",className:"px-5 py-2 text-sm font-medium text-gaming-textMuted hover:text-white transition-colors relative group",children:[e("navAbout"),i.jsx("span",{className:"absolute bottom-1 left-1/2 w-0 h-0.5 bg-gaming-accent -translate-x-1/2 group-hover:w-1/2 transition-all duration-300"})]}),n&&i.jsxs(I,{to:"/classes",className:"px-5 py-2 text-sm font-medium text-gaming-textMuted hover:text-white transition-colors relative group border-l border-white/10 ml-2 pl-6",children:[(t==null?void 0:t.role)==="student"?"Мои классы":"Классы",i.jsx("span",{className:"absolute bottom-1 left-1/2 w-0 h-0.5 bg-gaming-purple -translate-x-1/2 group-hover:w-1/2 transition-all duration-300"})]}),((t==null?void 0:t.role)==="super_admin"||(t==null?void 0:t.role)==="teacher"&&(s==null?void 0:s.some(c=>c.can_edit)))&&i.jsxs(I,{to:"/creator",className:"px-5 py-2 text-sm font-medium text-gaming-textMuted hover:text-white transition-colors relative group",children:[e("navCreator"),i.jsx("span",{className:"absolute bottom-1 left-1/2 w-0 h-0.5 bg-gaming-accent -translate-x-1/2 group-hover:w-1/2 transition-all duration-300"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="super_admin")&&i.jsxs(I,{to:"/admin",className:"px-5 py-2 text-sm font-medium text-gaming-textMuted hover:text-white transition-colors relative group",children:[e("navAdmin"),i.jsx("span",{className:"absolute bottom-1 left-1/2 w-0 h-0.5 bg-red-500 -translate-x-1/2 group-hover:w-1/2 transition-all duration-300"})]}),i.jsx("div",{className:"w-px h-4 bg-white/10 mx-2"}),i.jsx("button",{onClick:S,className:"px-3 py-1.5 text-xs font-bold bg-white/5 rounded-full text-white hover:bg-gaming-primary hover:text-white transition-colors uppercase ring-1 ring-white/10",children:M})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"hidden md:block",children:n?i.jsxs("div",{className:"relative",ref:u,children:[i.jsxs("button",{onClick:()=>y(!h),className:"flex items-center gap-3 pl-1 pr-3 py-1 bg-white/5 hover:bg-white/10 border border-white/5 rounded-full transition-all group",children:[i.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-gaming-primary to-gaming-purple flex items-center justify-center text-white font-bold text-sm shadow-inner",children:m}),i.jsxs("div",{className:"text-left hidden lg:block",children:[i.jsx("div",{className:"text-xs font-bold text-white leading-none mb-0.5",children:(t==null?void 0:t.full_name)||n.email}),i.jsx("div",{className:"text-[10px] text-gaming-textMuted uppercase tracking-wider leading-none",children:w(t==null?void 0:t.role)})]}),i.jsx(ze,{size:14,className:`text-gaming-textMuted transition-transform ${h?"rotate-180":""}`})]}),h&&i.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-gaming-card border border-white/10 rounded-xl shadow-2xl py-2 animate-fade-in-up origin-top-right backdrop-blur-xl",children:[i.jsxs("div",{className:"px-4 py-3 border-b border-white/5 lg:hidden",children:[i.jsx("p",{className:"text-sm font-bold text-white truncate",children:(t==null?void 0:t.full_name)||n.email}),i.jsx("p",{className:"text-xs text-gaming-textMuted mt-0.5 uppercase tracking-wider",children:w(t==null?void 0:t.role)})]}),i.jsxs("div",{className:"py-1",children:[i.jsxs("button",{onClick:()=>{a("/profile"),y(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-gaming-textMuted hover:text-white hover:bg-white/5 flex items-center gap-2 transition-colors",children:[i.jsx(Fe,{size:16}),e("profile")]}),i.jsxs("button",{onClick:b,className:"w-full text-left px-4 py-2.5 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 flex items-center gap-2 transition-colors",children:[i.jsx(ue,{size:16}),e("logout")]})]})]})]}):i.jsx(I,{to:"/login",className:"bg-gradient-to-r from-gaming-primary to-gaming-pink text-white px-6 py-2.5 rounded-full font-medium text-sm transition-all shadow-lg shadow-gaming-primary/25 hover:shadow-gaming-pink/25 hover:scale-105 active:scale-95 inline-block",children:e("navLogin")})}),i.jsx("button",{onClick:()=>p(!d),className:"md:hidden p-2 text-white hover:bg-white/10 rounded-lg transition-colors",children:d?i.jsx(Be,{}):i.jsx(Xe,{})})]})]})}),d&&i.jsx("div",{className:"absolute top-full left-0 right-0 bg-gaming-card border-b border-white/5 p-4 shadow-xl md:hidden glass-panel",children:i.jsxs("div",{className:"flex flex-col gap-4",children:[n&&i.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-white/5 rounded-xl border border-white/5",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gaming-primary to-gaming-purple flex items-center justify-center text-white font-bold shadow-inner",children:m}),i.jsxs("div",{className:"overflow-hidden",children:[i.jsx("div",{className:"font-bold text-white truncate",children:(t==null?void 0:t.full_name)||n.email}),i.jsx("div",{className:"text-xs text-gaming-textMuted uppercase tracking-wider",children:w(t==null?void 0:t.role)})]})]}),i.jsx("button",{onClick:()=>{var c;p(!1),l.pathname!=="/"?a({pathname:"/",hash:"#courses-section"}):(c=document.getElementById("courses-section"))==null||c.scrollIntoView({behavior:"smooth"})},className:"text-left font-medium text-white/80 hover:text-white px-4 py-2 hover:bg-white/5 rounded-lg transition-colors",children:e("navCourses")}),i.jsx(I,{to:"/",onClick:()=>p(!1),className:"font-medium text-white/80 hover:text-white px-4 py-2 hover:bg-white/5 rounded-lg transition-colors",children:e("navAbout")}),n&&i.jsx(I,{to:"/classes",onClick:()=>p(!1),className:"font-medium text-white/80 hover:text-white px-4 py-2 hover:bg-white/5 rounded-lg transition-colors border-l-2 border-gaming-purple ml-2",children:(t==null?void 0:t.role)==="student"?"Мои классы":"Классы"}),((t==null?void 0:t.role)==="super_admin"||(t==null?void 0:t.role)==="teacher"&&(s==null?void 0:s.some(c=>c.can_edit)))&&i.jsx(I,{to:"/creator",onClick:()=>p(!1),className:"font-medium text-white/80 hover:text-white px-4 py-2 hover:bg-white/5 rounded-lg transition-colors",children:e("navCreator")}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="super_admin")&&i.jsx(I,{to:"/admin",onClick:()=>p(!1),className:"font-medium text-white/80 hover:text-white px-4 py-2 hover:bg-white/5 rounded-lg transition-colors",children:e("navAdmin")}),i.jsxs("div",{className:"border-t border-white/5 pt-4 flex items-center justify-between px-4",children:[i.jsx("button",{onClick:S,className:"px-3 py-1 bg-white/5 text-white rounded-md text-xs font-bold uppercase ring-1 ring-white/10",children:M}),n?i.jsxs("button",{onClick:b,className:"text-sm font-medium text-red-400 flex items-center gap-2",children:[i.jsx(ue,{size:16}),e("logout")]}):i.jsx(I,{to:"/login",onClick:()=>p(!1),className:"text-sm font-medium text-gaming-primary",children:e("navLogin")})]})]})})]})},ct=()=>{const{t:e}=z();return i.jsxs("footer",{className:"relative bg-gaming-bg border-t border-white/5 py-12 mt-20",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gaming-primary/5 to-transparent pointer-events-none"}),i.jsx("div",{className:"max-w-7xl mx-auto px-4 text-center relative z-10",children:i.jsx("p",{className:"text-gaming-textMuted text-sm font-medium",children:e("footerText")})})]})},ut=()=>{const{t:e}=z();return i.jsxs("div",{className:"relative w-full overflow-hidden pt-36 pb-20 lg:pt-48 lg:pb-32",children:[i.jsx("div",{className:"absolute top-0 right-0 w-[800px] h-[800px] bg-gaming-primary/20 rounded-full blur-[150px] pointer-events-none translate-x-1/3 -translate-y-1/3 animate-pulse-slow"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-[600px] h-[600px] bg-gaming-pink/10 rounded-full blur-[120px] pointer-events-none -translate-x-1/3 translate-y-1/3 animate-pulse-slow"}),i.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center z-10",children:[i.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-md shadow-sm text-gaming-accent text-sm font-medium mb-8 animate-fade-in-up",children:[i.jsx(Se,{size:16,className:"text-gaming-gold"}),i.jsx("span",{className:"tracking-wide uppercase text-[11px] font-bold",children:e("badge")})]}),i.jsx("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 tracking-tight leading-[1.1] animate-fade-in-up delay-[100ms] drop-shadow-2xl",children:i.jsx("span",{dangerouslySetInnerHTML:{__html:e("heroTitle")}})}),i.jsx("p",{className:"text-lg md:text-xl text-gaming-textMuted mb-12 max-w-2xl mx-auto leading-relaxed animate-fade-in-up delay-[200ms]",children:e("heroSubtitle")}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-5 justify-center items-center w-full animate-fade-in-up delay-[300ms]",children:[i.jsxs("button",{onClick:()=>{var r;return(r=document.getElementById("courses-section"))==null?void 0:r.scrollIntoView({behavior:"smooth"})},className:"group relative bg-gaming-primary hover:bg-gaming-primary/90 text-white px-8 py-4 rounded-2xl font-bold transition-all active:scale-95 shadow-lg shadow-gaming-primary/25 flex items-center justify-center gap-2 text-lg overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"}),i.jsx("span",{children:e("ctaStart")}),i.jsx(Ve,{size:20,className:"text-gaming-gold group-hover:translate-x-1 transition-transform"})]}),i.jsx("button",{onClick:()=>{var r;return(r=document.getElementById("courses-section"))==null?void 0:r.scrollIntoView({behavior:"smooth"})},className:"group bg-transparent hover:bg-white/5 text-white border border-white/10 px-8 py-4 rounded-2xl font-bold transition-all active:scale-95 flex items-center justify-center gap-2 text-lg backdrop-blur-sm",children:e("ctaCatalog")})]}),i.jsx("div",{className:"absolute top-1/2 left-10 hidden lg:block animate-float opacity-30",children:i.jsx(_e,{size:80,className:"text-gaming-accent rotate-12 drop-shadow-[0_0_15px_rgba(0,224,255,0.5)]"})}),i.jsx("div",{className:"absolute top-1/3 right-10 hidden lg:block animate-float opacity-30",style:{animationDelay:"2s"},children:i.jsx(Ne,{size:80,className:"text-gaming-pink -rotate-12 drop-shadow-[0_0_15px_rgba(255,73,219,0.5)]"})})]})]})},ce={"tj-lang":{color:"text-gaming-pink",bg:"bg-gaming-pink/10",icon:ie},lit:{color:"text-gaming-pink",bg:"bg-gaming-pink/10",icon:ie},math:{color:"text-gaming-primary",bg:"bg-gaming-primary/10",icon:_e},phys:{color:"text-gaming-accent",bg:"bg-gaming-accent/10",icon:Ne},chem:{color:"text-gaming-primary",bg:"bg-gaming-primary/10",icon:Qe},bio:{color:"text-gaming-gold",bg:"bg-gaming-gold/10",icon:We},geo:{color:"text-gaming-gold",bg:"bg-gaming-gold/10",icon:Je},hist:{color:"text-gaming-text",bg:"bg-gaming-text/10",icon:Ge},eng:{color:"text-gaming-accent",bg:"bg-gaming-accent/10",icon:K},ger:{color:"text-gaming-text",bg:"bg-gaming-text/10",icon:K},fra:{color:"text-gaming-pink",bg:"bg-gaming-pink/10",icon:K},ara:{color:"text-gaming-primary",bg:"bg-gaming-primary/10",icon:K}},Oe={"tj-lang":{ru:"Таджикский язык",tj:"Забони Тоҷикӣ"},math:{ru:"Математика",tj:"Математика"},phys:{ru:"Физика",tj:"Физика"},chem:{ru:"Химия",tj:"Химия"},geo:{ru:"География",tj:"География"},hist:{ru:"История",tj:"Таърих"},lit:{ru:"Литература",tj:"Адабиёт"},bio:{ru:"Биология",tj:"Биология"},eng:{ru:"Английский",tj:"Забони Англисӣ"},ger:{ru:"Немецкий",tj:"Забони Немисӣ"},fra:{ru:"Французский",tj:"Забони Франсавӣ"},ara:{ru:"Арабский",tj:"Забони Арабӣ"}},q=[{id:1,titleRu:"Естественный и тех.",titleTj:"Табиӣ ва техникӣ",subjects:["tj-lang","math","phys","chem"]},{id:2,titleRu:"Экономика и Гео.",titleTj:"Иқтисод ва География",subjects:["tj-lang","math","geo","eng","fra","ger","ara"]},{id:3,titleRu:"Филология и Искусство",titleTj:"Филология ва Санъат",subjects:["tj-lang","hist","lit","eng","fra","ger","ara"]},{id:4,titleRu:"Общество и Право",titleTj:"Ҷомеашиносӣ ва Ҳуқуқ",subjects:["tj-lang","hist","eng","fra","ger","ara"]},{id:5,titleRu:"Медицина и Биология",titleTj:"Тиб ва Биология",subjects:["tj-lang","bio","chem","phys"]}],Y=Object.keys(ce),dt=({subjectId:e,progress:r=0})=>{const{i18n:n}=z(),t=n.resolvedLanguage||"ru",o=ce[e],s=Oe[e][t],a=o.icon;return i.jsxs(I,{to:`/subject/${e}`,className:"block group relative bg-gaming-card rounded-3xl p-6 border border-white/5 hover:border-gaming-primary/30 shadow-lg shadow-black/20 hover:shadow-gaming-primary/10 transition-all duration-500 hover:-translate-y-2 cursor-pointer overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gaming-primary/0 via-gaming-primary/0 to-gaming-primary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),i.jsxs("div",{className:"relative z-10 flex items-start justify-between mb-6",children:[i.jsx("div",{className:`w-14 h-14 rounded-2xl ${o.bg} flex items-center justify-center group-hover:scale-110 transition-transform duration-300 ring-1 ring-white/5`,children:i.jsx(a,{size:28,className:o.color})}),i.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white/40 group-hover:bg-gaming-primary group-hover:text-white transition-all duration-300",children:i.jsx(Ke,{size:16})})]}),i.jsx("h3",{className:"relative z-10 text-xl font-bold text-white mb-4 leading-tight group-hover:text-gaming-accent transition-colors",children:s}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[i.jsx("span",{className:"text-xs text-gaming-textMuted",children:r>0?"Прогресс":""}),r>0&&i.jsxs("span",{className:"text-xs font-bold text-gaming-primary",children:[r,"%"]})]}),i.jsx("div",{className:"w-full h-1.5 bg-white/5 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-gradient-to-r from-gaming-primary to-gaming-pink rounded-full transition-all duration-1000 ease-out",style:{width:`${r}%`}})})]})]})},mt=({activeClusterId:e,setActiveClusterId:r})=>{const{t:n,i18n:t}=z(),o=t.resolvedLanguage||"ru";return i.jsx("div",{id:"courses-section",className:"sticky top-20 z-30 transition-all mt-8",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4",children:i.jsx("div",{className:"glass-panel rounded-2xl p-2 overflow-x-auto no-scrollbar",children:i.jsxs("div",{className:"flex space-x-1 min-w-max",children:[i.jsxs("button",{onClick:()=>r(0),className:`
                px-4 py-2.5 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border
                ${e===0?"bg-gaming-card border-gaming-primary/50 text-white shadow-lg shadow-gaming-primary/10":"border-transparent text-gaming-textMuted hover:text-white hover:bg-white/5"}
              `,children:[i.jsx(qe,{size:18,className:e===0?"text-gaming-accent":""}),n("allSubjects")]}),i.jsx("div",{className:"w-px h-8 bg-white/10 mx-2 self-center"}),q.map(s=>i.jsxs("button",{onClick:()=>r(s.id),className:`
                  px-4 py-2.5 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border
                  ${e===s.id?"bg-gaming-card border-gaming-primary/50 text-white shadow-lg shadow-gaming-primary/10":"border-transparent text-gaming-textMuted hover:text-white hover:bg-white/5"}
                `,children:[i.jsx("span",{className:`
                  flex items-center justify-center w-5 h-5 rounded-md text-[10px] font-bold transition-colors
                  ${e===s.id?"bg-gaming-primary text-white":"bg-white/10 text-white/50"}
                `,children:s.id}),o==="ru"?s.titleRu:s.titleTj]},s.id))]})})})})},gt=()=>{const{i18n:e}=z(),{updateSelectedSubjects:r,profile:n}=re(),[t,o]=k.useState([]),[s,a]=k.useState(!1),l=e.resolvedLanguage||"ru",d=f=>{o(g=>g.includes(f)?g.filter(h=>h!==f):[...g,f])},p=async()=>{t.length!==0&&(a(!0),await r(t),a(!1))};return i.jsxs("div",{className:"min-h-[80vh] flex flex-col items-center justify-center p-6 text-center animate-fade-in",children:[i.jsx("div",{className:"w-16 h-16 rounded-full bg-gaming-primary/20 flex items-center justify-center mb-6 ring-2 ring-gaming-primary/50 shadow-lg shadow-gaming-primary/30",children:i.jsx(ie,{className:"text-gaming-primary w-8 h-8"})}),i.jsxs("h1",{className:"text-4xl md:text-5xl font-heading font-bold text-white mb-4 drop-shadow-lg",children:["Добро пожаловать, ",(n==null?void 0:n.full_name)||"Ученик","!"]}),i.jsx("p",{className:"text-xl text-gray-300 mb-12 max-w-2xl",children:"Давайте настроим платформу под вас. Выберите предметы, которые вы планируете изучать:"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 w-full max-w-5xl mb-12",children:Y.map(f=>{var u;const g=ce[f];if(!g)return null;const h=g.icon,y=t.includes(f);return i.jsxs("div",{onClick:()=>d(f),className:`relative cursor-pointer rounded-2xl p-6 flex flex-col items-center gap-4 transition-all duration-300 border-2
                                ${y?"bg-gaming-card/80 border-gaming-primary shadow-lg shadow-gaming-primary/20 scale-105":"bg-black/30 border-white/5 hover:bg-white/5 hover:border-white/20"}
                            `,children:[i.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center transition-transform ${y?"scale-110":""} ${g.bg}`,children:i.jsx(h,{size:28,className:g.color})}),i.jsx("span",{className:"font-medium text-white text-center",children:((u=Oe[f])==null?void 0:u[l])||f}),i.jsx("div",{className:`absolute top-4 right-4 transition-all duration-300 ${y?"opacity-100 transform scale-100":"opacity-0 transform scale-50"}`,children:i.jsx(Ye,{className:"text-gaming-primary w-6 h-6"})})]},f)})}),i.jsx("button",{onClick:p,disabled:t.length===0||s,className:`
                    px-12 py-4 rounded-xl font-bold text-lg flex items-center gap-3 transition-all duration-300 shadow-xl
                    ${t.length>0?"bg-gaming-primary text-white hover:bg-gaming-primary-hover hover:scale-105 shadow-gaming-primary/30":"bg-white/5 text-gray-500 cursor-not-allowed border border-white/5"}
                `,children:s?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Сохранение..."]}):i.jsxs(i.Fragment,{children:["Продолжить ",i.jsx(Ze,{size:20})]})}),i.jsx("p",{className:"mt-4 text-sm text-gray-500 max-w-md",children:"В будущем вы сможете добавить или изменить список предметов через администратора."})]})},ft=e=>{var o,s,a,l,d,p,f;if(!e)return{contentRu:null,contentTj:null};const r=g=>{if(!g||!Array.isArray(g))return{ru:[],tj:[]};const h=g.map(u=>{const S={id:u.id,type:u.type,image:u.imageRu||u.image};return S.text=u.textRu||"",u.type==="multiple_choice"?(S.options=(u.options||[]).map(b=>({id:b.id,text:b.textRu||"",image:b.imageRu||b.image})),S.correctId=u.correctId):u.type==="matching"?(S.leftItems=(u.leftItems||[]).map(b=>({id:b.id,text:b.textRu||"",image:b.imageRu||b.image})),S.rightItems=(u.rightItems||[]).map(b=>({id:b.id,text:b.textRu||"",image:b.imageRu||b.image})),S.correctMatches=u.correctMatches):u.type==="numeric"&&(S.digits=u.digits,S.unit=u.unit),S}),y=g.map(u=>{const S={id:u.id,type:u.type,image:u.imageTj||u.imageRu||u.image};return S.text=u.textTj||"",u.type==="multiple_choice"?(S.options=(u.options||[]).map(b=>({id:b.id,text:b.textTj||"",image:b.imageTj||b.imageRu||b.image})),S.correctId=u.correctId):u.type==="matching"?(S.leftItems=(u.leftItems||[]).map(b=>({id:b.id,text:b.textTj||"",image:b.imageTj||b.imageRu||b.image})),S.rightItems=(u.rightItems||[]).map(b=>({id:b.id,text:b.textTj||"",image:b.imageTj||b.imageRu||b.image})),S.correctMatches=u.correctMatches):u.type==="numeric"&&(S.digits=u.digits,S.unit=u.unit),S});return{ru:h,tj:y}},{ru:n,tj:t}=r((o=e.test)==null?void 0:o.questions);return{contentRu:{video:{url:((s=e.video)==null?void 0:s.url)||"",description:((a=e.video)==null?void 0:a.descriptionRu)||""},text:{body:((l=e.text)==null?void 0:l.bodyRu)||""},test:{questions:n},slides:e.slidesRu||[]},contentTj:{video:{url:((d=e.video)==null?void 0:d.urlTj)||"",description:((p=e.video)==null?void 0:p.descriptionTj)||""},text:{body:((f=e.text)==null?void 0:f.bodyTj)||""},test:{questions:t},slides:e.slidesTj||[]}}},ht=(e,r)=>{var p,f,g,h,y,u,S,b,M,m,w,_;const n=c=>c?c.toString().replace(/<[^>]*>?/gm,"").replace(/&nbsp;/g," ").trim():"",t=c=>{const j=n(c);return j!==""&&/^\d+$/.test(j)},o=c=>{if(!c)return"";const j=[c.question,c.text,c.title];for(const x of j)if(x&&!t(x))return x;return""},s=c=>!c||!Array.isArray(c)?c:c.map(j=>{const x={...j};if(x.textRu||(x.textRu=o(j)),!x.textTj){const v=[j.textTj,j.question,j.text,j.title];for(const N of v)if(N&&!t(N)&&N!==x.textRu){x.textTj=N;break}}return x.options&&(x.options=x.options.map(v=>({...v,textRu:v.textRu?v.textRu:o(v),textTj:v.textTj||""}))),x.leftItems&&(x.leftItems=x.leftItems.map(v=>({...v,textRu:v.textRu?v.textRu:o(v),textTj:v.textTj||""}))),x.rightItems&&(x.rightItems=x.rightItems.map(v=>({...v,textRu:v.textRu?v.textRu:o(v),textTj:v.textTj||""}))),x});if(e&&(e.slidesRu||(p=e.text)!=null&&p.bodyRu))return(f=e.test)!=null&&f.questions?{...e,test:{...e.test,questions:s(e.test.questions)}}:e;const a=e||{},l=r||{};console.log("[DEBUG mergeContent] ru.test?.questions:",JSON.stringify((g=a.test)==null?void 0:g.questions,null,2)),console.log("[DEBUG mergeContent] tj.test?.questions:",JSON.stringify((h=l.test)==null?void 0:h.questions,null,2));const d=(c,j)=>{const x=c||[],v=j||[];return x.map((N,T)=>{const C=v[T]||{},E={id:N.id,type:N.type,imageRu:N.image,imageTj:C.image,textRu:N.text||"",textTj:C.text||""};return N.type==="multiple_choice"?(E.options=(N.options||[]).map((O,$)=>{var U;const A=((U=C.options)==null?void 0:U[$])||{};return{id:O.id,imageRu:O.image,imageTj:A.image,textRu:O.text||"",textTj:A.text||""}}),E.correctId=N.correctId):N.type==="matching"?(E.leftItems=(N.leftItems||[]).map((O,$)=>{var U;const A=((U=C.leftItems)==null?void 0:U[$])||{};return{id:O.id,imageRu:O.image,imageTj:A.image,textRu:O.text||"",textTj:A.text||""}}),E.rightItems=(N.rightItems||[]).map((O,$)=>{var U;const A=((U=C.rightItems)==null?void 0:U[$])||{};return{id:O.id,imageRu:O.image,imageTj:A.image,textRu:O.text||"",textTj:A.text||""}}),E.correctMatches=N.correctMatches):N.type==="numeric"&&(E.digits=N.digits,E.unit=N.unit),E})};return{video:{url:((y=a.video)==null?void 0:y.url)||"",urlTj:((u=l.video)==null?void 0:u.url)||"",descriptionRu:((S=a.video)==null?void 0:S.description)||"",descriptionTj:((b=l.video)==null?void 0:b.description)||""},text:{bodyRu:((M=a.text)==null?void 0:M.body)||"",bodyTj:((m=l.text)==null?void 0:m.body)||""},test:{questions:d((w=a.test)==null?void 0:w.questions,(_=l.test)==null?void 0:_.questions)},slidesRu:a.slides||[],slidesTj:l.slides||[]}},B={structures:{},lessons:{}},pt={invalidateCache(e){e?delete B.structures[e]:(B.structures={},B.lessons={})},async saveStructure(e,r){const n=r.sections.map(o=>({id:o.id,title:o.title,titleTj:o.titleTj,topics:o.topics.map(s=>({id:s.id,title:s.title,titleTj:s.titleTj,lessons:s.lessons.map(a=>({id:a.id,title:a.title,titleTj:a.titleTj,type:a.type}))}))})),{error:t}=await R.from("subject_syllabus").upsert({subject:e,data:{sections:n},updated_at:new Date},{onConflict:"subject"});if(t)throw console.error("Ошибка сохранения структуры:",t),t;return!0},async getStructure(e){if(!e||e==="undefined"||e==="null")return null;if(B.structures[e])return B.structures[e];const{data:r,error:n}=await R.from("subject_syllabus").select("data").eq("subject",e).maybeSingle();if(n)throw n;return r?(B.structures[e]=r.data,r.data):null},async saveLesson(e,r){const{contentRu:n,contentTj:t}=ft(e.content),o=l=>Array.isArray(l)?l.map(o):l instanceof Date?l:l!==null&&typeof l=="object"?Object.fromEntries(Object.entries(l).filter(([d,p])=>p!==void 0).map(([d,p])=>[d,o(p)])):l,s=o({id:e.id,title_ru:e.title,title_tj:e.titleTj,subject:r,content_ru:n,content_tj:t,is_published:!0,updated_at:new Date}),{error:a}=await R.from("lessons").upsert(s,{onConflict:"id"});if(a)throw a;return!0},async deleteLesson(e){const{error:r}=await R.from("lessons").delete().eq("id",e);if(r)throw r;return!0},async deleteLessons(e){if(!e||e.length===0)return!0;const{error:r}=await R.from("lessons").delete().in("id",e);if(r)throw r;return!0},async getLesson(e,r=null){var a;const n=r==="ru"?"id, title_ru, title_tj, subject, content_ru":r==="tj"?"id, title_ru, title_tj, subject, content_tj":"*",{data:t,error:o}=await R.from("lessons").select(n).eq("id",e).single();if(o){if(o.code==="PGRST116")return null;throw o}let s;if(r){const l=r==="ru"?t.content_ru:t.content_tj;l&&(l.slidesRu||(a=l.text)!=null&&a.bodyRu)?s=l:s=xt(l,r)}else s=ht(t.content_ru,t.content_tj);return{id:t.id,title:t.title_ru,titleTj:t.title_tj,content:s,subject:t.subject}}},xt=(e,r)=>{var o,s,a,l,d,p,f;if(!e)return{video:{url:"",urlTj:"",descriptionRu:"",descriptionTj:""},text:{bodyRu:"",bodyTj:""},test:{questions:[]},slidesRu:[],slidesTj:[]};const n=r==="ru",t=g=>(g||[]).map(h=>{const y={id:h.id,type:h.type,imageRu:n&&h.image||null,imageTj:n?null:h.image||null,textRu:n&&h.text||"",textTj:n?"":h.text||""};return h.type==="multiple_choice"?(y.options=(h.options||[]).map(u=>({id:u.id,imageRu:n&&u.image||null,imageTj:n?null:u.image||null,textRu:n&&u.text||"",textTj:n?"":u.text||""})),y.correctId=h.correctId):h.type==="matching"?(y.leftItems=(h.leftItems||[]).map(u=>({id:u.id,imageRu:n&&u.image||null,imageTj:n?null:u.image||null,textRu:n&&u.text||"",textTj:n?"":u.text||""})),y.rightItems=(h.rightItems||[]).map(u=>({id:u.id,imageRu:n&&u.image||null,imageTj:n?null:u.image||null,textRu:n&&u.text||"",textTj:n?"":u.text||""})),y.correctMatches=h.correctMatches):h.type==="numeric"&&(y.digits=h.digits,y.unit=h.unit),y});return{video:{url:n&&((o=e.video)==null?void 0:o.url)||"",urlTj:n?"":((s=e.video)==null?void 0:s.url)||"",descriptionRu:n&&((a=e.video)==null?void 0:a.description)||"",descriptionTj:n?"":((l=e.video)==null?void 0:l.description)||""},text:{bodyRu:n&&((d=e.text)==null?void 0:d.body)||"",bodyTj:n?"":((p=e.text)==null?void 0:p.body)||""},test:{questions:t((f=e.test)==null?void 0:f.questions)},slidesRu:n?e.slides||[]:[],slidesTj:n?[]:e.slides||[]}},ne="donishmand_subject_progress",bt=()=>{const{t:e,i18n:r}=z(),[n,t]=k.useState(0),o=r.resolvedLanguage||"ru",{profile:s}=re(),a=ee(),[l,d]=k.useState(()=>{try{const m=localStorage.getItem(ne);return m?JSON.parse(m):{}}catch{return{}}});k.useEffect(()=>{a.hash==="#courses-section"&&setTimeout(()=>{var m;(m=document.getElementById("courses-section"))==null||m.scrollIntoView({behavior:"smooth"})},100)},[a]),k.useEffect(()=>{if(!s)return;let m=!1;return(async()=>{try{const{data:{user:_}}=await R.auth.getUser();if(!(_!=null&&_.id)||m)return;const[c,j]=await Promise.all([R.from("user_lesson_progress").select("lesson_id").eq("user_id",_.id),R.from("user_test_results").select("lesson_id").eq("user_id",_.id)]);c.error&&console.warn("Ошибка загрузки lesson_progress:",c.error),j.error&&console.warn("Ошибка загрузки test_results:",j.error);const x=new Set;if(c.data&&c.data.forEach(T=>x.add(T.lesson_id)),j.data&&j.data.forEach(T=>x.add(T.lesson_id)),m)return;if(x.size===0){const T={};d(T),localStorage.setItem(ne,JSON.stringify(T));return}const v=await Promise.all(Y.map(async T=>{try{const C=await pt.getStructure(T);return{subjectId:T,structure:C}}catch{return{subjectId:T,structure:null}}}));if(m)return;const N={};for(const{subjectId:T,structure:C}of v){if(!(C!=null&&C.sections))continue;let E=0,O=0;for(const $ of C.sections)if($.topics){for(const A of $.topics)if(A.lessons)for(const U of A.lessons)E++,x.has(U.id)&&O++}E>0&&(N[T]=Math.round(O/E*100))}if(m)return;d(N),localStorage.setItem(ne,JSON.stringify(N))}catch(_){console.error("Ошибка загрузки прогресса:",_)}})(),()=>{m=!0}},[s]);const f=(()=>{if((s==null?void 0:s.role)==="super_admin"||(s==null?void 0:s.role)==="admin"){if(n===0)return Y;const w=q.find(_=>_.id===n);return w?w.subjects:[]}if((s==null?void 0:s.role)==="teacher"&&(s!=null&&s.subject))return[s.subject];if(s!=null&&s.selected_subjects&&s.selected_subjects.length>0)return s.selected_subjects;if(n===0)return Y;const m=q.find(w=>w.id===n);return m?m.subjects:[]})(),g=(s==null?void 0:s.role)==="student"||!(s!=null&&s.role),h=(s==null?void 0:s.selected_subjects)&&s.selected_subjects.length>0,y=(s==null?void 0:s.role)==="teacher";(s==null?void 0:s.role)==="admin"||(s==null||s.role);const u=!s,S=()=>{if(y&&(s!=null&&s.subject))return e("allSubjects");if(g&&h)return"Мои предметы";if(n===0)return e("allSubjects");const m=q.find(w=>w.id===n);return`${e("cluster")} ${n}: ${o==="ru"?m==null?void 0:m.titleRu:m==null?void 0:m.titleTj}`},b=u,M=u;return!u&&g&&!h?i.jsx("main",{className:"relative",children:i.jsx(gt,{})}):i.jsxs("main",{className:"relative",children:[M&&i.jsx(ut,{}),b&&i.jsx(mt,{activeClusterId:n,setActiveClusterId:t}),i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 min-h-[600px] mt-10",children:[i.jsx("div",{className:"flex items-end justify-between mb-8 px-2",children:i.jsxs("div",{children:[i.jsx("h2",{className:"text-3xl font-bold text-white tracking-tight drop-shadow-lg",children:S()}),i.jsx("p",{className:"text-gaming-textMuted mt-2 text-lg",children:e("popularSubtitle")})]})}),f.length>0?i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 animate-fade-in-up",children:f.map((m,w)=>i.jsx(dt,{subjectId:m,progress:l[m]||0},`${n}-${m}-${w}`))}):i.jsx("div",{className:"text-center py-20 bg-white/5 rounded-3xl border border-white/10",children:i.jsx("p",{className:"text-white/60 text-lg",children:"Нет доступных предметов"})})]})]})},J=({children:e,requireTeacher:r=!1,requireAdmin:n=!1,requireSuperAdmin:t=!1})=>{const{user:o,profile:s,loading:a}=re(),l=ee();return a?i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gaming-bg",children:i.jsx(et,{size:40,className:"text-gaming-primary animate-spin"})}):o?t&&(s==null?void 0:s.role)!=="super_admin"?i.jsx(Q,{to:"/",replace:!0}):n&&(s==null?void 0:s.role)!=="admin"&&(s==null?void 0:s.role)!=="super_admin"?i.jsx(Q,{to:"/",replace:!0}):r&&(s==null?void 0:s.role)!=="teacher"&&(s==null?void 0:s.role)!=="admin"&&(s==null?void 0:s.role)!=="super_admin"?i.jsx(Q,{to:"/",replace:!0}):e:i.jsx(Q,{to:"/login",state:{from:l},replace:!0})},D=e=>te.lazy(()=>e().catch(r=>{if(!sessionStorage.getItem("chunk_reload"))return sessionStorage.setItem("chunk_reload","1"),window.location.reload(),new Promise(()=>{});throw sessionStorage.removeItem("chunk_reload"),r})),yt=D(()=>L(()=>import("./SubjectPage-APGjP5LB.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),wt=D(()=>L(()=>import("./SectionPage-MZzUWHx5.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),jt=D(()=>L(()=>import("./TopicPage-C0G9mn2N.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),vt=D(()=>L(()=>import("./LessonPage-CYrrL5SL.js").then(e=>e.L),__vite__mapDeps([9,1,2,3,4,5,10]))),St=D(()=>L(()=>import("./CreatorPage-Bt3060-v.js").then(e=>e.C),__vite__mapDeps([11,1,2,3,5,12]))),_t=D(()=>L(()=>import("./AdminPage-T0gTL-OU.js"),__vite__mapDeps([13,1,2,3,14,12,6]))),Nt=D(()=>L(()=>import("./AuthPage-DfBsZXL6.js"),__vite__mapDeps([15,1,2,3,6]))),kt=D(()=>L(()=>import("./ClassesPage-TMC7M-5I.js"),__vite__mapDeps([16,1,2,3,14,6]))),Tt=D(()=>L(()=>import("./ClassDetailsPage-4KXXuIJJ.js").then(e=>e.C),__vite__mapDeps([17,1,2,3,14,12]))),Rt=D(()=>L(()=>import("./ProfilePage-z_nDuqTW.js"),__vite__mapDeps([18,1,2,3,6]))),Ot=D(()=>L(()=>import("./NotFoundPage-BIAaCTtI.js"),__vite__mapDeps([19,1,2,3]))),Ct=()=>i.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:i.jsxs("div",{className:"flex flex-col items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 border-4 border-gaming-primary/30 border-t-gaming-primary rounded-full animate-spin"}),i.jsx("span",{className:"text-gaming-textMuted text-sm",children:"Загрузка..."})]})});function Et(){const{i18n:e}=z(),r=ee();return te.useEffect(()=>{window.scrollTo(0,0)},[r.pathname]),i.jsxs("div",{className:"min-h-screen bg-gaming-bg font-sans text-white selection:bg-gaming-pink/30 selection:text-white overflow-hidden flex flex-col",children:[i.jsx(lt,{}),i.jsx("main",{className:"flex-grow pt-24",children:i.jsx(k.Suspense,{fallback:i.jsx(Ct,{}),children:i.jsxs(He,{children:[i.jsx(P,{path:"/",element:i.jsx(bt,{})}),i.jsx(P,{path:"/subject/:subjectId",element:i.jsx(yt,{})}),i.jsx(P,{path:"/subject/:subjectId/section/:sectionId",element:i.jsx(wt,{})}),i.jsx(P,{path:"/subject/:subjectId/section/:sectionId/topic/:topicId",element:i.jsx(jt,{})}),i.jsx(P,{path:"/lesson/:lessonId",element:i.jsx(vt,{})}),i.jsx(P,{path:"/creator",element:i.jsx(J,{allowedRoles:["teacher","admin","super_admin"],children:i.jsx(St,{})})}),i.jsx(P,{path:"/admin",element:i.jsx(J,{allowedRoles:["admin","super_admin"],children:i.jsx(_t,{})})}),i.jsx(P,{path:"/classes",element:i.jsx(J,{children:i.jsx(kt,{})})}),i.jsx(P,{path:"/classes/:classId",element:i.jsx(J,{children:i.jsx(Tt,{})})}),i.jsx(P,{path:"/login",element:i.jsx(Nt,{})}),i.jsx(P,{path:"/profile",element:i.jsx(J,{children:i.jsx(Rt,{})})}),i.jsx(P,{path:"*",element:i.jsx(Ot,{})})]})})}),i.jsx(ct,{})]})}function Pt(){return i.jsx(at,{children:i.jsx($e,{basename:"/Donishmand_platform/",children:i.jsx(Et,{})})})}const{slice:It,forEach:Lt}=[];function At(e){return Lt.call(It.call(arguments,1),r=>{if(r)for(const n in r)e[n]===void 0&&(e[n]=r[n])}),e}function Dt(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(n=>n.test(e))}const ge=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Mt=function(e,r){const t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},o=encodeURIComponent(r);let s=`${e}=${o}`;if(t.maxAge>0){const a=t.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(a)}`}if(t.domain){if(!ge.test(t.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${t.domain}`}if(t.path){if(!ge.test(t.path))throw new TypeError("option path is invalid");s+=`; Path=${t.path}`}if(t.expires){if(typeof t.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${t.expires.toUTCString()}`}if(t.httpOnly&&(s+="; HttpOnly"),t.secure&&(s+="; Secure"),t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return t.partitioned&&(s+="; Partitioned"),s},fe={create(e,r,n,t){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};n&&(o.expires=new Date,o.expires.setTime(o.expires.getTime()+n*60*1e3)),t&&(o.domain=t),document.cookie=Mt(e,r,o)},read(e){const r=`${e}=`,n=document.cookie.split(";");for(let t=0;t<n.length;t++){let o=n[t];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(r)===0)return o.substring(r.length,o.length)}return null},remove(e,r){this.create(e,"",-1,r)}};var Ut={name:"cookie",lookup(e){let{lookupCookie:r}=e;if(r&&typeof document<"u")return fe.read(r)||void 0},cacheUserLanguage(e,r){let{lookupCookie:n,cookieMinutes:t,cookieDomain:o,cookieOptions:s}=r;n&&typeof document<"u"&&fe.create(n,e,t,o,s)}},$t={name:"querystring",lookup(e){var t;let{lookupQuerystring:r}=e,n;if(typeof window<"u"){let{search:o}=window.location;!window.location.search&&((t=window.location.hash)==null?void 0:t.indexOf("?"))>-1&&(o=window.location.hash.substring(window.location.hash.indexOf("?")));const a=o.substring(1).split("&");for(let l=0;l<a.length;l++){const d=a[l].indexOf("=");d>0&&a[l].substring(0,d)===r&&(n=a[l].substring(d+1))}}return n}},Ht={name:"hash",lookup(e){var o;let{lookupHash:r,lookupFromHashIndex:n}=e,t;if(typeof window<"u"){const{hash:s}=window.location;if(s&&s.length>2){const a=s.substring(1);if(r){const l=a.split("&");for(let d=0;d<l.length;d++){const p=l[d].indexOf("=");p>0&&l[d].substring(0,p)===r&&(t=l[d].substring(p+1))}}if(t)return t;if(!t&&n>-1){const l=s.match(/\/([a-zA-Z-]*)/g);return Array.isArray(l)?(o=l[typeof n=="number"?n:0])==null?void 0:o.replace("/",""):void 0}}}return t}};let X=null;const he=()=>{if(X!==null)return X;try{if(X=typeof window<"u"&&window.localStorage!==null,!X)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{X=!1}return X};var zt={name:"localStorage",lookup(e){let{lookupLocalStorage:r}=e;if(r&&he())return window.localStorage.getItem(r)||void 0},cacheUserLanguage(e,r){let{lookupLocalStorage:n}=r;n&&he()&&window.localStorage.setItem(n,e)}};let V=null;const pe=()=>{if(V!==null)return V;try{if(V=typeof window<"u"&&window.sessionStorage!==null,!V)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{V=!1}return V};var Ft={name:"sessionStorage",lookup(e){let{lookupSessionStorage:r}=e;if(r&&pe())return window.sessionStorage.getItem(r)||void 0},cacheUserLanguage(e,r){let{lookupSessionStorage:n}=r;n&&pe()&&window.sessionStorage.setItem(n,e)}},Bt={name:"navigator",lookup(e){const r=[];if(typeof navigator<"u"){const{languages:n,userLanguage:t,language:o}=navigator;if(n)for(let s=0;s<n.length;s++)r.push(n[s]);t&&r.push(t),o&&r.push(o)}return r.length>0?r:void 0}},Xt={name:"htmlTag",lookup(e){let{htmlTag:r}=e,n;const t=r||(typeof document<"u"?document.documentElement:null);return t&&typeof t.getAttribute=="function"&&(n=t.getAttribute("lang")),n}},Vt={name:"path",lookup(e){var o;let{lookupFromPathIndex:r}=e;if(typeof window>"u")return;const n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?(o=n[typeof r=="number"?r:0])==null?void 0:o.replace("/",""):void 0}},Gt={name:"subdomain",lookup(e){var o,s;let{lookupFromSubdomainIndex:r}=e;const n=typeof r=="number"?r+1:1,t=typeof window<"u"&&((s=(o=window.location)==null?void 0:o.hostname)==null?void 0:s.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(t)return t[n]}};let Ce=!1;try{document.cookie,Ce=!0}catch{}const Ee=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Ce||Ee.splice(1,1);const Jt=()=>({order:Ee,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class Pe{constructor(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(r,n)}init(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=r,this.options=At(n,this.options||{},Jt()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=o=>o.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=t,this.addDetector(Ut),this.addDetector($t),this.addDetector(zt),this.addDetector(Ft),this.addDetector(Bt),this.addDetector(Xt),this.addDetector(Vt),this.addDetector(Gt),this.addDetector(Ht)}addDetector(r){return this.detectors[r.name]=r,this}detect(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,n=[];return r.forEach(t=>{if(this.detectors[t]){let o=this.detectors[t].lookup(this.options);o&&typeof o=="string"&&(o=[o]),o&&(n=n.concat(o))}}),n=n.filter(t=>t!=null&&!Dt(t)).map(t=>this.options.convertDetectedLanguage(t)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?n:n.length>0?n[0]:null}cacheUserLanguage(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;n&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(r)>-1||n.forEach(t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(r,this.options)}))}}Pe.type="languageDetector";function ae(e){"@babel/helpers - typeof";return ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ae(e)}function Ie(){return typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":ae(XMLHttpRequest))==="object"}function Wt(e){return!!e&&typeof e.then=="function"}function Qt(e){return Wt(e)?e:Promise.resolve(e)}function xe(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,t)}return n}function be(e){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?xe(Object(n),!0).forEach(function(t){Kt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Kt(e,r,n){return(r=qt(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function qt(e){var r=Yt(e,"string");return F(r)=="symbol"?r:r+""}function Yt(e,r){if(F(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var t=n.call(e,r);if(F(t)!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function F(e){"@babel/helpers - typeof";return F=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},F(e)}var H=typeof fetch=="function"?fetch:void 0;typeof global<"u"&&global.fetch?H=global.fetch:typeof window<"u"&&window.fetch&&(H=window.fetch);var W;Ie()&&(typeof global<"u"&&global.XMLHttpRequest?W=global.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(W=window.XMLHttpRequest));var Z;typeof ActiveXObject=="function"&&(typeof global<"u"&&global.ActiveXObject?Z=global.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(Z=window.ActiveXObject));typeof H!="function"&&(H=void 0);if(!H&&!W&&!Z)try{L(()=>import("./browser-ponyfill-DPU6vdVN.js").then(e=>e.b),__vite__mapDeps([20,2])).then(function(e){H=e.default}).catch(function(){})}catch{}var le=function(r,n){if(n&&F(n)==="object"){var t="";for(var o in n)t+="&"+encodeURIComponent(o)+"="+encodeURIComponent(n[o]);if(!t)return r;r=r+(r.indexOf("?")!==-1?"&":"?")+t.slice(1)}return r},ye=function(r,n,t,o){var s=function(d){if(!d.ok)return t(d.statusText||"Error",{status:d.status});d.text().then(function(p){t(null,{status:d.status,data:p})}).catch(t)};if(o){var a=o(r,n);if(a instanceof Promise){a.then(s).catch(t);return}}typeof fetch=="function"?fetch(r,n).then(s).catch(t):H(r,n).then(s).catch(t)},we=!1,Zt=function(r,n,t,o){r.queryStringParams&&(n=le(n,r.queryStringParams));var s=be({},typeof r.customHeaders=="function"?r.customHeaders():r.customHeaders);typeof window>"u"&&typeof global<"u"&&typeof global.process<"u"&&global.process.versions&&global.process.versions.node&&(s["User-Agent"]="i18next-http-backend (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),t&&(s["Content-Type"]="application/json");var a=typeof r.requestOptions=="function"?r.requestOptions(t):r.requestOptions,l=be({method:t?"POST":"GET",body:t?r.stringify(t):void 0,headers:s},we?{}:a),d=typeof r.alternateFetch=="function"&&r.alternateFetch.length>=1?r.alternateFetch:void 0;try{ye(n,l,o,d)}catch(p){if(!a||Object.keys(a).length===0||!p.message||p.message.indexOf("not implemented")<0)return o(p);try{Object.keys(a).forEach(function(f){delete l[f]}),ye(n,l,o,d),we=!0}catch(f){o(f)}}},er=function(r,n,t,o){t&&F(t)==="object"&&(t=le("",t).slice(1)),r.queryStringParams&&(n=le(n,r.queryStringParams));try{var s=W?new W:new Z("MSXML2.XMLHTTP.3.0");s.open(t?"POST":"GET",n,1),r.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!r.withCredentials,t&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var a=r.customHeaders;if(a=typeof a=="function"?a():a,a)for(var l in a)s.setRequestHeader(l,a[l]);s.onreadystatechange=function(){s.readyState>3&&o(s.status>=400?s.statusText:null,{status:s.status,data:s.responseText})},s.send(t)}catch(d){console&&console.log(d)}},tr=function(r,n,t,o){if(typeof t=="function"&&(o=t,t=void 0),o=o||function(){},H&&n.indexOf("file:")!==0)return Zt(r,n,t,o);if(Ie()||typeof ActiveXObject=="function")return er(r,n,t,o);o(new Error("No fetch and no xhr implementation found!"))};function G(e){"@babel/helpers - typeof";return G=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},G(e)}function je(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,t)}return n}function se(e){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?je(Object(n),!0).forEach(function(t){Le(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function rr(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function nr(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,Ae(t.key),t)}}function sr(e,r,n){return r&&nr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Le(e,r,n){return(r=Ae(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function Ae(e){var r=ir(e,"string");return G(r)=="symbol"?r:r+""}function ir(e,r){if(G(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var t=n.call(e,r);if(G(t)!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var or=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",parse:function(n){return JSON.parse(n)},stringify:JSON.stringify,parsePayload:function(n,t,o){return Le({},t,o||"")},parseLoadPayload:function(n,t){},request:tr,reloadInterval:typeof window<"u"?!1:60*60*1e3,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},De=function(){function e(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};rr(this,e),this.services=r,this.options=n,this.allOptions=t,this.type="backend",this.init(r,n,t)}return sr(e,[{key:"init",value:function(n){var t=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.services=n,this.options=se(se(se({},or()),this.options||{}),o),this.allOptions=s,this.services&&this.options.reloadInterval){var a=setInterval(function(){return t.reload()},this.options.reloadInterval);G(a)==="object"&&typeof a.unref=="function"&&a.unref()}}},{key:"readMulti",value:function(n,t,o){this._readAny(n,n,t,t,o)}},{key:"read",value:function(n,t,o){this._readAny([n],n,[t],t,o)}},{key:"_readAny",value:function(n,t,o,s,a){var l=this,d=this.options.loadPath;typeof this.options.loadPath=="function"&&(d=this.options.loadPath(n,o)),d=Qt(d),d.then(function(p){if(!p)return a(null,{});var f=l.services.interpolator.interpolate(p,{lng:n.join("+"),ns:o.join("+")});l.loadUrl(f,a,t,s)})}},{key:"loadUrl",value:function(n,t,o,s){var a=this,l=typeof o=="string"?[o]:o,d=typeof s=="string"?[s]:s,p=this.options.parseLoadPayload(l,d);this.options.request(this.options,n,p,function(f,g){if(g&&(g.status>=500&&g.status<600||!g.status))return t("failed loading "+n+"; status code: "+g.status,!0);if(g&&g.status>=400&&g.status<500)return t("failed loading "+n+"; status code: "+g.status,!1);if(!g&&f&&f.message){var h=f.message.toLowerCase(),y=["failed","fetch","network","load"].find(function(b){return h.indexOf(b)>-1});if(y)return t("failed loading "+n+": "+f.message,!0)}if(f)return t(f,!1);var u,S;try{typeof g.data=="string"?u=a.options.parse(g.data,o,s):u=g.data}catch{S="failed parsing "+n+" to json"}if(S)return t(S,!1);t(null,u)})}},{key:"create",value:function(n,t,o,s,a){var l=this;if(this.options.addPath){typeof n=="string"&&(n=[n]);var d=this.options.parsePayload(t,o,s),p=0,f=[],g=[];n.forEach(function(h){var y=l.options.addPath;typeof l.options.addPath=="function"&&(y=l.options.addPath(h,t));var u=l.services.interpolator.interpolate(y,{lng:h,ns:t});l.options.request(l.options,u,d,function(S,b){p+=1,f.push(S),g.push(b),p===n.length&&typeof a=="function"&&a(f,g)})})}}},{key:"reload",value:function(){var n=this,t=this.services,o=t.backendConnector,s=t.languageUtils,a=t.logger,l=o.language;if(!(l&&l.toLowerCase()==="cimode")){var d=[],p=function(g){var h=s.toResolveHierarchy(g);h.forEach(function(y){d.indexOf(y)<0&&d.push(y)})};p(l),this.allOptions.preload&&this.allOptions.preload.forEach(function(f){return p(f)}),d.forEach(function(f){n.allOptions.ns.forEach(function(g){o.read(f,g,"read",null,null,function(h,y){h&&a.warn("loading namespace ".concat(g," for language ").concat(f," failed"),h),!h&&y&&a.log("loaded namespace ".concat(g," for language ").concat(f),y),o.loaded("".concat(f,"|").concat(g),h,y)})})})}}}])}();De.type="backend";tt.use(De).use(Pe).use(rt).init({fallbackLng:"ru",debug:!1,interpolation:{escapeValue:!1},backend:{loadPath:"/Donishmand_platform/locales/{{lng}}/translation.json?v="+new Date().getTime()},detection:{order:["localStorage","navigator"],caches:["localStorage"]},react:{useSuspense:!1}});function ar(e){const r=(e==null?void 0:e.message)||"";return r.includes("Failed to fetch dynamically imported module")||r.includes("Loading chunk")||r.includes("Loading CSS chunk")||r.includes("Importing a module script failed")}class lr extends te.Component{constructor(r){super(r),this.state={hasError:!1,error:null,errorInfo:null,isChunkError:!1}}static getDerivedStateFromError(r){const n=ar(r);return n&&!sessionStorage.getItem("chunk_reload")?(sessionStorage.setItem("chunk_reload","1"),window.location.reload(),{hasError:!0,error:r,isChunkError:!0}):(n&&sessionStorage.removeItem("chunk_reload"),{hasError:!0,error:r,isChunkError:n})}componentDidCatch(r,n){console.error("Global Error Caught:",r,n),this.setState({errorInfo:n})}componentDidMount(){sessionStorage.removeItem("chunk_reload")}render(){return this.state.hasError?i.jsxs("div",{style:{padding:"2rem",backgroundColor:"#1a1a2e",color:"#fff",minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:[i.jsx("h1",{style:{color:"#ff49db",marginBottom:"1rem"},children:this.state.isChunkError?"Обновление приложения...":"Что-то пошло не так :("}),i.jsx("p",{style:{marginBottom:"2rem",opacity:.8},children:this.state.isChunkError?"Приложение было обновлено. Перезагрузите страницу для получения новой версии.":"Произошла ошибка при отрисовке приложения."}),!this.state.isChunkError&&i.jsxs("div",{style:{padding:"1rem",backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:"0.5rem",maxWidth:"800px",width:"100%",overflow:"auto",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[i.jsx("code",{style:{color:"#ff7eb3",display:"block",marginBottom:"0.5rem"},children:this.state.error&&this.state.error.toString()}),i.jsx("pre",{style:{fontSize:"0.8rem",opacity:.6,whiteSpace:"pre-wrap"},children:this.state.errorInfo&&this.state.errorInfo.componentStack})]}),i.jsx("button",{onClick:()=>{sessionStorage.removeItem("chunk_reload"),window.location.reload()},style:{marginTop:"2rem",padding:"0.75rem 2rem",backgroundColor:"#7c3aed",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"Перезагрузить страницу"}),i.jsx("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},style:{marginTop:"1rem",padding:"0.75rem 2rem",backgroundColor:"transparent",color:"#e2e8f0",border:"1px solid #4a5568",borderRadius:"0.5rem",cursor:"pointer",fontSize:"0.9rem"},children:"Сбросить кэш и перезагрузить"})]}):this.props.children}}oe.createRoot(document.getElementById("root")).render(i.jsx(te.StrictMode,{children:i.jsx(lr,{children:i.jsx(Pt,{})})}));export{Y as A,q as C,Oe as S,L as _,pt as a,gr as b,R as s,re as u};
